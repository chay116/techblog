---
title: "Chaos Island System & Sleep/Wake Deep Dive"
date: "2025-12-09"
status: "stable"
project: "UnrealEngine"
lang: "ko"
category: "unreal-summary"
track: "Physics"
tags: ["unreal", "Physics"]
engine_version: "Unreal Engine 5.7"
---
# Chaos Island System & Sleep/Wake Deep Dive

## ğŸ§­ ê°œìš” (Overview)

**Island System**ì€ ë¬¼ë¦¬ì ìœ¼ë¡œ ì—°ê²°ëœ íŒŒí‹°í´ë“¤ì„ ê·¸ë£¹í™”í•˜ì—¬ ì‹œë®¬ë ˆì´ì…˜ íš¨ìœ¨ì„±ì„ ë†’ì´ëŠ” ì‹œìŠ¤í…œì…ë‹ˆë‹¤. **Sleep/Wake** ë©”ì»¤ë‹ˆì¦˜ì€ ì›€ì§ì„ì´ ì—†ëŠ” ì˜¤ë¸Œì íŠ¸ì˜ ì‹œë®¬ë ˆì´ì…˜ì„ ì¤‘ë‹¨í•˜ì—¬ ì„±ëŠ¥ì„ ìµœì í™”í•©ë‹ˆë‹¤.

### í•µì‹¬ ê°œë…

| ê°œë… | ì„¤ëª… |
|------|------|
| **Island** | ì œì•½ ì¡°ê±´ìœ¼ë¡œ ì—°ê²°ëœ íŒŒí‹°í´ë“¤ì˜ ì§‘í•© |
| **Constraint Graph** | íŒŒí‹°í´(ë…¸ë“œ)ê³¼ ì œì•½(ì—£ì§€)ë¡œ êµ¬ì„±ëœ ê·¸ë˜í”„ |
| **Sleep** | ì›€ì§ì„ì´ ì—†ëŠ” íŒŒí‹°í´ì˜ ì‹œë®¬ë ˆì´ì…˜ ì¤‘ë‹¨ |
| **Wake** | Sleep ìƒíƒœì˜ íŒŒí‹°í´ì„ ë‹¤ì‹œ í™œì„±í™” |
| **Partial Sleep** | Island ì „ì²´ê°€ ì•„ë‹Œ ê°œë³„ íŒŒí‹°í´ Sleep |
| **Level** | Kinematicê³¼ì˜ ê±°ë¦¬ (Shock Propagationìš©) |

---

## ğŸ—ï¸ Island System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          Island System Architecture                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        FPBDIslandManager                                   â”‚
â”‚                    (ì „ì²´ Constraint Graph ê´€ë¦¬)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  TPoolBackedArray<FPBDIslandParticle> Nodes   (íŒŒí‹°í´ ë…¸ë“œ)         â”‚  â”‚
â”‚  â”‚  TPoolBackedArray<FPBDIslandConstraint> Edges (ì œì•½ ì—£ì§€)           â”‚  â”‚
â”‚  â”‚  TPoolBackedArray<FPBDIsland> Islands         (Island ì»¨í…Œì´ë„ˆ)     â”‚  â”‚
â”‚  â”‚  TPoolBackedArray<FPBDIslandMergeSet> MergeSets (ë³‘í•© ì¶”ì )         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                        Island 1                                      â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    Edge    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    Edge    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚  â”‚
â”‚  â”‚  â”‚ Node A â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ Node B â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ Node C â”‚            â”‚  â”‚
â”‚  â”‚  â”‚(Dynamic)â”‚  (Joint)  â”‚(Dynamic)â”‚(Collision)â”‚(Dynamic)â”‚            â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                        Island 2                                      â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    Edge    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚  â”‚
â”‚  â”‚  â”‚ Node D â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ Node E â”‚                                   â”‚  â”‚
â”‚  â”‚  â”‚(Dynamic)â”‚  (Spring) â”‚(Dynamic)â”‚                                   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                            â”‚
â”‚  â€» Kinematic íŒŒí‹°í´ì€ ì—¬ëŸ¬ Islandì— ì†í•  ìˆ˜ ìˆìŒ (ê³µìœ )                  â”‚
â”‚  â€» Static íŒŒí‹°í´ì€ Islandì— ì†í•˜ì§€ ì•ŠìŒ                                  â”‚
â”‚                                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“‚ ì£¼ìš” ì†ŒìŠ¤ íŒŒì¼

| íŒŒì¼ | ì—­í•  |
|------|------|
| `Public/Chaos/Island/IslandManager.h:452` | FPBDIslandManager ë©”ì¸ í´ë˜ìŠ¤ |
| `Private/Chaos/Island/IslandManager.cpp` | Island ê´€ë¦¬ êµ¬í˜„ (3500+ ë¼ì¸) |
| `Public/Chaos/Island/IslandGroupManager.h` | Island ê·¸ë£¹í™” ë° ë³‘ë ¬ ì²˜ë¦¬ |
| `Public/Chaos/Island/IslandGroup.h` | Constraint Group Solver |

---

## ğŸ”· 1. í•µì‹¬ í´ë˜ìŠ¤

### 1.1 FPBDIslandManager

**ğŸ“‚ ìœ„ì¹˜:** `Chaos/Public/Chaos/Island/IslandManager.h:452`

ì „ì²´ Constraint Graphë¥¼ ê´€ë¦¬í•˜ëŠ” ë©”ì¸ í´ë˜ìŠ¤:

```cpp
class FPBDIslandManager
{
public:
    //â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // í•µì‹¬ ë°ì´í„° êµ¬ì¡° (Pool ê¸°ë°˜ ë©”ëª¨ë¦¬ ê´€ë¦¬)
    //â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    TPoolBackedArray<FPBDIslandParticle> Nodes;       // íŒŒí‹°í´ ë…¸ë“œ
    TPoolBackedArray<FPBDIslandConstraint> Edges;     // ì œì•½ ì—£ì§€
    TPoolBackedArray<FPBDIsland> Islands;             // Island ì»¨í…Œì´ë„ˆ
    TPoolBackedArray<FPBDIslandMergeSet> MergeSets;   // ë³‘í•© ì¶”ì 

    //â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Sleep ì„¤ì •
    //â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    int32 DisableCounterThreshold;    // Disableê¹Œì§€ì˜ Sleep í”„ë ˆì„ ìˆ˜

    //â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Shock Propagation
    //â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    int32 NextLevelSortKey;           // ë ˆë²¨ ì •ë ¬ í‚¤
    int32 NextVisitEpoch;             // ë°©ë¬¸ ì—í¬í¬
    bool bAssignLevels;               // ë ˆë²¨ í• ë‹¹ í™œì„±í™”

    //â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ë©”ì¸ API
    //â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    // Sleep ì—…ë°ì´íŠ¸ (í”„ë ˆì„ë‹¹ í˜¸ì¶œ)
    void UpdateSleep(const FReal Dt);

    // Island ë³‘í•©/ë¶„ë¦¬ ì²˜ë¦¬
    void ProcessMerges();
    void ProcessSplits();

    // íŒŒí‹°í´ Wake
    void WakeParticleIslands(FGeometryParticleHandle* Particle);

private:
    // Sleep ì²˜ë¦¬
    void ProcessSleep(const FRealSingle Dt);
    void ProcessIslandSleep(FPBDIsland* Island, const FRealSingle Dt);
    void ProcessPartialIslandSleep(FPBDIsland* Island, const FRealSingle Dt);

    // Wake ì²˜ë¦¬
    void ProcessPartialIslandWake(FPBDIsland* Island, const bool bProcessEdgeBasedWake);
    void PropagatePartialIslandWake(FPBDIslandParticle* TriggerNode, ...);
};
```

### 1.2 FPBDIslandParticle (ë…¸ë“œ)

**ğŸ“‚ ìœ„ì¹˜:** `IslandManager.h:40-145`

Constraint Graphì˜ ë…¸ë“œ (íŒŒí‹°í´):

```cpp
class FPBDIslandParticle
{
private:
    //â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // íŒŒí‹°í´ ì°¸ì¡°
    //â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    FGeometryParticleHandle* Particle;

    //â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Island í• ë‹¹ (Dynamic íŒŒí‹°í´ë§Œ)
    //â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    FPBDIsland* Island;

    //â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Graph ì—°ê²°ì„±
    //â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    TArray<FPBDIslandConstraint*> Edges;  // ì—°ê²°ëœ ì œì•½ë“¤

    //â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Sleep ì„ê³„ê°’ (ì¬ë£Œì—ì„œ ìºì‹œë¨)
    //â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    FRealSingle SleepLinearThresholdSq;     // VÂ² ì„ê³„ê°’
    FRealSingle SleepAngularThresholdSq;    // WÂ² ì„ê³„ê°’
    int32 SleepCounterThreshold;            // Sleepê¹Œì§€ì˜ í”„ë ˆì„ ìˆ˜

    //â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Wake ì„ê³„ê°’ (Partial Sleepìš©)
    //â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    FRealSingle WakeLinearThresholdSq;      // Wakeì— í•„ìš”í•œ VÂ²
    FRealSingle WakeAngularThresholdSq;     // Wakeì— í•„ìš”í•œ WÂ²

    //â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Disable ì„ê³„ê°’ (ì¥ì‹œê°„ Sleepì‹œ)
    //â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    FRealSingle DisableLinearThresholdSq;
    FRealSingle DisableAngularThresholdSq;

    //â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ìƒíƒœ í”Œë˜ê·¸
    //â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    union FFlags {
        uint32 bIsDynamic : 1;                  // ë™ì  íŒŒí‹°í´ ì—¬ë¶€
        uint32 bIsSleeping : 1;                 // Sleep ì¤‘ (Partial)
        uint32 bIsMoving : 1;                   // í˜„ì¬ ì›€ì§ì´ëŠ” ì¤‘
        uint32 bNeedsResim : 1;                 // Resim í•„ìš”
        uint32 bWasUpdated : 1;                 // Transform ëª…ì‹œì  ì„¤ì •ë¨
        uint32 bWasProcessed : 1;               // Wake ì´ë²¤íŠ¸ ì²˜ë¦¬ë¨
        uint32 bWasTransformSetExplicitly : 1;  // Transform ì„¤ì •
    } Flags;

    //â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Graph Level (Shock Propagationìš©)
    //â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    int32 Level;  // Kinematicê³¼ì˜ ê±°ë¦¬
};
```

### 1.3 FPBDIslandConstraint (ì—£ì§€)

**ğŸ“‚ ìœ„ì¹˜:** `IslandManager.h:150-221`

Constraint Graphì˜ ì—£ì§€ (ì œì•½):

```cpp
class FPBDIslandConstraint
{
private:
    //â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ì œì•½ ì°¸ì¡°
    //â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    FConstraintHandle* Constraint;

    //â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ì—°ê²°ëœ ë…¸ë“œ
    //â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    FPBDIslandParticle* Nodes[2];   // ì–‘ìª½ íŒŒí‹°í´
    FPBDIsland* Island;

    //â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Graph Level ì •ë³´
    //â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    int32 Level;           // ë ˆë²¨
    uint32 LevelSortKey;   // ê°™ì€ Level ë‚´ ì •ë ¬ ìˆœì„œ

    //â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ìƒíƒœ í”Œë˜ê·¸
    //â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    union FFlags {
        uint32 bIsSleeping : 1;     // Sleep ì¤‘
        uint32 bIsNew : 1;          // ì´ í”„ë ˆì„ì— ìƒˆë¡œ ì¶”ê°€
        uint32 bWasProcessed : 1;   // Wake ì´ë²¤íŠ¸ ì²˜ë¦¬ë¨
    } Flags;
};
```

### 1.4 FPBDIsland (Island ì»¨í…Œì´ë„ˆ)

**ğŸ“‚ ìœ„ì¹˜:** `IslandManager.h:230-411`

ì—°ê²°ëœ íŒŒí‹°í´ê³¼ ì œì•½ì˜ ì§‘í•©:

```cpp
class FPBDIsland
{
private:
    //â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ì»¨í…Œì´ë„ˆ
    //â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    TArray<FPBDIslandParticle*> Nodes;  // Dynamic íŒŒí‹°í´ë§Œ
    TConstraintTypeArray<TArray<FPBDIslandConstraint*>> ContainerEdges;
    int32 NumEdges;

    //â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Sleep ìƒíƒœ ê´€ë¦¬
    //â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    int32 SleepCounter;             // Sleep ì¹´ìš´í„°
    int32 DisableCounter;           // Disable ì¹´ìš´í„°
    int32 SleepTypeSwitchCounter;   // Partial â†” Full ì „í™˜ ì¹´ìš´í„°

    //â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ë³‘í•© ì¶”ì 
    //â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    FPBDIslandMergeSet* MergeSet;
    int32 MergeSetIslandIndex;

    //â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ìƒíƒœ í”Œë˜ê·¸
    //â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    union FFlags {
        uint32 bItemsAdded : 1;
        uint32 bItemsRemoved : 1;
        uint32 bIsSleepAllowed : 1;               // Moving Kinematic ì—†ìŒ
        uint32 bIsPartialSleepAllowedInAllNodes : 1;
        uint32 bHasSleepingNode : 1;              // Partial: sleeping ë…¸ë“œ ìˆìŒ
        uint32 bEnoughMotionlessNodesForPartialSleep : 1;
        uint32 bIsSleeping : 1;                   // ì „ì²´ Sleep ì¤‘
        uint32 bWasSleeping : 1;                  // ì´ì „ í”„ë ˆì„ Sleep
        uint32 bCheckSleep : 1;                   // Sleep ì²´í¬ íì— ì¶”ê°€
        uint32 bNeedsResim : 1;
        uint32 bIsUsingCache : 1;
    } Flags;

    //â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Iteration ì„¤ì •
    //â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    FIterationSettings Iterations;  // ì„ íƒì ìœ¼ë¡œ ë†’ì€ Iteration
};
```

---

## ğŸ”· 2. Sleep/Wake ì‹œìŠ¤í…œ

### 2.1 Sleep í”„ë¡œì„¸ìŠ¤ íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          Sleep Process Flow                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Physics Tick
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  UpdateSleep(Dt)                                                           â”‚
â”‚  ğŸ“‚ IslandManager.cpp:1138                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚       â”‚                                                                    â”‚
â”‚       â”œâ”€â”€â†’ ProcessSleep(Dt)                                               â”‚
â”‚       â”‚         â”‚                                                          â”‚
â”‚       â”‚         â”œâ”€â”€â†’ [ê³ ë¦½ëœ íŒŒí‹°í´ ì²˜ë¦¬]                                 â”‚
â”‚       â”‚         â”‚    Islandì— ì†í•˜ì§€ ì•Šì€ íŒŒí‹°í´                          â”‚
â”‚       â”‚         â”‚    Constraint ì—†ì´ ë– ìˆëŠ” íŒŒí‹°í´                        â”‚
â”‚       â”‚         â”‚                                                          â”‚
â”‚       â”‚         â””â”€â”€â†’ [Island ì²˜ë¦¬]                                        â”‚
â”‚       â”‚              for each Island:                                      â”‚
â”‚       â”‚                  â”œâ”€ ProcessIslandSleep()     (ì „ì²´ Island Sleep)  â”‚
â”‚       â”‚                  â””â”€ ProcessPartialIslandSleep() (ê°œë³„ íŒŒí‹°í´)     â”‚
â”‚       â”‚                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ì „ì²´ Island Sleep

**ğŸ“‚ ìœ„ì¹˜:** `IslandManager.cpp:2574-2633`

```cpp
void FPBDIslandManager::ProcessIslandSleep(FPBDIsland* Island, const FRealSingle Dt)
{
    bool bAllSlow = true;
    int32 MaxSleepCounterThreshold = 0;

    // ëª¨ë“  ë…¸ë“œ ê²€ì‚¬
    for (FPBDIslandParticle* Node : Island->Nodes)
    {
        if (Node->SleepCounterThreshold == 0)
        {
            bAllSlow = false;  // Sleep ë¶ˆê°€ íŒŒí‹°í´
            break;
        }

        FVec3f V = Node->Particle->GetV();
        FVec3f W = Node->Particle->GetW();

        // ì†ë„ ì„ê³„ê°’ ê²€ì‚¬
        if (V.SizeSquared() > Node->SleepLinearThresholdSq ||
            W.SizeSquared() > Node->SleepAngularThresholdSq)
        {
            bAllSlow = false;
            break;
        }

        MaxSleepCounterThreshold = FMath::Max(
            MaxSleepCounterThreshold,
            Node->SleepCounterThreshold);
    }

    if (bAllSlow)
    {
        // ëª¨ë“  íŒŒí‹°í´ì´ ëŠë¦¼ â†’ SleepCounter ì¦ê°€
        Island->SleepCounter++;

        if (Island->SleepCounter > MaxSleepCounterThreshold)
        {
            // Sleep ì¡°ê±´ ì¶©ì¡± â†’ Island Sleep
            Island->Flags.bIsSleeping = true;
            Island->SleepCounter = 0;
            PropagateIslandSleep(Island);  // íŒŒí‹°í´ì— ì „íŒŒ
        }
    }
    else
    {
        // ì›€ì§ì´ëŠ” íŒŒí‹°í´ ìˆìŒ â†’ ì¹´ìš´í„° ë¦¬ì…‹
        Island->SleepCounter = 0;
    }
}
```

### 2.3 Partial Island Sleep (ê°œë³„ íŒŒí‹°í´ Sleep)

**ğŸ“‚ ìœ„ì¹˜:** `IslandManager.cpp:2702-2831`

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Partial Island Sleep                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                  â”‚
â”‚  ëª©ì : Island ì „ì²´ê°€ ì•„ë‹Œ ê°œë³„ íŒŒí‹°í´ ë‹¨ìœ„ë¡œ Sleep ì œì–´                         â”‚
â”‚                                                                                  â”‚
â”‚  ì˜ˆì‹œ:                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚                    Island                                â”‚                    â”‚
â”‚  â”‚                                                          â”‚                    â”‚
â”‚  â”‚    â—â”€â”€â”€â”€â—â”€â”€â”€â”€â—â”€â”€â”€â”€â—â”€â”€â”€â”€â—                                â”‚                    â”‚
â”‚  â”‚    â”‚    â”‚    â”‚    â”‚    â”‚                                â”‚                    â”‚
â”‚  â”‚   zzz  zzz   !   zzz  zzz   â† ê°€ìš´ë° íŒŒí‹°í´ë§Œ í™œì„±      â”‚                    â”‚
â”‚  â”‚                                                          â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                                                                  â”‚
â”‚  ì¥ì :                                                                          â”‚
â”‚  - ë¶€ë¶„ì ìœ¼ë¡œ ì›€ì§ì´ëŠ” ìŠ¤íƒì—ì„œ ì„±ëŠ¥ í–¥ìƒ                                       â”‚
â”‚  - ì „ì²´ Island Wake ì—†ì´ êµ­ì†Œì  ì‹œë®¬ë ˆì´ì…˜                                      â”‚
â”‚                                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```cpp
void FPBDIslandManager::ProcessPartialIslandSleep(FPBDIsland* Island, const FRealSingle Dt)
{
    // 1. ëŠë¦° íŒŒí‹°í´ Sleep
    SleepNonMovingParticles(Island);

    // 2. Partial Sleep ë¯¸ì§€ì› ì œì•½ í™•ì¸
    RewakeConstraintsNotSupportingPartialSleep(Island);
    // Active-Sleeping íŒŒí‹°í´ ìŒ ë°œê²¬ ì‹œ Wake

    // 3. Sleeping íŒŒí‹°í´ ê°„ ì œì•½ ë¹„í™œì„±í™”
    SleepConstraintsBetweenNonAwakeParticles(Island);

    // 4. í›„ì²˜ë¦¬ Wake (ì¶©ê²©ëŸ‰ ê¸°ë°˜)
    PostStepPartialWake(Island);
    // ì œì•½ í•´ê²°ìì˜ ì¶©ê²©ì´ í¬ë©´ íŒŒí‹°í´ ê¹¨ìš°ê¸°
}
```

### 2.4 Wake í”„ë¡œì„¸ìŠ¤ íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          Wake Process Flow                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Wake íŠ¸ë¦¬ê±°
       â”‚
       â”œâ”€â”€â†’ [ë…¸ë“œ ê¸°ë°˜ Wake]
       â”‚    - ì‚¬ìš©ìê°€ Transform ëª…ì‹œì  ì„¤ì •
       â”‚    - bWasUpdated í”Œë˜ê·¸ ì„¤ì •
       â”‚
       â””â”€â”€â†’ [ì—£ì§€ ê¸°ë°˜ Wake]
            - ìƒˆ ì œì•½ ì¶”ê°€
            - bIsNew í”Œë˜ê·¸ ì„¤ì •
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ProcessPartialIslandWake(Island, bProcessEdgeBasedWake)                  â”‚
â”‚  ğŸ“‚ IslandManager.cpp:3181-3286                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                            â”‚
â”‚  for each Node in Island:                                                 â”‚
â”‚      if (Node->bWasUpdated)                                               â”‚
â”‚          PropagatePartialIslandWake(Node, ...)                            â”‚
â”‚                                                                            â”‚
â”‚  if (bProcessEdgeBasedWake)                                               â”‚
â”‚      for each Edge in Island:                                             â”‚
â”‚          if (Edge->bIsNew)                                                â”‚
â”‚              PropagatePartialIslandWake(Edge->Nodes, ...)                 â”‚
â”‚                                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PropagatePartialIslandWake(TriggerNode, ...)                            â”‚
â”‚  ğŸ“‚ IslandManager.cpp:3288-3334                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                            â”‚
â”‚  ì•Œê³ ë¦¬ì¦˜:                                                                â”‚
â”‚  1. íŠ¸ë¦¬ê±° ë…¸ë“œë¶€í„° ì‹œì‘                                                  â”‚
â”‚  2. ì—°ê²°ëœ ì—£ì§€ ìˆœíšŒ:                                                     â”‚
â”‚     â”œâ”€ Confirmed Propagation: íŠ¸ë¦¬ê±° + (ìƒˆ ì œì•½ or ë¬´ì¡°ê±´)               â”‚
â”‚     â”œâ”€ Upward Propagation: ë ˆë²¨ ì¦ê°€ ë°©í–¥                                â”‚
â”‚     â””â”€ Unsupporting Constraint: Partial Sleep ë¯¸ì§€ì›                      â”‚
â”‚  3. ëª¨ë©˜í…€ ì „íŒŒ (ì˜µì…˜):                                                   â”‚
â”‚     - íŠ¸ë¦¬ê±° ë…¸ë“œì˜ ëª¨ë©˜í…€ ì „ë‹¬                                           â”‚
â”‚     - ëª¨ë©˜í…€ > ì„ê³„ê°’ â†’ Wake                                              â”‚
â”‚                                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.5 Wake ì „íŒŒ ë©”ì»¤ë‹ˆì¦˜

```cpp
void FPBDIslandManager::PropagatePartialIslandWake(
    FPBDIslandParticle* TriggerNode,
    const bool bIsTrigger,
    const bool bIsAlwaysTrigger,
    const FVec3f& LinearMomentum,
    const FVec3f& AngularMomentum)
{
    for (FPBDIslandConstraint* Edge : TriggerNode->Edges)
    {
        if (Edge->Flags.bWasProcessed)
            continue;

        FPBDIslandParticle* OtherNode = Edge->GetOtherNode(TriggerNode);

        bool bShouldWake = false;

        // ì¡°ê±´ 1: Confirmed Propagation
        if (bIsTrigger && (Edge->Flags.bIsNew || bIsAlwaysTrigger))
            bShouldWake = true;

        // ì¡°ê±´ 2: Upward Propagation (Kinematicì—ì„œ ë©€ì–´ì§€ëŠ” ë°©í–¥)
        if (OtherNode->Level > TriggerNode->Level)
            bShouldWake = true;

        // ì¡°ê±´ 3: Partial Sleep ë¯¸ì§€ì› ì œì•½
        if (!SupportsPartialSleep(Edge->Constraint))
            bShouldWake = true;

        // ì¡°ê±´ 4: ëª¨ë©˜í…€ ì „íŒŒ
        if (CVars::ChaosSolverMomentumPropagation > 0.0f)
        {
            FRealSingle LinearMomentumSq = LinearMomentum.SizeSquared();
            if (LinearMomentumSq > OtherNode->WakeLinearThresholdSq *
                CVars::ChaosSolverMomentumPropagation)
            {
                bShouldWake = true;
            }
        }

        if (bShouldWake)
        {
            WakeNode(OtherNode);
            Edge->Flags.bWasProcessed = true;

            // ì¬ê·€ì  ì „íŒŒ
            PropagatePartialIslandWake(OtherNode, false, false,
                LinearMomentum * PropagationFactor,
                AngularMomentum * PropagationFactor);
        }
    }
}
```

---

## ğŸ”· 3. Sleep ì„ê³„ê°’ ì„¤ì •

### 3.1 CVars ì„¤ì •

**ğŸ“‚ ìœ„ì¹˜:** `IslandManager.cpp:40-150`

```cpp
//â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ê¸°ë³¸ Sleep ì„¤ì •
//â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

// ì „ì—­ í™œì„±í™”
bool bChaosSolverSleepEnabled = true;
// CVar: p.Chaos.Solver.Sleep.Enabled

// Sleep ì¹´ìš´í„° ì„ê³„ê°’ (ê¸°ë³¸: 20 í”„ë ˆì„)
int32 ChaosSolverCollisionDefaultSleepCounterThreshold = 20;
// CVar: p.Chaos.Solver.Sleep.Defaults.SleepCounterThreshold

// ì„ í˜• ì†ë„ ì„ê³„ê°’ (ê¸°ë³¸: 0.001 Unit/s)
FRealSingle ChaosSolverCollisionDefaultLinearSleepThreshold = 0.001f;
// CVar: p.Chaos.Solver.Sleep.Defaults.LinearSleepThreshold

// ê°ì†ë„ ì„ê³„ê°’ (ê¸°ë³¸: 0.0087 rad/s, ~0.5ë„)
FRealSingle ChaosSolverCollisionDefaultAngularSleepThreshold = 0.0087f;
// CVar: p.Chaos.Solver.Sleep.Defaults.AngularSleepThreshold

// í¬ê¸° ê¸°ë°˜ ê°ì†ë„ ìŠ¤ì¼€ì¼ë§
FRealSingle ChaosSolverCollisionAngularSleepThresholdSize = 0;
// CVar: p.Chaos.Solver.Sleep.AngularSleepThresholdSize
```

```cpp
//â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Partial Island Sleep ì„¤ì •
//â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

bool bChaosSolverPartialIslandSleep = false;
// CVar: p.Chaos.Solver.Sleep.PartialIslandSleep

bool bChaosSolverPartialIslandWake = true;
// CVar: p.Chaos.Solver.Sleep.PartialIslandSleep.PartialIslandWake

FRealSingle ChaosSolverMomentumPropagation = 0.3f;
// CVar: p.Chaos.Solver.Sleep.PartialIslandSleep.MomentumPropagation

FRealSingle LinearPartialWakeThresholdMultiplier = 10.0f;
// CVar: p.Chaos.Solver.Sleep.PartialIslandSleep.LinearWakeThresholdMultiplier

FRealSingle AngularPartialWakeThresholdMultiplier = 10.0f;
// CVar: p.Chaos.Solver.Sleep.PartialIslandSleep.AngularWakeThresholdMultiplier

FRealSingle ChaosSolverMinMotionlessRatio = 0.1f;
// CVar: p.Chaos.Solver.Sleep.PartialIslandSleep.MinimumMotionlessRatio
```

### 3.2 Sleep ì¹´ìš´í„° ë¡œì§

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Sleep Counter Logic                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                  â”‚
â”‚  ë§¤ í”„ë ˆì„:                                                                      â”‚
â”‚                                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚  if (Velocity < Threshold)                                   â”‚                â”‚
â”‚  â”‚  {                                                           â”‚                â”‚
â”‚  â”‚      SleepCounter = Min(SleepCounter + 1, MaxCounter);      â”‚                â”‚
â”‚  â”‚                                                              â”‚                â”‚
â”‚  â”‚      if (SleepCounter > SleepCounterThreshold)              â”‚                â”‚
â”‚  â”‚      {                                                       â”‚                â”‚
â”‚  â”‚          bIsSleeping = true;                                â”‚                â”‚
â”‚  â”‚          SleepCounter = 0;                                  â”‚                â”‚
â”‚  â”‚      }                                                       â”‚                â”‚
â”‚  â”‚  }                                                           â”‚                â”‚
â”‚  â”‚  else                                                        â”‚                â”‚
â”‚  â”‚  {                                                           â”‚                â”‚
â”‚  â”‚      SleepCounter = 0;  // ì¦‰ì‹œ ë¦¬ì…‹                        â”‚                â”‚
â”‚  â”‚  }                                                           â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                                                  â”‚
â”‚  íƒ€ì„ë¼ì¸ ì˜ˆì‹œ (Threshold = 5):                                                 â”‚
â”‚                                                                                  â”‚
â”‚  Frame:  1   2   3   4   5   6   7   8   9   10                                â”‚
â”‚  Speed:  !   .   .   .   .   !   .   .   .   .                                 â”‚
â”‚  Counter: 0   1   2   3   4   0   1   2   3   4   â†’ Sleep at frame 11          â”‚
â”‚                                                                                  â”‚
â”‚  ! = ì›€ì§ì„, . = ì •ì§€                                                           â”‚
â”‚                                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”· 4. Island ë³‘í•©/ë¶„ë¦¬

### 4.1 Island ë³‘í•© (Merge)

**ğŸ“‚ ìœ„ì¹˜:** `IslandManager.cpp:1800-2000`

```cpp
// ë³‘í•© í•„ìš” ì‹œì : ì œì•½ì´ ë‘ ë‹¤ë¥¸ Islandì˜ íŒŒí‹°í´ì„ ì—°ê²°í•  ë•Œ
void FPBDIslandManager::AssignEdgeIsland(FPBDIslandConstraint* Edge)
{
    FPBDIsland* Island0 = Edge->Nodes[0]->Island;
    FPBDIsland* Island1 = Edge->Nodes[1]->Island;

    if (Island0 != Island1)
    {
        // ë‘ Island ë³‘í•© í•„ìš”
        FPBDIsland* Island = MergeNodeIslands(Edge->Nodes[0], Edge->Nodes[1]);
        AddEdgeToIsland(Edge, Island);
    }
}

// ë³‘í•© ì‹¤í–‰
void FPBDIslandManager::ProcessMerges()
{
    for (FPBDIslandMergeSet* MergeSet : MergeSets)
    {
        // ê°€ì¥ í° Islandë¥¼ Parentë¡œ ì„ íƒ
        FPBDIsland* ParentIsland = GetMergeSetParentIsland(MergeSet);

        // ë©”ëª¨ë¦¬ ë¯¸ë¦¬ í• ë‹¹
        ParentIsland->Nodes.Reserve(TotalNodes);

        // ëª¨ë“  Child Islandë¥¼ Parentë¡œ ë³‘í•©
        for (FPBDIsland* ChildIsland : MergeSet->Islands)
        {
            if (ChildIsland != ParentIsland)
            {
                ProcessIslandMerge(ParentIsland, ChildIsland);
            }
        }
    }
}
```

### 4.2 Island ë¶„ë¦¬ (Split)

**ğŸ“‚ ìœ„ì¹˜:** `IslandManager.cpp:2015-2060`

```cpp
// ë¶„ë¦¬ í•„ìš” ì‹œì : ì œì•½ì´ ì œê±°ë˜ì–´ Islandê°€ ë¶„ë¦¬ë  ë•Œ
void FPBDIslandManager::ProcessSplits()
{
    for (FPBDIsland* Island : Islands)
    {
        if (Island->Flags.bItemsRemoved)
        {
            // Islandê°€ ì—¬ëŸ¬ ê°œë¡œ ë¶„ë¦¬ë˜ëŠ”ì§€ í™•ì¸
            // DFS/BFSë¡œ ì—°ê²° ì„±ë¶„ ì°¾ê¸°
            ProcessIslandSplits(Island);
        }
    }
}
```

### 4.3 ë³‘í•©/ë¶„ë¦¬ ì‹œê°í™”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Island Merge/Split                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                  â”‚
â”‚  ë³‘í•© ì˜ˆì‹œ:                                                                      â”‚
â”‚                                                                                  â”‚
â”‚  Before:                              After:                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  Island 1   â”‚  â”‚  Island 2   â”‚    â”‚         Island 1            â”‚           â”‚
â”‚  â”‚   â—â”€â”€â”€â—     â”‚  â”‚     â—â”€â”€â”€â—   â”‚    â”‚   â—â”€â”€â”€â—â”€â”€â”€â”€â”€â—â”€â”€â”€â—           â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                                  â”‚
â”‚            ìƒˆ ì œì•½ ì¶”ê°€ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º                                        â”‚
â”‚                                                                                  â”‚
â”‚  ë¶„ë¦¬ ì˜ˆì‹œ:                                                                      â”‚
â”‚                                                                                  â”‚
â”‚  Before:                              After:                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚         Island 1            â”‚    â”‚  Island 1   â”‚  â”‚  Island 2   â”‚           â”‚
â”‚  â”‚   â—â”€â”€â”€â—â•â•â•â•â•â—â”€â”€â”€â—           â”‚    â”‚   â—â”€â”€â”€â—     â”‚  â”‚     â—â”€â”€â”€â—   â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                                  â”‚
â”‚          ì œì•½ ì œê±° â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â–º                                            â”‚
â”‚                                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”· 5. Level System (Shock Propagation)

### 5.1 Level ê°œë…

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Level System for Shock Propagation                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                  â”‚
â”‚  Level = Kinematic íŒŒí‹°í´ê³¼ì˜ Graph ê±°ë¦¬                                        â”‚
â”‚                                                                                  â”‚
â”‚                     Ground (Kinematic)                                          â”‚
â”‚  Level 0:          â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                          â”‚
â”‚                          â”‚                                                       â”‚
â”‚  Level 1:          â—â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â—                                                â”‚
â”‚                    â”‚     â”‚     â”‚                                                â”‚
â”‚  Level 2:          â—     â—     â—                                                â”‚
â”‚                    â”‚     â”‚     â”‚                                                â”‚
â”‚  Level 3:          â—     â—     â—                                                â”‚
â”‚                                                                                  â”‚
â”‚  ìš©ë„:                                                                          â”‚
â”‚  1. Wake ì „íŒŒ ë°©í–¥ ì œì–´ (Level ì¦ê°€ ë°©í–¥ìœ¼ë¡œ)                                   â”‚
â”‚  2. Constraint í•´ê²° ìˆœì„œ ìµœì í™”                                                 â”‚
â”‚  3. Shock Propagation (ì¶©ê²© ì „íŒŒ)                                               â”‚
â”‚                                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 Level í• ë‹¹

```cpp
// Level í• ë‹¹ ì•Œê³ ë¦¬ì¦˜
void FPBDIslandManager::AssignLevels()
{
    // 1. Kinematic íŒŒí‹°í´: Level = 0
    for (FPBDIslandParticle* Node : Nodes)
    {
        if (!Node->Flags.bIsDynamic)
        {
            Node->Level = 0;
            Queue.Add(Node);
        }
    }

    // 2. BFSë¡œ Level ì „íŒŒ
    while (!Queue.IsEmpty())
    {
        FPBDIslandParticle* Node = Queue.Pop();

        for (FPBDIslandConstraint* Edge : Node->Edges)
        {
            FPBDIslandParticle* Other = Edge->GetOtherNode(Node);

            if (Other->Level < 0)  // ì•„ì§ í• ë‹¹ ì•ˆë¨
            {
                Other->Level = Node->Level + 1;
                Queue.Add(Other);
            }
        }
    }
}
```

---

## âš¡ ì„±ëŠ¥ ìµœì í™”

### Pool ê¸°ë°˜ ë©”ëª¨ë¦¬ ê´€ë¦¬

```cpp
// âœ… ì¢‹ì€ ì˜ˆ: TPoolBackedArray ì‚¬ìš©
TPoolBackedArray<FPBDIslandParticle> Nodes;
// - ë™ì  í• ë‹¹/í•´ì œ ì˜¤ë²„í—¤ë“œ ìµœì†Œí™”
// - Reuse/Trash íŒ¨í„´ìœ¼ë¡œ ë©”ëª¨ë¦¬ ì¬í™œìš©

// âŒ ë‚˜ìœ ì˜ˆ: ê°œë³„ í• ë‹¹
TArray<FPBDIslandParticle*> Nodes;
for (...)
{
    Nodes.Add(new FPBDIslandParticle());  // ë§¤ë²ˆ í™ í• ë‹¹
}
```

### Sleep ì„ê³„ê°’ íŠœë‹

```cpp
// ì„±ëŠ¥ ì¤‘ì‹œ (ë” ë¹¨ë¦¬ Sleep)
p.Chaos.Solver.Sleep.Defaults.SleepCounterThreshold 10
p.Chaos.Solver.Sleep.Defaults.LinearSleepThreshold 0.01

// ì •í™•ì„± ì¤‘ì‹œ (ë” ëŠ¦ê²Œ Sleep)
p.Chaos.Solver.Sleep.Defaults.SleepCounterThreshold 30
p.Chaos.Solver.Sleep.Defaults.LinearSleepThreshold 0.0001

// Partial Sleep í™œì„±í™” (ëŒ€ê·œëª¨ ìŠ¤íƒ)
p.Chaos.Solver.Sleep.PartialIslandSleep 1
p.Chaos.Solver.Sleep.PartialIslandSleep.MomentumPropagation 0.3
```

---

## ğŸ’¡ ë””ë²„ê¹… Tips

### CVars ë””ë²„ê·¸ ëª…ë ¹ì–´

```bash
# Sleep í™œì„±í™”/ë¹„í™œì„±í™”
p.Chaos.Solver.Sleep.Enabled 1

# Partial Island Sleep
p.Chaos.Solver.Sleep.PartialIslandSleep 1

# Sleep ì„ê³„ê°’ ì¡°ì •
p.Chaos.Solver.Sleep.Defaults.LinearSleepThreshold 0.001
p.Chaos.Solver.Sleep.Defaults.AngularSleepThreshold 0.0087
p.Chaos.Solver.Sleep.Defaults.SleepCounterThreshold 20

# Wake ì„¤ì •
p.Chaos.Solver.Sleep.PartialIslandSleep.LinearWakeThresholdMultiplier 10.0
p.Chaos.Solver.Sleep.PartialIslandSleep.MomentumPropagation 0.3

# Island ì‹œê°í™” (ì—ë””í„°)
p.Chaos.DebugDraw.Islands 1
```

### ì¼ë°˜ì ì¸ ë¬¸ì œ

| ë¬¸ì œ | ì›ì¸ | í•´ê²° |
|------|------|------|
| ì˜¤ë¸Œì íŠ¸ê°€ ì•ˆ Sleepë¨ | ì„ê³„ê°’ì´ ë„ˆë¬´ ë‚®ìŒ | LinearSleepThreshold ì¦ê°€ |
| ë„ˆë¬´ ë¹¨ë¦¬ Sleepë¨ | ì„ê³„ê°’ì´ ë„ˆë¬´ ë†’ìŒ | SleepCounterThreshold ì¦ê°€ |
| Wakeê°€ ì „íŒŒ ì•ˆë¨ | MomentumPropagation ë¹„í™œì„±í™” | ê°’ > 0 ì„¤ì • |
| ìŠ¤íƒì´ ë¶ˆì•ˆì • | Partial Sleep ì´ìŠˆ | bPartialIslandSleep ì¡°ì • |

---

## ğŸ”— ê´€ë ¨ ë¬¸ì„œ

- [Chaos_Complete_Architecture.md](Chaos_Complete_Architecture.md) - Chaos ì „ì²´ êµ¬ì¡°
- [Chaos_Threading_And_Synchronization.md](Chaos_Threading_And_Synchronization.md) - ìŠ¤ë ˆë”©
- [Chaos_Physics_Solver_And_Constraints_Deep_Dive.md](Chaos_Physics_Solver_And_Constraints_Deep_Dive.md) - Solver ìƒì„¸

---

## ğŸ“ ë²„ì „ ì´ë ¥

- **v1.0** (2025-12-09): ì´ˆê¸° ì‘ì„±
  - FPBDIslandManager êµ¬ì¡°
  - Sleep/Wake í”„ë¡œì„¸ìŠ¤ íë¦„
  - Partial Island Sleep
  - Island ë³‘í•©/ë¶„ë¦¬
  - Level System (Shock Propagation)
  - ì„±ëŠ¥ ìµœì í™” ê°€ì´ë“œ