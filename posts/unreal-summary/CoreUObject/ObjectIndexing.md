---
title: "μ¤λΈμ νΈ μΈλ±μ‹± μ‹μ¤ν… (Object Indexing System)"
date: "2025-11-21"
status: "stable"
project: "UnrealEngine"
lang: "ko"
category: "unreal-summary"
track: "CoreUObject"
tags: ["unreal", "CoreUObject"]
---
# μ¤λΈμ νΈ μΈλ±μ‹± μ‹μ¤ν… (Object Indexing System)

## π§­ κ°μ”

**FUObjectArray**λ” μ–Έλ¦¬μ–Ό μ—”μ§„μ λ¨λ“  UObjectλ¥Ό μ¤‘μ•™ μ§‘μ¤‘μ‹μΌλ΅ κ΄€λ¦¬ν•λ” κΈ€λ΅λ² μ¤λΈμ νΈ λ μ§€μ¤νΈλ¦¬μ…λ‹λ‹¤. λ¨λ“  UObjectλ” μƒμ„± μ‹ κ³ μ ν• μΈλ±μ¤λ¥Ό ν• λ‹Ήλ°›μ•„ μ΄ λ°°μ—΄μ— λ“±λ΅λλ©°, μ΄λ¥Ό ν†µν•΄ λΉ λ¥Έ μ¤λΈμ νΈ μ΅°ν, GC μ¶”μ , λ°λ³µ(iteration)μ΄ κ°€λ¥ν•©λ‹λ‹¤.

**ν•µμ‹¬ κµ¬μ„± μ”μ†:**
- **FUObjectArray** - κΈ€λ΅λ² μ¤λΈμ νΈ λ°°μ—΄ κ΄€λ¦¬μ
- **FChunkedFixedUObjectArray** - μ²­ν¬ κΈ°λ° λ™μ  λ°°μ—΄ (64K λ‹¨μ„)
- **FUObjectItem** - κ°λ³„ μ¤λΈμ νΈ λ©”νƒ€λ°μ΄ν„° (ν¬μΈν„°, ν”λκ·Έ, μ‹λ¦¬μ–Ό λ²νΈ)
- **ObjAvailableList** - μ¬μ‚¬μ© κ°€λ¥ν• λΉ μ¬λ΅― λ©λ΅
- **Disregard for GC Pool** - GC λ€μƒμ—μ„ μ μ™Έλλ” μκµ¬ μ¤λΈμ νΈ ν’€

**μ£Όμ” κΈ°λ¥:**
- O(1) μΈλ±μ¤ κΈ°λ° μ¤λΈμ νΈ μ΅°ν
- μƒμ„±/μ†λ©Έ μ΄λ²¤νΈ λ¦¬μ¤λ„ μ‹μ¤ν…
- GC μµμ ν™”λ¥Ό μ„ν• μκµ¬ μ¤λΈμ νΈ ν’€
- Weak Pointerλ¥Ό μ„ν• μ‹λ¦¬μ–Ό λ²νΈ κ΄€λ¦¬
- μ²­ν¬ κΈ°λ° λ©”λ¨λ¦¬ ν• λ‹Ή (λ©”λ¨λ¦¬ λ‹¨νΈν™” λ°©μ§€)
- ν¬μΈν„° μ••μ¶• (UE_PACK_FUOBJECT_ITEM μµμ…)

**λ¨λ“ μ„μΉ:** `Engine/Source/Runtime/CoreUObject/Public/UObject/UObjectArray.h`

**μ—”μ§„ λ²„μ „:** Unreal Engine 5.6.1 (2025λ…„ κΈ°μ¤€)

---

## π― μ„¤κ³„ μ² ν•™

### μ™ μ²­ν¬ κΈ°λ° λ°°μ—΄μΈκ°€?

μ–Έλ¦¬μ–Ό μ—”μ§„μ€ λ¨λ“  UObjectλ¥Ό λ‹¨μΌ μ—°μ† λ°°μ—΄μ΄ μ•„λ‹ **μ²­ν¬ κΈ°λ° λ°°μ—΄(Chunk-based Array)**λ΅ κ΄€λ¦¬ν•©λ‹λ‹¤. μ΄λ” λ‹¤μκ³Ό κ°™μ€ μ„¤κ³„ λ©ν‘λ¥Ό λ‹¬μ„±ν•κΈ° μ„ν•¨μ…λ‹λ‹¤:

**μ„¤κ³„ λ©ν‘:**
1. **λ©”λ¨λ¦¬ λ‹¨νΈν™” λ°©μ§€** - λ€κ·λ¨ μ—°μ† λ©”λ¨λ¦¬ ν• λ‹Ή μ‹¤ν¨ νν”Ό
2. **λ™μ  ν™•μ¥ ν¨μ¨μ„±** - λ°°μ—΄ ν¬κΈ° μ¦κ°€ μ‹ μ „μ²΄ λ³µμ‚¬ λ¶ν•„μ”
3. **μμΈ΅ κ°€λ¥ν• μ„±λ¥** - O(1) μ΅°ν, O(1) ν• λ‹Ή λ³΄μ¥
4. **μΊμ‹ μ§€μ—­μ„± μ μ§€** - μ²­ν¬ λ‚΄ μΈμ ‘ μ¤λΈμ νΈμ κ³µκ°„ μ§€μ—­μ„±
5. **ν”λ«νΌ λ…λ¦½μ„±** - κ°€μƒ λ©”λ¨λ¦¬ μ μ•½μ΄ λ‹¤λ¥Έ ν”λ«νΌ μ§€μ›

### μ•„ν‚¤ν…μ² λΉ„κµ

```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ λ‹¨μΌ μ—°μ† λ°°μ—΄ (Traditional Dynamic Array)                       β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚ μ¥μ :                                                            β”‚
β”‚  β… λ‹¨μν• κµ¬ν„                                                  β”‚
β”‚  β… μΈλ±μ¤ κ³„μ‚° λΉ λ¦„ (Array[Index])                              β”‚
β”‚  β… μ™„μ „ν• λ©”λ¨λ¦¬ μ—°μ†μ„±                                         β”‚
β”‚                                                                  β”‚
β”‚ λ‹¨μ :                                                            β”‚
β”‚  β ν™•μ¥ μ‹ μ „μ²΄ λ³µμ‚¬ ν•„μ” (O(N))                                β”‚
β”‚  β λ€κ·λ¨ μ—°μ† λ©”λ¨λ¦¬ ν• λ‹Ή μ‹¤ν¨ κ°€λ¥                            β”‚
β”‚  β λ©”λ¨λ¦¬ μ¬ν• λ‹Ή μ‹ ν¬μΈν„° λ¬΄ν¨ν™”                               β”‚
β”‚  β μµλ€ ν¬κΈ° μ ν• (μ—°μ† κ°€μƒ λ©”λ¨λ¦¬ κ³µκ°„)                        β”‚
β”‚                                                                  β”‚
β”‚ λ©”λ¨λ¦¬:                                                          β”‚
β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”                     β”‚
β”‚  β”‚ [Item0][Item1][Item2]...[ItemN]        β”‚ 1κ° ν° λΈ”λ΅         β”‚
β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”                     β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”

β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ μ²­ν¬ κΈ°λ° λ°°μ—΄ (Chunk-based Array - μ–Έλ¦¬μ–Ό λ°©μ‹)                 β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚ μ¥μ :                                                            β”‚
β”‚  β… ν™•μ¥ μ‹ μ²­ν¬λ§ μ¶”κ°€ (O(1))                                   β”‚
β”‚  β… μ‘μ€ ν¬κΈ° ν• λ‹Ή (64KB Γ— Nμ²­ν¬)                                β”‚
β”‚  β… κΈ°μ΅΄ ν¬μΈν„° μ μ§€ (μ²­ν¬ μ¬λ°°μΉ μ—†μ)                          β”‚
β”‚  β… μ‹¤μ§μ  λ¬΄μ ν• ν™•μ¥ (μ²­ν¬ μ¶”κ°€λ΅ ν•΄κ²°)                        β”‚
β”‚  β… μ²­ν¬ λ‚΄ μΊμ‹ μ§€μ—­μ„± μ°μ                                     β”‚
β”‚                                                                  β”‚
β”‚ λ‹¨μ :                                                            β”‚
β”‚  β μΈλ±μ¤ κ³„μ‚° λ³µμ΅ (λ‚λ—μ… 2ν)                                β”‚
β”‚  β μ²­ν¬ κ°„ λ©”λ¨λ¦¬ λ¶μ—°μ†                                        β”‚
β”‚  β μ²­ν¬ ν¬μΈν„° λ°°μ—΄ κ°„μ ‘ μ°Έμ΅°                                   β”‚
β”‚                                                                  β”‚
β”‚ λ©”λ¨λ¦¬:                                                          β”‚
β”‚  Chunk Pointer Array:                                           β”‚
β”‚  β”β”€β”€β”€β”¬β”€β”€β”€β”¬β”€β”€β”€β”¬β”€β”€β”€β”                                              β”‚
β”‚  β”‚ * β”‚ * β”‚ * β”‚ * β”‚  μ‘μ€ λ°°μ—΄ (ν¬μΈν„°λ§)                         β”‚
β”‚  β””β”€β”‚β”€β”΄β”€β”‚β”€β”΄β”€β”‚β”€β”΄β”€β”‚β”€β”                                              β”‚
β”‚    β”‚   β”‚   β”‚   β”‚                                                β”‚
β”‚    β†“   β†“   β†“   β†“                                                β”‚
β”‚  β”β”€β”€β”€β”β”β”€β”€β”€β”β”β”€β”€β”€β”β”β”€β”€β”€β”                                           β”‚
β”‚  β”‚65Kβ”‚β”‚65Kβ”‚β”‚65Kβ”‚β”‚65Kβ”‚  μ—¬λ¬ μ‘μ€ λΈ”λ΅ (κ° 64KB)                 β”‚
β”‚  β””β”€β”€β”€β”β””β”€β”€β”€β”β””β”€β”€β”€β”β””β”€β”€β”€β”                                           β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

### μ„±λ¥ νΉμ„± λΉ„κµ

| μ—°μ‚°                  | λ‹¨μΌ λ°°μ—΄    | μ²­ν¬ λ°°μ—΄    | μ–Έλ¦¬μ–Ό μ„ νƒ μ΄μ                 |
|-----------------------|--------------|--------------|--------------------------------|
| μΈλ±μ¤ μ΅°ν           | O(1) - λΉ λ¦„  | O(1) - μ•½κ°„ λλ¦Ό | λ‚λ—μ… 2ν μ¤λ²„ν—¤λ“ ν—μ© κ°€λ¥ |
| λ°°μ—΄ ν™•μ¥             | O(N) - λ³µμ‚¬  | O(1) - μ²­ν¬ μ¶”κ°€ | λ°νƒ€μ„ ν™•μ¥ λΉλ² β†’ μ¤‘μ”        |
| λ©”λ¨λ¦¬ ν• λ‹Ή           | μ‹¤ν¨ μ„ν—    | μ•μ •μ        | λ€κ·λ¨ κ²μ„μ—μ„ μ—°μ† ν• λ‹Ή μ‹¤ν¨ λ°©μ§€ |
| ν¬μΈν„° μ•μ •μ„±         | λ¶μ•μ •       | μ•μ •μ        | κΈ°μ΅΄ μΈλ±μ¤/ν¬μΈν„° μ ν¨μ„± μ μ§€ |
| μµλ€ ν¬κΈ°             | μ ν•μ        | μ‹¤μ§μ  λ¬΄μ ν• | 2M+ μ¤λΈμ νΈ μ§€μ› ν•„μ”         |
| μΊμ‹ ν¨μ¨             | μ°μ         | μ²­ν¬ λ‚΄ μ°μ  | μ²­ν¬ λ‚΄ μ§€μ—­μ„±μΌλ΅ μ¶©λ¶„         |

### μ‹¤μ  μ‚¬λ΅€: λ€κ·λ¨ κ²μ„

```
κ²μ„ μ‹λ‚λ¦¬μ¤: μ¤ν” μ›”λ“ κ²μ„, μ¤λΈμ νΈ 150λ§ κ°

[λ‹¨μΌ λ°°μ—΄ μ‚¬μ© μ‹]
- ν•„μ” λ©”λ¨λ¦¬: 150λ§ Γ— 32 bytes = 48 MB μ—°μ†
- λ¬Έμ :
  β€Ά 48MB μ—°μ† κ°€μƒ λ©”λ¨λ¦¬ ν• λ‹Ή μ‹¤ν¨ κ°€λ¥ (λ©”λ¨λ¦¬ λ‹¨νΈν™”)
  β€Ά ν™•μ¥ μ‹ μ „μ²΄ λ³µμ‚¬ (150λ§ Γ— 32 bytes μ΄λ™)
  β€Ά ν™•μ¥ μ¤‘ κ²μ„ ν”„λ¦¬μ¦ (μμ‹­ ms)

[μ²­ν¬ λ°°μ—΄ μ‚¬μ© μ‹]
- ν•„μ” λ©”λ¨λ¦¬: 23 μ²­ν¬ Γ— 2MB = 46 MB (λΉ„μ—°μ†)
- μ¥μ :
  β€Ά κ° μ²­ν¬ 2MBλ§ ν• λ‹Ή (μ‹¤ν¨ κ±°μ μ—†μ)
  β€Ά ν™•μ¥ μ‹ 1κ° μ²­ν¬λ§ μ¶”κ°€ (O(1), <1ms)
  β€Ά κ²μ„ν”λ μ΄ μ¤‘λ‹¨ μ—†μ
```

---

## π§± κµ¬μ΅°

### μ „μ²΄ μ•„ν‚¤ν…μ²

```
FUObjectArray (κΈ€λ΅λ² μ‹±κΈ€ν†¤)
    β”‚
    β”β”€β”€ FChunkedFixedUObjectArray ObjObjects
    β”‚       β”‚
    β”‚       β”β”€β”€ FUObjectItem** Objects (μ²­ν¬ ν¬μΈν„° λ°°μ—΄)
    β”‚       β”‚       β”‚
    β”‚       β”‚       β”β”€β”€ Chunk 0 [FUObjectItem Γ— 65536]
    β”‚       β”‚       β”β”€β”€ Chunk 1 [FUObjectItem Γ— 65536]
    β”‚       β”‚       β”β”€β”€ Chunk 2 [FUObjectItem Γ— 65536]
    β”‚       β”‚       β””β”€β”€ ...
    β”‚       β”‚
    β”‚       β”β”€β”€ NumElements (ν„μ¬ ν• λ‹Ήλ μ¤λΈμ νΈ μ)
    β”‚       β””β”€β”€ NumChunks (ν„μ¬ ν• λ‹Ήλ μ²­ν¬ μ)
    β”‚
    β”β”€β”€ TArray<int32> ObjAvailableList (λΉ μΈλ±μ¤ μ¤νƒ)
    β”‚
    β”β”€β”€ int32 MasterSerialNumber (μ‹λ¦¬μ–Ό λ²νΈ μƒμ„±κΈ°)
    β”‚
    β”β”€β”€ int32 MaxObjectsNotConsideredByGC (GC μ μ™Έ ν’€ ν¬κΈ°)
    β”‚
    β”β”€β”€ TArray<FUObjectCreateListener*> UObjectCreateListeners
    β”‚
    β””β”€β”€ TArray<FUObjectDeleteListener*> UObjectDeleteListeners
```

### μΈλ±μ¤ λ²”μ„ κµ¬λ¶„

```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚                    FUObjectArray                         β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚  Index 0 ~ MaxObjectsNotConsideredByGC - 1              β”‚
β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”               β”‚
β”‚  β”‚  Disregard for GC Pool               β”‚               β”‚
β”‚  β”‚  (μκµ¬ μ¤λΈμ νΈ - GC μ¤μΊ” μ• ν•¨)      β”‚               β”‚
β”‚  β”‚  - UClass, CDO, Native μ¤λΈμ νΈ      β”‚               β”‚
β”‚  β”‚  - Cook νƒ€μ„μ—λ§ ν™μ„±ν™” κ°€λ¥         β”‚               β”‚
β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”               β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚  Index MaxObjectsNotConsideredByGC ~ NumElements - 1    β”‚
β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”               β”‚
β”‚  β”‚  Regular GC Pool                     β”‚               β”‚
β”‚  β”‚  (μΌλ° μ¤λΈμ νΈ - GC μ¤μΊ” λ€μƒ)      β”‚               β”‚
β”‚  β”‚  - κ²μ„ν”λ μ΄ μ¤λΈμ νΈ               β”‚               β”‚
β”‚  β”‚  - μ—μ…‹ μΈμ¤ν„΄μ¤                     β”‚               β”‚
β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”               β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

**Disregard for GC μµμ ν™”:**
- μ΄κΈ° λ΅λ“ μ‹μ—λ§ ν• λ‹Ή (μ—”μ§„ μ΄κΈ°ν™”, λ„¤μ΄ν‹°λΈ ν΄λμ¤ λ“±)
- GCκ°€ μ΄ λ²”μ„λ¥Ό μ¤μΊ”ν•μ§€ μ•μ•„ μ„±λ¥ ν–¥μƒ
- `CloseDisregardForGC()` νΈμ¶ ν›„ μΌλ° ν’€λ§ μ‚¬μ©
- ν”„λ΅μ νΈ μ„¤μ •μ—μ„ ν¬κΈ° μ΅°μ • κ°€λ¥

---

## π”„ κ³„μΈµλ³„ μ—­ν•  λ¶„λ¦¬

FUObjectArray μ‹μ¤ν…μ€ 3κ° κ³„μΈµμΌλ΅ μ±…μ„μ„ λ…ν™•ν λ¶„λ¦¬ν•©λ‹λ‹¤:

### κ³„μΈµ κµ¬μ΅° λ° λ°μ΄ν„° νλ¦„

```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚                       FUObjectArray                              β”‚
β”‚                  (κΈ€λ΅λ² κ΄€λ¦¬ κ³„μΈµ)                               β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚ μ±…μ„:                                                            β”‚
β”‚  β€Ά μΈλ±μ¤ ν• λ‹Ή/ν•΄μ  μ •μ±… (λΉ μ¬λ΅― μ¬μ‚¬μ© vs μƒ ν• λ‹Ή)             β”‚
β”‚  β€Ά μ‹λ¦¬μ–Ό λ²νΈ μƒμ„± (Weak Pointer λ¬΄ν¨ν™”)                        β”‚
β”‚  β€Ά μƒμ„±/μ†λ©Έ μ΄λ²¤νΈ λ¦¬μ¤λ„ κ΄€λ¦¬                                  β”‚
β”‚  β€Ά GC ν’€ λ¶„λ¦¬ μ •μ±… (Disregard for GC)                            β”‚
β”‚  β€Ά μ¤λ λ“ μ•μ „μ„± (Critical Section)                              β”‚
β”‚                                                                  β”‚
β”‚ λ°μ΄ν„°:                                                          β”‚
β”‚  β€Ά TArray<int32> ObjAvailableList  β† λΉ μΈλ±μ¤ μ¤νƒ              β”‚
β”‚  β€Ά int32 MasterSerialNumber        β† μ‹λ¦¬μ–Ό λ²νΈ μΉ΄μ΄ν„°          β”‚
β”‚  β€Ά int32 MaxObjectsNotConsideredByGC                             β”‚
β”‚  β€Ά TArray<Listener*> CreateListeners, DeleteListeners            β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                           β”‚ μ„μ„ (delegate)
                           β†“
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚                FChunkedFixedUObjectArray                         β”‚
β”‚                   (μ €μ¥μ† κ³„μΈµ)                                   β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚ μ±…μ„:                                                            β”‚
β”‚  β€Ά μ²­ν¬ κΈ°λ° λ©”λ¨λ¦¬ λ μ΄μ•„μ›ƒ κ΄€λ¦¬                                β”‚
β”‚  β€Ά μΈλ±μ¤ β†’ FUObjectItem* ν¬μΈν„° λ³€ν™                            β”‚
β”‚  β€Ά μ²­ν¬ λ™μ  ν™•μ¥ (μ¤λ λ“ μ•μ „)                                  β”‚
β”‚  β€Ά λ©”λ¨λ¦¬ ν• λ‹Ή μ „λµ (μ‚¬μ „ ν• λ‹Ή vs μ§€μ—° ν• λ‹Ή)                     β”‚
β”‚                                                                  β”‚
β”‚ λ°μ΄ν„°:                                                          β”‚
β”‚  β€Ά FUObjectItem** Objects      β† μ²­ν¬ ν¬μΈν„° λ°°μ—΄                β”‚
β”‚  β€Ά int32 NumChunks, MaxChunks  β† μ²­ν¬ λ©”νƒ€λ°μ΄ν„°                 β”‚
β”‚  β€Ά int32 NumElements, MaxElements                                β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                           β”‚ μ²­ν¬ λ‚΄ μΈλ±μ‹±
                           β†“
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚                      FUObjectItem                                β”‚
β”‚                   (λ©”νƒ€λ°μ΄ν„° κ³„μΈµ)                               β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚ μ±…μ„:                                                            β”‚
β”‚  β€Ά κ°λ³„ UObject λ©”νƒ€λ°μ΄ν„° μ €μ¥                                  β”‚
β”‚  β€Ά ν¬μΈν„° μ••μ¶•/λ³µμ› (μ„ νƒμ )                                     β”‚
β”‚  β€Ά ν”λκ·Έ κ΄€λ¦¬ (Garbage, Unreachable, PendingKill)               β”‚
β”‚  β€Ά ν΄λ¬μ¤ν„° μ¶”μ  (GC μµμ ν™”)                                     β”‚
β”‚  β€Ά Weak Pointer κ²€μ¦μ„ μ„ν• μ‹λ¦¬μ–Ό λ²νΈ                          β”‚
β”‚                                                                  β”‚
β”‚ λ°μ΄ν„°:                                                          β”‚
β”‚  β€Ά UObjectBase* Object (λλ” μ••μ¶• ν¬μΈν„°)                        β”‚
β”‚  β€Ά int32 Flags, ClusterRootIndex, SerialNumber, RefCount         β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

### κ³„μΈµ κ°„ ν‘λ ¥ μμ‹

#### 1. μ¤λΈμ νΈ ν• λ‹Ή μ‹ ν‘λ ¥

```
[μ‚¬μ©μ μ½”λ“]
    β”‚
    β”‚ NewObject<UMyClass>()
    β†“
[UObjectBase::UObjectBase μƒμ„±μ]
    β”‚
    β”‚ GUObjectArray.AllocateUObjectIndex(this)
    β†“
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ FUObjectArray (μ •μ±… κ²°μ •)                         β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚ 1. μΈλ±μ¤ μ„ νƒ λ΅μ§:                              β”‚
β”‚    if (AlreadyAllocatedIndex >= 0)                β”‚
β”‚        Index = AlreadyAllocatedIndex  β† μ‚¬μ „ ν• λ‹Ή β”‚
β”‚    else if (ObjAvailableList.Num() > 0)           β”‚
β”‚        Index = ObjAvailableList.Pop() β† μ¬μ‚¬μ©    β”‚
β”‚    else                                           β”‚
β”‚        Index = ObjObjects.AddSingle() β† μƒ ν• λ‹Ή   β”‚
β”‚                                                   β”‚
β”‚ 2. μ‹λ¦¬μ–Ό λ²νΈ μƒμ„±:                              β”‚
β”‚    SerialNumber = ++MasterSerialNumber            β”‚
β”‚                                                   β”‚
β”‚ 3. λ¦¬μ¤λ„ μ•λ¦Ό:                                   β”‚
β”‚    for (Listener : CreateListeners)               β”‚
β”‚        Listener->NotifyCreated(Object, Index)     β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                 β”‚
                 β”‚ ObjObjects.ExpandChunksToIndex(Index)
                 β”‚ ObjObjects.GetObjectPtr(Index)
                 β†“
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ FChunkedFixedUObjectArray (μ²­ν¬ κ΄€λ¦¬)             β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚ 1. μ²­ν¬ ν™•μ¥ (ν•„μ” μ‹):                           β”‚
β”‚    ChunkIndex = Index / 65536                     β”‚
β”‚    if (ChunkIndex >= NumChunks)                   β”‚
β”‚        NewChunk = new FUObjectItem[65536]         β”‚
β”‚        Objects[NumChunks] = NewChunk              β”‚
β”‚        NumChunks++                                β”‚
β”‚                                                   β”‚
β”‚ 2. ν¬μΈν„° κ³„μ‚°:                                   β”‚
β”‚    ChunkIndex = Index / 65536                     β”‚
β”‚    WithinChunkIndex = Index % 65536               β”‚
β”‚    return Objects[ChunkIndex] + WithinChunkIndex  β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                 β”‚
                 β”‚ return FUObjectItem*
                 β†“
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ FUObjectItem (λ©”νƒ€λ°μ΄ν„° μ΄κΈ°ν™”)                  β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚ SetObject(Object)                                 β”‚
β”‚ SetFlags(InitialFlags)                            β”‚
β”‚ SerialNumber = μƒ_μ‹λ¦¬μ–Ό_λ²νΈ                     β”‚
β”‚ ClusterRootIndex = 0                              β”‚
β”‚ RefCount = 0                                      β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                 β”‚
                 β”‚ μ΄κΈ°ν™” μ™„λ£
                 β†“
[UObjectBase]
    Object->InternalIndex = Index  β† μΈλ±μ¤ μ €μ¥
```

#### 2. μΈλ±μ¤ μ΅°ν μ‹ ν‘λ ¥

```
[GC λλ” λ°λ³µμ]
    β”‚
    β”‚ GUObjectArray.IndexToObject(12345)
    β†“
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ FUObjectArray (λ‹¨μ μ„μ„)                         β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚ return ObjObjects.GetObjectPtr(Index)             β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                 β”‚
                 β†“
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ FChunkedFixedUObjectArray (ν¬μΈν„° κ³„μ‚°)           β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚ ChunkIndex = 12345 / 65536 = 0                    β”‚
β”‚ WithinChunkIndex = 12345 % 65536 = 12345          β”‚
β”‚                                                   β”‚
β”‚ Chunk = Objects[0]  β† μ²« λ²μ§Έ μ²­ν¬                β”‚
β”‚ return Chunk + 12345                              β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                 β”‚
                 β”‚ return FUObjectItem*
                 β†“
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ FUObjectItem (λ°μ΄ν„° μ κ³µ)                        β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚ GetObject() β†’ UObjectBase* λ°ν™                   β”‚
β”‚ GetFlags() β†’ EInternalObjectFlags λ°ν™            β”‚
β”‚ SerialNumber β†’ Weak Pointer κ²€μ¦μ©                β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

#### 3. μ¤λΈμ νΈ ν•΄μ  μ‹ ν‘λ ¥

```
[GC]
    β”‚
    β”‚ Object->MarkAsGarbage()
    β”‚ ... GC μ™„λ£ ν›„
    β”‚ GUObjectArray.FreeUObjectIndex(Object)
    β†“
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ FUObjectArray (μ •λ¦¬ μ •μ±…)                         β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚ 1. λ¦¬μ¤λ„ μ•λ¦Ό:                                   β”‚
β”‚    for (Listener : DeleteListeners)               β”‚
β”‚        Listener->NotifyDeleted(Object, Index)     β”‚
β”‚                                                   β”‚
β”‚ 2. Weak Pointer λ¬΄ν¨ν™”:                           β”‚
β”‚    ObjectItem->SerialNumber = 0  β† λ¨λ‘ λ¬΄ν¨ν™”    β”‚
β”‚                                                   β”‚
β”‚ 3. μΈλ±μ¤ μ¬ν™μ© λ“±λ΅:                            β”‚
β”‚    ObjAvailableList.Push(Index) β† LIFO μ¤νƒ       β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                 β”‚
                 β”‚ ObjObjects.GetObjectPtr(Index)
                 β†“
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ FChunkedFixedUObjectArray (μ„μΉ μ κ³µ)             β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚ return Objects[Index / 65536] + (Index % 65536)   β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                 β”‚
                 β†“
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ FUObjectItem (ν΄λ¦¬μ–΄)                             β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚ SetObject(nullptr)                                β”‚
β”‚ SetFlags(None)                                    β”‚
β”‚ SerialNumber = 0                                  β”‚
β”‚ ClusterRootIndex = 0                              β”‚
β”‚ RefCount = 0                                      β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                 β”‚
                 β”‚ μ¬λ΅― λΉ„μ–΄ μμ (μ¬μ‚¬μ© κ°€λ¥)
                 β†“
[ObjAvailableList]
    λ‹¤μ ν• λ‹Ή μ‹ μ΄ μΈλ±μ¤ μ¬μ‚¬μ©λ¨
```

### μ±…μ„ λ¶„λ¦¬μ μ΄μ 

| κ³„μΈµ                       | λ³€κ²½ μν–¥ λ²”μ„            | λ…λ¦½μ  μµμ ν™” κ°€λ¥ μ—¬λ¶€    |
|----------------------------|---------------------------|----------------------------|
| FUObjectArray              | μ •μ±… λ³€κ²½ (μ: FIFO β†’ LIFO) | β… μ €μ¥μ† κ³„μΈµ μν–¥ μ—†μ   |
| FChunkedFixedUObjectArray  | μ²­ν¬ ν¬κΈ°, ν• λ‹Ή μ „λµ λ³€κ²½  | β… μ •μ±…/λ©”νƒ€λ°μ΄ν„° μν–¥ μ—†μ |
| FUObjectItem               | μ••μ¶• ν™μ„±ν™”, ν•„λ“ μ¶”κ°€     | β… μƒμ„ κ³„μΈµ μμ • μµμ†ν™”   |

---

## π§© ν•µμ‹¬ μ»΄ν¬λ„νΈ

### 1. FUObjectItem - μ¤λΈμ νΈ λ©”νƒ€λ°μ΄ν„°

```cpp
struct FUObjectItem
{
    // UObject ν¬μΈν„° (μ••μ¶• κ°€λ¥)
    UObjectBase* Object;          // μ‹¤μ  UObject ν¬μΈν„°

    // λ‚΄λ¶€ ν”λκ·Έ (EInternalObjectFlags)
    int32 Flags;                  // Garbage, Unreachable, PendingKill λ“±

    // ν΄λ¬μ¤ν„° κ΄€λ¦¬
    int32 ClusterRootIndex;       // ν΄λ¬μ¤ν„° λ£¨νΈ μΈλ±μ¤ λλ” μ†μ μ μΈλ±μ¤

    // Weak Pointer κ΄€λ¦¬
    int32 SerialNumber;           // Weak Pointer λ¬΄ν¨ν™”λ¥Ό μ„ν• μ‹λ¦¬μ–Ό λ²νΈ

    // μ°Έμ΅° μΉ΄μ΄νΈ
    int32 RefCount;               // μ†λ©Έ λ°©μ§€λ¥Ό μ„ν• μ°Έμ΅° μΉ΄μ΄νΈ

#if UE_WITH_REMOTE_OBJECT_HANDLE
    FRemoteObjectId RemoteId;     // λ¶„μ‚° μ‹μ¤ν…μ© κΈ€λ΅λ² ID
#endif
};
```

#### ν¬μΈν„° μ••μ¶• (UE_PACK_FUOBJECT_ITEM)

**μΌλ° λ¨λ“ (μ••μ¶• μ—†μ):**
```cpp
// 64λΉ„νΈ ν¬μΈν„° κ·Έλ€λ΅ μ €μ¥
union {
    UObjectBase* Object;  // 8 bytes
};
```

**μ••μ¶• λ¨λ“ (ν™μ„±ν™” μ‹):**
```cpp
// ν¬μΈν„°λ¥Ό 32λΉ„νΈ + Flags μƒμ„ λΉ„νΈμ— λ‚λ„μ–΄ μ €μ¥
// UObjectλ” 8λ°”μ΄νΈ μ •λ ¬ β†’ ν•μ„ 3λΉ„νΈλ” ν•­μƒ 0
// 45λΉ„νΈ ν¬μΈν„° = 32λΉ„νΈ(ObjectPtrLow) + 13λΉ„νΈ(Flags μƒμ„)

union {
    uint32 ObjectPtrLow;  // ν¬μΈν„° ν•μ„ 32λΉ„νΈ (3λΉ„νΈ shift)
};
int32 Flags;              // μƒμ„ 13λΉ„νΈμ— ν¬μΈν„° μƒμ„ λΉ„νΈ ν¬ν•¨

// λ””μ½”λ”©:
uintptr_t Obj = (Flags & PtrMask) << 35 | ObjectPtrLow << 3;
UObjectBase* Object = (UObjectBase*)Obj;
```

**μ••μ¶• μ΄μ :**
- λ©”λ¨λ¦¬ μ μ•½: FUObjectItem ν¬κΈ° κ°μ† (8 bytes β†’ 4 bytes ν¬μΈν„° λ¶€λ¶„)
- μΊμ‹ ν¨μ¨: λ” λ§μ€ FUObjectItemμ΄ μΊμ‹ λΌμΈμ— fit
- μ£Όμ† κ³µκ°„: 45λΉ„νΈ = 32TB κ°€μƒ μ£Όμ† κ³µκ°„ (μ¶©λ¶„ν•¨)

### 2. FChunkedFixedUObjectArray - μ²­ν¬ κΈ°λ° λ°°μ—΄

```cpp
class FChunkedFixedUObjectArray
{
    enum { NumElementsPerChunk = 64 * 1024 };  // 65,536 μ¤λΈμ νΈ/μ²­ν¬

    FUObjectItem** Objects;           // μ²­ν¬ ν¬μΈν„° λ°°μ—΄
    int32 NumChunks;                  // ν„μ¬ μ²­ν¬ μ
    int32 MaxChunks;                  // μµλ€ μ²­ν¬ μ
    int32 NumElements;                // ν„μ¬ μ¤λΈμ νΈ μ
    int32 MaxElements;                // μµλ€ μ¤λΈμ νΈ μ
};
```

#### μ²­ν¬ ν• λ‹Ή μ „λµ

**μ—”μ§„ μ΄κΈ°ν™” μ‹:**
```cpp
// ν”„λ΅μ νΈ μ„¤μ •μ—μ„ μµλ€ μ¤λΈμ νΈ μ κ³„μ‚°
MaxUObjects = GetMaxObjectCount();  // μ: 2,097,152 (2M)

// ν•„μ”ν• μ²­ν¬ μ κ³„μ‚°
MaxChunks = MaxUObjects / 65536 + 1;  // μ: 32 μ²­ν¬

// μ²­ν¬ ν¬μΈν„° λ°°μ—΄ ν• λ‹Ή
Objects = new FUObjectItem*[MaxChunks];
FMemory::Memzero(Objects, sizeof(FUObjectItem*) * MaxChunks);

// μµμ…: λ¨λ“  μ²­ν¬λ¥Ό μ—°μ† λ©”λ¨λ¦¬λ΅ μ‚¬μ „ ν• λ‹Ή
if (bPreAllocateObjectArray)
{
    PreAllocatedObjects = new FUObjectItem[MaxElements];
    for (int32 i = 0; i < MaxChunks; ++i)
    {
        Objects[i] = PreAllocatedObjects + i * NumElementsPerChunk;
    }
}
```

**λ°νƒ€μ„ μ²­ν¬ ν™•μ¥:**
```cpp
void ExpandChunksToIndex(int32 Index)
{
    int32 ChunkIndex = Index / 65536;

    while (ChunkIndex >= NumChunks)
    {
        // μƒ μ²­ν¬ ν• λ‹Ή
        FUObjectItem* NewChunk = new FUObjectItem[65536];

        // μ›μμ  κµν™ (μ¤λ λ“ μ•μ „)
        if (!FPlatformAtomics::InterlockedCompareExchangePointer(
            (void**)&Objects[NumChunks], NewChunk, nullptr))
        {
            NumChunks++;
        }
    }
}
```

#### μΈλ±μ¤ β†’ ν¬μΈν„° λ³€ν™ (GetObjectPtr)

```cpp
FUObjectItem* GetObjectPtr(int32 Index)
{
    // μ²­ν¬ μΈλ±μ¤ κ³„μ‚°
    const uint32 ChunkIndex = Index / 65536;      // μƒμ„ λΉ„νΈ
    const uint32 WithinChunkIndex = Index % 65536; // ν•μ„ 16λΉ„νΈ

    // μ²­ν¬ κ°€μ Έμ¤κΈ°
    FUObjectItem* Chunk = Objects[ChunkIndex];

    // μ²­ν¬ λ‚΄ μ¤ν”„μ…‹
    return Chunk + WithinChunkIndex;
}
```

**μ„±λ¥ νΉμ„±:**
- **μ΅°ν:** O(1) - λ‚λ—μ… 2ν, λ°°μ—΄ μΈλ±μ‹± 2ν
- **ν™•μ¥:** μ²­ν¬ λ‹¨μ„ ν• λ‹Ή - μ—°μ† λ©”λ¨λ¦¬ μ¬ν• λ‹Ή λ¶ν•„μ”
- **μΊμ‹:** μΈμ ‘ν• μ¤λΈμ νΈλ” κ°™μ€ μ²­ν¬μ— β†’ κ³µκ°„ μ§€μ—­μ„± μ°μ

### 3. FUObjectArray - κΈ€λ΅λ² κ΄€λ¦¬μ

```cpp
class FUObjectArray
{
    // λ©”μΈ μ¤λΈμ νΈ λ°°μ—΄
    FChunkedFixedUObjectArray ObjObjects;

    // λΉ μΈλ±μ¤ μ¤νƒ (LIFO)
    TArray<int32> ObjAvailableList;

    // μ‹λ¦¬μ–Ό λ²νΈ μƒμ„±κΈ°
    int32 MasterSerialNumber;

    // GC μµμ ν™”
    int32 MaxObjectsNotConsideredByGC;  // Disregard for GC ν’€ ν¬κΈ°
    bool OpenForDisregardForGC;         // ν’€μ΄ μ—΄λ ¤μλ”μ§€

    // μ΄λ²¤νΈ λ¦¬μ¤λ„
    TArray<FUObjectCreateListener*> UObjectCreateListeners;
    TArray<FUObjectDeleteListener*> UObjectDeleteListeners;

    // μ¤λ λ“ μ•μ „μ„±
    FTransactionallySafeCriticalSection CriticalSection;
};
```

---

## π’΅ μ£Όμ” μ—°μ‚°

### μ¤λΈμ νΈ ν• λ‹Ή (AllocateUObjectIndex)

```cpp
void FUObjectArray::AllocateUObjectIndex(
    UObjectBase* Object,
    EInternalObjectFlags InitialFlags,
    int32 AlreadyAllocatedIndex = -1,
    int32 SerialNumber = 0)
{
    FScopeLock Lock(&CriticalSection);

    int32 Index;

    // 1. μΈλ±μ¤ μ„ νƒ
    if (AlreadyAllocatedIndex >= 0)
    {
        // λ―Έλ¦¬ ν• λ‹Ήλ μΈλ±μ¤ μ‚¬μ©
        Index = AlreadyAllocatedIndex;
    }
    else if (ObjAvailableList.Num() > 0)
    {
        // λΉ μ¬λ΅― μ¬μ‚¬μ© (LIFO)
        Index = ObjAvailableList.Pop();
    }
    else
    {
        // μƒ μ¬λ΅― ν• λ‹Ή
        Index = ObjObjects.AddSingle();
    }

    // 2. μ²­ν¬ ν™•μ¥ (ν•„μ”μ‹)
    ObjObjects.ExpandChunksToIndex(Index);

    // 3. FUObjectItem μ΄κΈ°ν™”
    FUObjectItem* ObjectItem = ObjObjects.GetObjectPtr(Index);
    ObjectItem->SetObject(Object);
    ObjectItem->SetFlags(InitialFlags);
    ObjectItem->ClusterRootIndex = 0;
    ObjectItem->RefCount = 0;

    // 4. μ‹λ¦¬μ–Ό λ²νΈ ν• λ‹Ή
    if (SerialNumber == 0)
    {
        ObjectItem->SerialNumber = ++MasterSerialNumber;
    }
    else
    {
        ObjectItem->SerialNumber = SerialNumber;
    }

    // 5. μ¤λΈμ νΈμ— μΈλ±μ¤ μ €μ¥
    Object->InternalIndex = Index;

    // 6. λ¦¬μ¤λ„ μ•λ¦Ό
    for (FUObjectCreateListener* Listener : UObjectCreateListeners)
    {
        Listener->NotifyUObjectCreated(Object, Index);
    }
}
```

**μΈλ±μ¤ μ„ νƒ μ°μ„ μμ„:**
1. **λ―Έλ¦¬ ν• λ‹Ήλ μΈλ±μ¤** (μ—λ””ν„° μ–Έλ‘/λ¦¬λ‘, λ„¤νΈμ›ν¬ λ¦¬ν”λ¦¬μΌ€μ΄μ…)
2. **ObjAvailableList** (λΉ μ¬λ΅― μ¬μ‚¬μ© - λ©”λ¨λ¦¬ μ μ•½)
3. **μƒ μ¬λ΅―** (λ°°μ—΄ λμ— μ¶”κ°€)

### μ¤λΈμ νΈ ν•΄μ  (FreeUObjectIndex)

```cpp
void FUObjectArray::FreeUObjectIndex(UObjectBase* Object)
{
    FScopeLock Lock(&CriticalSection);

    int32 Index = Object->InternalIndex;
    FUObjectItem* ObjectItem = ObjObjects.GetObjectPtr(Index);

    // 1. λ¦¬μ¤λ„ μ•λ¦Ό
    for (FUObjectDeleteListener* Listener : UObjectDeleteListeners)
    {
        Listener->NotifyUObjectDeleted(Object, Index);
    }

    // 2. Weak Pointer λ¬΄ν¨ν™”
    ResetSerialNumber(Object);

    // 3. FUObjectItem ν΄λ¦¬μ–΄
    ObjectItem->SetObject(nullptr);
    ObjectItem->SetFlags(EInternalObjectFlags::None);
    ObjectItem->ClusterRootIndex = 0;
    ObjectItem->SerialNumber = 0;
    ObjectItem->RefCount = 0;

    // 4. λΉ μ¬λ΅― λ©λ΅μ— μ¶”κ°€
    ObjAvailableList.Push(Index);
}
```

**μ‹λ¦¬μ–Ό λ²νΈ λ¦¬μ…‹:**
```cpp
void FUObjectArray::ResetSerialNumber(UObjectBase* Object)
{
    FUObjectItem* ObjectItem = ObjObjects.GetObjectPtr(Object->InternalIndex);

    // μ‹λ¦¬μ–Ό λ²νΈλ¥Ό 0μΌλ΅ μ„¤μ •
    // β†’ λ¨λ“  TWeakObjectPtrκ°€ μλ™μΌλ΅ λ¬΄ν¨ν™”λ¨
    ObjectItem->SerialNumber = 0;
}
```

### Disregard for GC ν’€ κ΄€λ¦¬

```cpp
// μ—”μ§„ μ΄κΈ°ν™” μ‹
void FUObjectArray::AllocateObjectPool(
    int32 MaxUObjects,
    int32 MaxObjectsNotConsideredByGC,
    bool bPreAllocateObjectArray)
{
    // μ²­ν¬ λ°°μ—΄ ν• λ‹Ή
    ObjObjects.PreAllocate(MaxUObjects, bPreAllocateObjectArray);

    // GC μ μ™Έ ν’€ ν¬κΈ° μ„¤μ •
    this->MaxObjectsNotConsideredByGC = MaxObjectsNotConsideredByGC;
    OpenForDisregardForGC = true;
}

// μ΄κΈ° λ΅λ“ μ™„λ£ ν›„
void FUObjectArray::CloseDisregardForGC()
{
    OpenForDisregardForGC = false;

    // μ΄μ  λ¨λ“  μƒ μ¤λΈμ νΈλ” GC λ€μƒ
    // Index >= MaxObjectsNotConsideredByGC λ²”μ„μ— ν• λ‹Ήλ¨
}

// ν’€ μ¬κ°λ°© (μ¬λ™μ΄ μ¶©λ¶„ν• κ²½μ°)
void FUObjectArray::OpenDisregardForGC()
{
    if (ObjObjects.Num() < MaxObjectsNotConsideredByGC)
    {
        OpenForDisregardForGC = true;
    }
}

// GC μµμ ν™” λΉ„ν™μ„±ν™”
void FUObjectArray::DisableDisregardForGC()
{
    MaxObjectsNotConsideredByGC = 0;
    OpenForDisregardForGC = false;
}
```

**GC μ„±λ¥ μν–¥:**
```cpp
// GC λ§ν¬ λ‹¨κ³„
void MarkPhase()
{
    // Disregard for GC ν’€μ€ μ¤μΊ” μ• ν•¨
    for (int32 Index = MaxObjectsNotConsideredByGC;
         Index < ObjObjects.Num();
         ++Index)
    {
        FUObjectItem* Item = ObjObjects.GetObjectPtr(Index);
        if (Item->GetObject())
        {
            // GC λ§ν‚Ή...
        }
    }
}
```

---

## β±οΈ λ°νƒ€μ„ λ™μ‘ μ‹ν€€μ¤

### 1. μ¤λΈμ νΈ ν• λ‹Ή μ „μ²΄ νλ¦„

μ™„μ „ν• μ¤λΈμ νΈ μƒμ„±λ¶€ν„° μΈλ±μ¤ ν• λ‹ΉκΉμ§€μ μ‹ν€€μ¤:

```
β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”
νƒ€μ„λΌμΈ: μ¤λΈμ νΈ μƒμ„± β†’ μΈλ±μ¤ ν• λ‹Ή β†’ λ¦¬μ¤λ„ μ•λ¦Ό
β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”

[κ²μ„ μ½”λ“]              [UObjectBase]      [FUObjectArray]     [FChunkedArray]    [FUObjectItem]
     β”‚                        β”‚                    β”‚                    β”‚                 β”‚
     β”‚ NewObject<AActor>()    β”‚                    β”‚                    β”‚                 β”‚
     β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€>β”‚                    β”‚                    β”‚                 β”‚
     β”‚                        β”‚                    β”‚                    β”‚                 β”‚
     β”‚                        β”‚ UObjectBase()      β”‚                    β”‚                 β”‚
     β”‚                        β”‚ μƒμ„±μ νΈμ¶        β”‚                    β”‚                 β”‚
     β”‚                        β”‚                    β”‚                    β”‚                 β”‚
     β”‚                        β”‚ AllocateIndex(this)β”‚                    β”‚                 β”‚
     β”‚                        β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€>β”‚                    β”‚                 β”‚
     β”‚                        β”‚                    β”‚                    β”‚                 β”‚
     β”‚                        β”‚                    β”‚ [Lock Critical Section]              β”‚
     β”‚                        β”‚                    β”‚                    β”‚                 β”‚
     β”‚                        β”‚                    β”‚ λ‹¨κ³„ 1: μΈλ±μ¤ μ„ νƒ κ²°μ •              β”‚
     β”‚                        β”‚                    β”‚ β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”             β”‚
     β”‚                        β”‚                    β”‚ β”‚ ObjAvailableList    β”‚             β”‚
     β”‚                        β”‚                    β”‚ β”‚ [42, 37, 15]        β”‚             β”‚
     β”‚                        β”‚                    β”‚ β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”             β”‚
     β”‚                        β”‚                    β”‚ if (Num() > 0)         β”‚             β”‚
     β”‚                        β”‚                    β”‚   Index = Pop() β†’ 15   β”‚             β”‚
     β”‚                        β”‚                    β”‚                        β”‚             β”‚
     β”‚                        β”‚                    β”‚ λ‹¨κ³„ 2: μ²­ν¬ ν™•μ¥ ν•„μ”? β”‚             β”‚
     β”‚                        β”‚                    β”‚ ExpandChunksToIndex(15)β”‚             β”‚
     β”‚                        β”‚                    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€>β”‚             β”‚
     β”‚                        β”‚                    β”‚                        β”‚             β”‚
     β”‚                        β”‚                    β”‚                        β”‚ ChunkIndex = 15/65536 = 0
     β”‚                        β”‚                    β”‚                        β”‚ Already exists? YES
     β”‚                        β”‚                    β”‚                        β”‚             β”‚
     β”‚                        β”‚                    β”‚<β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤             β”‚
     β”‚                        β”‚                    β”‚ OK (μ²­ν¬ μ΅΄μ¬)         β”‚             β”‚
     β”‚                        β”‚                    β”‚                        β”‚             β”‚
     β”‚                        β”‚                    β”‚ λ‹¨κ³„ 3: ν¬μΈν„° νλ“     β”‚             β”‚
     β”‚                        β”‚                    β”‚ GetObjectPtr(15)       β”‚             β”‚
     β”‚                        β”‚                    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€>β”‚             β”‚
     β”‚                        β”‚                    β”‚                        β”‚             β”‚
     β”‚                        β”‚                    β”‚                        β”‚ ChunkIndex = 0
     β”‚                        β”‚                    β”‚                        β”‚ WithinChunk = 15
     β”‚                        β”‚                    β”‚                        β”‚ Ptr = Objects[0] + 15
     β”‚                        β”‚                    β”‚                        β”‚             β”‚
     β”‚                        β”‚                    β”‚<β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤             β”‚
     β”‚                        β”‚                    β”‚ FUObjectItem* λ°ν™     β”‚             β”‚
     β”‚                        β”‚                    β”‚                        β”‚             β”‚
     β”‚                        β”‚                    β”‚ λ‹¨κ³„ 4: λ©”νƒ€λ°μ΄ν„° μ΄κΈ°ν™”            β”‚
     β”‚                        β”‚                    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€>β”‚
     β”‚                        β”‚                    β”‚                        β”‚             β”‚
     β”‚                        β”‚                    β”‚                        β”‚  SetObject(this)
     β”‚                        β”‚                    β”‚                        β”‚  SetFlags(RF_NoFlags)
     β”‚                        β”‚                    β”‚                        β”‚  SerialNumber = ++MasterSerialNumber (1234)
     β”‚                        β”‚                    β”‚                        β”‚  ClusterRootIndex = 0
     β”‚                        β”‚                    β”‚                        β”‚  RefCount = 0
     β”‚                        β”‚                    β”‚                        β”‚             β”‚
     β”‚                        β”‚                    β”‚ λ‹¨κ³„ 5: μΈλ±μ¤ μ €μ¥     β”‚             β”‚
     β”‚                        β”‚<β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤                        β”‚             β”‚
     β”‚                        β”‚ Index = 15         β”‚                        β”‚             β”‚
     β”‚                        β”‚ InternalIndex = 15 β”‚                        β”‚             β”‚
     β”‚                        β”‚                    β”‚                        β”‚             β”‚
     β”‚                        β”‚                    β”‚ λ‹¨κ³„ 6: λ¦¬μ¤λ„ μ•λ¦Ό     β”‚             β”‚
     β”‚                        β”‚                    β”‚ for (Listener in CreateListeners)    β”‚
     β”‚                        β”‚                    β”‚   Listener->NotifyCreated(Object, 15) β”‚
     β”‚                        β”‚                    β”‚                        β”‚             β”‚
     β”‚                        β”‚                    β”‚ [Unlock Critical Section]            β”‚
     β”‚                        β”‚                    β”‚                        β”‚             β”‚
     β”‚<β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤                    β”‚                        β”‚             β”‚
     β”‚ AActor* λ°ν™           β”‚                    β”‚                        β”‚             β”‚
     β”‚                        β”‚                    β”‚                        β”‚             β”‚

β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”
κ²°κ³Ό: μΈλ±μ¤ 15 μ¬μ‚¬μ©, μ‹λ¦¬μ–Ό λ²νΈ 1234 ν• λ‹Ήλ¨
β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”
```

**ν•µμ‹¬ ν¬μΈνΈ:**
- **μΈλ±μ¤ μ¬μ‚¬μ©**: ObjAvailableListμ—μ„ Pop (LIFO) β†’ μµκ·Ό ν•΄μ λ μ¬λ΅― μ¬μ‚¬μ©
- **μ‹λ¦¬μ–Ό λ²νΈ μ¦κ°€**: λ§¤ ν• λ‹Ήλ§λ‹¤ MasterSerialNumber μ¦κ°€ β†’ Weak Pointer λ¬΄ν¨ν™” λ©”μ»¤λ‹μ¦
- **μ›μμ  μ—°μ‚°**: Critical SectionμΌλ΅ μ¤λ λ“ μ•μ „μ„± λ³΄μ¥
- **μ²­ν¬ μ§€μ—° ν• λ‹Ή**: ν•„μ”ν• μ²­ν¬λ§ ν• λ‹Ή (μ΄ κ²½μ° μ²­ν¬ 0 μ΄λ―Έ μ΅΄μ¬)

### 2. μ¤λΈμ νΈ ν•΄μ  μ „μ²΄ νλ¦„

GC μ™„λ£ ν›„ μΈλ±μ¤ ν•΄μ  λ° μ¬ν™μ© λ“±λ΅:

```
β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”
νƒ€μ„λΌμΈ: GC μ™„λ£ β†’ μΈλ±μ¤ ν•΄μ  β†’ μ¬ν™μ© λ“±λ΅
β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”

[GC System]          [UObjectBase]      [FUObjectArray]     [FChunkedArray]    [FUObjectItem]
     β”‚                     β”‚                    β”‚                    β”‚                 β”‚
     β”‚ CollectGarbage()    β”‚                    β”‚                    β”‚                 β”‚
     β”‚ Mark Phase μ™„λ£     β”‚                    β”‚                    β”‚                 β”‚
     β”‚ Sweep Phase μ‹μ‘    β”‚                    β”‚                    β”‚                 β”‚
     β”‚                     β”‚                    β”‚                    β”‚                 β”‚
     β”‚ for (Unreachable Objects)               β”‚                    β”‚                 β”‚
     β”‚   FreeUObjectIndex(Object)               β”‚                    β”‚                 β”‚
     β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€>β”‚                    β”‚                 β”‚
     β”‚                     β”‚                    β”‚                    β”‚                 β”‚
     β”‚                     β”‚                    β”‚ [Lock Critical Section]              β”‚
     β”‚                     β”‚                    β”‚                    β”‚                 β”‚
     β”‚                     β”‚                    β”‚ Object->InternalIndex β†’ 15           β”‚
     β”‚                     β”‚                    β”‚                    β”‚                 β”‚
     β”‚                     β”‚                    β”‚ λ‹¨κ³„ 1: Delete λ¦¬μ¤λ„ μ•λ¦Ό            β”‚
     β”‚                     β”‚                    β”‚ for (Listener in DeleteListeners)    β”‚
     β”‚                     β”‚                    β”‚   Listener->NotifyDeleted(Object, 15) β”‚
     β”‚                     β”‚                    β”‚                    β”‚                 β”‚
     β”‚                     β”‚                    β”‚ λ‹¨κ³„ 2: Weak Pointer λ¬΄ν¨ν™”           β”‚
     β”‚                     β”‚                    β”‚ GetObjectPtr(15)   β”‚                 β”‚
     β”‚                     β”‚                    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€>β”‚                 β”‚
     β”‚                     β”‚                    β”‚                    β”‚ return Objects[0] + 15
     β”‚                     β”‚                    β”‚<β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤                 β”‚
     β”‚                     β”‚                    β”‚                    β”‚                 β”‚
     β”‚                     β”‚                    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€>β”‚
     β”‚                     β”‚                    β”‚                    β”‚  SerialNumber = 0
     β”‚                     β”‚                    β”‚                    β”‚  (λ¨λ“  TWeakObjectPtr λ¬΄ν¨ν™”λ¨!)
     β”‚                     β”‚                    β”‚                    β”‚                 β”‚
     β”‚                     β”‚                    β”‚ λ‹¨κ³„ 3: λ©”νƒ€λ°μ΄ν„° ν΄λ¦¬μ–΄             β”‚
     β”‚                     β”‚                    β”‚                    β”‚  SetObject(nullptr)
     β”‚                     β”‚                    β”‚                    β”‚  SetFlags(None)
     β”‚                     β”‚                    β”‚                    β”‚  ClusterRootIndex = 0
     β”‚                     β”‚                    β”‚                    β”‚  RefCount = 0
     β”‚                     β”‚                    β”‚                    β”‚                 β”‚
     β”‚                     β”‚                    β”‚ λ‹¨κ³„ 4: μ¬ν™μ© λ“±λ΅  β”‚                 β”‚
     β”‚                     β”‚                    β”‚ β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”             β”‚
     β”‚                     β”‚                    β”‚ β”‚ ObjAvailableList    β”‚             β”‚
     β”‚                     β”‚                    β”‚ β”‚ Push(15)            β”‚             β”‚
     β”‚                     β”‚                    β”‚ β”‚ [42, 37, 15] β† μ¶”κ°€ β”‚             β”‚
     β”‚                     β”‚                    β”‚ β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”             β”‚
     β”‚                     β”‚                    β”‚                    β”‚                 β”‚
     β”‚                     β”‚                    β”‚ [Unlock Critical Section]            β”‚
     β”‚                     β”‚                    β”‚                    β”‚                 β”‚
     β”‚                     β”‚ ~UObjectBase()     β”‚                    β”‚                 β”‚
     β”‚                     β”‚ μ†λ©Έμ νΈμ¶        β”‚                    β”‚                 β”‚
     β”‚                     β”‚ delete this        β”‚                    β”‚                 β”‚
     β”‚                     X (λ©”λ¨λ¦¬ ν•΄μ )      β”‚                    β”‚                 β”‚
     β”‚                                          β”‚                    β”‚                 β”‚

β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”
κ²°κ³Ό: μΈλ±μ¤ 15 μ¬ν™μ© ν’€μ— λ°ν™, λ‹¤μ ν• λ‹Ή μ‹ μ¬μ‚¬μ©λ¨
β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”
```

**ν•µμ‹¬ ν¬μΈνΈ:**
- **μ‹λ¦¬μ–Ό λ²νΈ 0μΌλ΅ μ΄κΈ°ν™”**: λ¨λ“  TWeakObjectPtrκ°€ μλ™μΌλ΅ λ¬΄ν¨ν™”λ¨
- **LIFO μ¬ν™μ©**: Pushλ΅ μ¤νƒ μµμƒλ‹¨μ— μ¶”κ°€ β†’ λ‹¤μ ν• λ‹Ή μ‹ PopμΌλ΅ λ°”λ΅ μ¬μ‚¬μ©
- **λ©”νƒ€λ°μ΄ν„° μ™„μ „ ν΄λ¦¬μ–΄**: nullptr λ° 0μΌλ΅ μ΄κΈ°ν™”ν•μ—¬ λ•κΈ€λ§ ν¬μΈν„° λ°©μ§€
- **λ¦¬μ¤λ„ λ¨Όμ € μ•λ¦Ό**: ν΄λ¦¬μ–΄ μ „μ— λ¦¬μ¤λ„κ°€ μ •λ¦¬ μ‘μ—… μν–‰ κ°€λ¥

### 3. μ²­ν¬ λ™μ  ν™•μ¥ μ‹ν€€μ¤

λ°°μ—΄μ΄ κ°€λ“ μ°° λ• μƒ μ²­ν¬ ν• λ‹Ή:

```
β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”
νƒ€μ„λΌμΈ: μΈλ±μ¤ κ³ κ° β†’ μƒ μ²­ν¬ ν• λ‹Ή
β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”

[FUObjectArray]                    [FChunkedArray]                [Memory Allocator]
     β”‚                                    β”‚                              β”‚
     β”‚ AllocateIndex()                    β”‚                              β”‚
     β”‚ ObjAvailableList.Num() == 0        β”‚                              β”‚
     β”‚ Index = ObjObjects.AddSingle()     β”‚                              β”‚
     β”‚ β†’ Index = 65536 (μ²­ν¬ 0 κ°€λ“μ°Έ!)   β”‚                              β”‚
     β”‚                                    β”‚                              β”‚
     β”‚ ExpandChunksToIndex(65536)         β”‚                              β”‚
     β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€>β”‚                              β”‚
     β”‚                                    β”‚                              β”‚
     β”‚                                    β”‚ ChunkIndex = 65536 / 65536 = 1
     β”‚                                    β”‚ if (ChunkIndex >= NumChunks) // 1 >= 1, true!
     β”‚                                    β”‚                              β”‚
     β”‚                                    β”‚ λ‹¨κ³„ 1: μƒ μ²­ν¬ ν• λ‹Ή          β”‚
     β”‚                                    β”‚ new FUObjectItem[65536]      β”‚
     β”‚                                    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€>β”‚
     β”‚                                    β”‚                              β”‚
     β”‚                                    β”‚                              β”‚ malloc(65536 Γ— 32 bytes)
     β”‚                                    β”‚                              β”‚ = 2,097,152 bytes (2 MB)
     β”‚                                    β”‚                              β”‚ memset(0)
     β”‚                                    β”‚                              β”‚
     β”‚                                    β”‚<β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
     β”‚                                    β”‚ NewChunk* λ°ν™               β”‚
     β”‚                                    β”‚                              β”‚
     β”‚                                    β”‚ λ‹¨κ³„ 2: μ²­ν¬ ν¬μΈν„° λ°°μ—΄μ— λ“±λ΅
     β”‚                                    β”‚ Objects[1] = NewChunk        β”‚
     β”‚                                    β”‚                              β”‚
     β”‚                                    β”‚ λ©”λ¨λ¦¬ μƒνƒ:                 β”‚
     β”‚                                    β”‚ β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”                β”‚
     β”‚                                    β”‚ β”‚ Objects[] β”‚                β”‚
     β”‚                                    β”‚ β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤                β”‚
     β”‚                                    β”‚ β”‚ [0] β”€β”€β”€> μ²­ν¬0 (65K ν•­λ©)  β”‚
     β”‚                                    β”‚ β”‚ [1] β”€β”€β”€> μ²­ν¬1 (65K ν•­λ©) β† NEW!
     β”‚                                    β”‚ β”‚ [2] = nullβ”‚                β”‚
     β”‚                                    β”‚ β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”                β”‚
     β”‚                                    β”‚                              β”‚
     β”‚                                    β”‚ λ‹¨κ³„ 3: λ©”νƒ€λ°μ΄ν„° μ—…λ°μ΄νΈ   β”‚
     β”‚                                    β”‚ NumChunks = 2                β”‚
     β”‚                                    β”‚ MaxElements = 2 Γ— 65536 = 131,072
     β”‚                                    β”‚                              β”‚
     β”‚<β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤                              β”‚
     β”‚ ν™•μ¥ μ™„λ£                          β”‚                              β”‚
     β”‚                                    β”‚                              β”‚
     β”‚ μ΄μ  GetObjectPtr(65536) νΈμ¶ κ°€λ¥ β”‚                              β”‚
     β”‚ β†’ Objects[1] + 0 λ°ν™              β”‚                              β”‚
     β”‚                                    β”‚                              β”‚

β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”
κ²°κ³Ό: μ²­ν¬ 1 ν• λ‹Ή μ™„λ£, 65536~131071 μΈλ±μ¤ μ‚¬μ© κ°€λ¥
β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”
```

**ν•µμ‹¬ ν¬μΈνΈ:**
- **μ§€μ—° ν• λ‹Ή**: μ‹¤μ  ν•„μ”ν•  λ•λ§ μ²­ν¬ ν• λ‹Ή (λ©”λ¨λ¦¬ μ μ•½)
- **2MB λ‹¨μ„ ν• λ‹Ή**: 65,536 Γ— 32 bytes = 2MB (νμ΄μ§€ ν¬κΈ°μ λ°°μ)
- **ν¬μΈν„° μ•μ •μ„±**: κΈ°μ΅΄ μ²­ν¬λ” μ΄λ™ν•μ§€ μ•μ β†’ κΈ°μ΅΄ μΈλ±μ¤ μ ν¨
- **μ›μμ  κµν™**: InterlockedCompareExchangeλ΅ λ©€ν‹°μ¤λ λ“ μ•μ „

### 4. Weak Pointer κ²€μ¦ μ‹ν€€μ¤

μ‹λ¦¬μ–Ό λ²νΈλ¥Ό μ΄μ©ν• λ•κΈ€λ§ ν¬μΈν„° κ°μ§€:

```
β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”
νƒ€μ„λΌμΈ: Weak Pointer μƒμ„± β†’ μ¤λΈμ νΈ μ†λ©Έ β†’ κ²€μ¦ μ‹¤ν¨
β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”

[κ²μ„ μ½”λ“]              [TWeakObjectPtr]   [FUObjectArray]    [FUObjectItem]
     β”‚                         β”‚                    β”‚                 β”‚
     β”‚ μ‹μ  T0: Weak Pointer μƒμ„±                   β”‚                 β”‚
     β”‚                         β”‚                    β”‚                 β”‚
     β”‚ TWeakObjectPtr Weak = MyActor               β”‚                 β”‚
     β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€>β”‚                    β”‚                 β”‚
     β”‚                         β”‚                    β”‚                 β”‚
     β”‚                         β”‚ μ €μ¥:              β”‚                 β”‚
     β”‚                         β”‚ ObjectIndex = 15   β”‚                 β”‚
     β”‚                         β”‚ ObjectSerialNumber = 1234 (ν„μ¬ SN) β”‚
     β”‚                         β”‚                    β”‚                 β”‚
     β”‚                         β”‚ IndexToObject(15)  β”‚                 β”‚
     β”‚                         β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€>β”‚                 β”‚
     β”‚                         β”‚                    β”‚ GetObjectPtr(15)
     β”‚                         β”‚                    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€>β”‚
     β”‚                         β”‚                    β”‚  SerialNumber = 1234
     β”‚                         β”‚<β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤  Object = 0x1234ABCD
     β”‚                         β”‚ λ³µμ‚¬ μ™„λ£          β”‚                 β”‚
     β”‚                         β”‚                    β”‚                 β”‚
     β”‚ μ‹μ  T1: μ¤λΈμ νΈ μ†λ©Έ                        β”‚                 β”‚
     β”‚                         β”‚                    β”‚                 β”‚
     β”‚ MyActor->MarkAsGarbage()β”‚                    β”‚                 β”‚
     β”‚ ... GC μ‹¤ν–‰λ¨           β”‚                    β”‚                 β”‚
     β”‚                         β”‚                    β”‚                 β”‚
     β”‚                         β”‚   FreeUObjectIndex(MyActor)          β”‚
     β”‚                         β”‚                    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€>β”‚
     β”‚                         β”‚                    β”‚  SerialNumber = 0 β† λ¬΄ν¨ν™”!
     β”‚                         β”‚                    β”‚  Object = nullptr
     β”‚                         β”‚                    β”‚                 β”‚
     β”‚ μ‹μ  T2: Weak Pointer κ²€μ¦                   β”‚                 β”‚
     β”‚                         β”‚                    β”‚                 β”‚
     β”‚ if (Weak.IsValid())     β”‚                    β”‚                 β”‚
     β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€>β”‚                    β”‚                 β”‚
     β”‚                         β”‚                    β”‚                 β”‚
     β”‚                         β”‚ IndexToObject(15)  β”‚                 β”‚
     β”‚                         β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€>β”‚                 β”‚
     β”‚                         β”‚                    β”‚ GetObjectPtr(15)
     β”‚                         β”‚                    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€>β”‚
     β”‚                         β”‚                    β”‚  SerialNumber = 0
     β”‚                         β”‚                    β”‚  Object = nullptr
     β”‚                         β”‚<β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤                 β”‚
     β”‚                         β”‚                    β”‚                 β”‚
     β”‚                         β”‚ κ²€μ¦:              β”‚                 β”‚
     β”‚                         β”‚ if (Item->SerialNumber != 0 &&      β”‚
     β”‚                         β”‚     Item->SerialNumber == ObjectSerialNumber)
     β”‚                         β”‚   β†’ 0 != 1234  β† FALSE!             β”‚
     β”‚                         β”‚                    β”‚                 β”‚
     β”‚<β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤                    β”‚                 β”‚
     β”‚ false λ°ν™ (λ¬΄ν¨!)      β”‚                    β”‚                 β”‚
     β”‚                         β”‚                    β”‚                 β”‚
     β”‚ // μ•μ „ν•κ² nullptr μ²λ¦¬β”‚                    β”‚                 β”‚
     β”‚                         β”‚                    β”‚                 β”‚
     β”‚ μ‹μ  T3: μƒ μ¤λΈμ νΈκ°€ κ°™μ€ μΈλ±μ¤ μ¬μ‚¬μ©    β”‚                 β”‚
     β”‚                         β”‚                    β”‚                 β”‚
     β”‚ NewObject<AActor>()     β”‚                    β”‚                 β”‚
     β”‚ β†’ Index 15 μ¬μ‚¬μ©       β”‚                    β”‚                 β”‚
     β”‚                         β”‚                    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€>β”‚
     β”‚                         β”‚                    β”‚  Object = 0xNEW_ADDR
     β”‚                         β”‚                    β”‚  SerialNumber = 5678 β† μƒ SN!
     β”‚                         β”‚                    β”‚                 β”‚
     β”‚ λ‹¤μ‹ Weak.IsValid() νΈμ¶β”‚                    β”‚                 β”‚
     β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€>β”‚                    β”‚                 β”‚
     β”‚                         β”‚ κ²€μ¦:              β”‚                 β”‚
     β”‚                         β”‚ if (0 != 5678 && 5678 == 1234)      β”‚
     β”‚                         β”‚   β†’ FALSE (μ‹λ¦¬μ–Ό λ²νΈ λ¶μΌμΉ)       β”‚
     β”‚<β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤                    β”‚                 β”‚
     β”‚ false λ°ν™ (μ—¬μ „ν λ¬΄ν¨)β”‚                    β”‚                 β”‚
     β”‚                         β”‚                    β”‚                 β”‚

β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”
κ²°κ³Ό: μΈλ±μ¤ μ¬μ‚¬μ©λμ–΄λ„ μ‹λ¦¬μ–Ό λ²νΈ λ¶μΌμΉλ΅ λ•κΈ€λ§ ν¬μΈν„° κ°μ§€
β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”
```

**ν•µμ‹¬ ν¬μΈνΈ:**
- **μ΄μ¤‘ κ²€μ¦**: SerialNumberκ°€ 0μ΄ μ•„λ‹κ³ (μ ν¨) && μ €μ¥λ κ°’κ³Ό μΌμΉν•΄μ•Ό ν•¨
- **μΈλ±μ¤ μ¬μ‚¬μ© μ•μ „μ„±**: κ°™μ€ μΈλ±μ¤λΌλ„ μ‹λ¦¬μ–Ό λ²νΈκ°€ λ‹¤λ¥΄λ©΄ λ¬΄ν¨ μ²λ¦¬
- **μλ™ λ¬΄ν¨ν™”**: SerialNumberλ¥Ό 0μΌλ΅ μ„¤μ •ν•λ” κ²ƒλ§μΌλ΅ λ¨λ“  Weak Pointer λ¬΄ν¨ν™”
- **μ„±λ¥**: O(1) κ²€μ¦ (μΈλ±μ¤ μ΅°ν + μ •μ λΉ„κµ)

---

## π”” λ¦¬μ¤λ„ μ‹μ¤ν…

### Create Listener

```cpp
class FUObjectCreateListener
{
public:
    virtual ~FUObjectCreateListener() {}

    // UObject μƒμ„± μ‹ νΈμ¶
    virtual void NotifyUObjectCreated(const UObjectBase* Object, int32 Index) = 0;

    // μΆ…λ£ μ‹ νΈμ¶
    virtual void OnUObjectArrayShutdown() = 0;
};

// λ“±λ΅
GUObjectArray.AddUObjectCreateListener(MyListener);

// μμ‹: νΉμ • ν΄λμ¤ μ¶”μ 
class FMyClassTracker : public FUObjectCreateListener
{
    TSet<UObject*> TrackedObjects;

    virtual void NotifyUObjectCreated(const UObjectBase* Object, int32 Index) override
    {
        if (Object->IsA(UMyClass::StaticClass()))
        {
            TrackedObjects.Add((UObject*)Object);
        }
    }
};
```

### Delete Listener

```cpp
class FUObjectDeleteListener
{
public:
    virtual ~FUObjectDeleteListener() {}

    // UObject μ†λ©Έ μ‹ νΈμ¶
    virtual void NotifyUObjectDeleted(const UObjectBase* Object, int32 Index) = 0;

    // μΆ…λ£ μ‹ νΈμ¶
    virtual void OnUObjectArrayShutdown() = 0;

    // λ©”λ¨λ¦¬ μ‚¬μ©λ‰ λ³΄κ³ 
    virtual SIZE_T GetAllocatedSize() const { return 0; }
};

// λ“±λ΅
GUObjectArray.AddUObjectDeleteListener(MyListener);

// μμ‹: μ°Έμ΅° λ¬΄ν¨ν™”
class FReferenceInvalidator : public FUObjectDeleteListener
{
    TMap<UObject*, TArray<TWeakObjectPtr<UObject>>> References;

    virtual void NotifyUObjectDeleted(const UObjectBase* Object, int32 Index) override
    {
        if (TArray<TWeakObjectPtr<UObject>>* Refs = References.Find((UObject*)Object))
        {
            for (TWeakObjectPtr<UObject>& Ref : *Refs)
            {
                Ref.Reset();  // λ…μ‹μ  λ¬΄ν¨ν™”
            }
            References.Remove((UObject*)Object);
        }
    }
};
```

**μΌλ°μ μΈ λ¦¬μ¤λ„ μ‚¬μ© μ‚¬λ΅€:**
- **μ—λ””ν„° ν΄:** μ¤λΈμ νΈ μƒμ„±/μ‚­μ  κ°μ§€ λ° UI μ—…λ°μ΄νΈ
- **ν”„λ΅νμΌλ¬:** μ¤λΈμ νΈ μλ… μ¶”μ 
- **λ„¤νΈμ›ν‚Ή:** λ¦¬ν”λ¦¬μΌ€μ΄μ… λ“±λ΅/ν•΄μ 
- **μ—μ…‹ λ§¤λ‹μ €:** μ—μ…‹ μ°Έμ΅° μ¶”μ 
- **λ””λ²„κ·Έ ν΄:** λ©”λ¨λ¦¬ λ„μ κ°μ§€

---

## π” μ¤λΈμ νΈ λ°λ³µ (Iteration)

### μ „μ²΄ μ¤λΈμ νΈ μν

```cpp
// λ¨λ“  UObject λ°λ³µ
for (FThreadSafeObjectIterator It; It; ++It)
{
    UObject* Object = *It;
    // ...
}

// νΉμ • ν΄λμ¤λ§
for (TObjectIterator<AActor> It; It; ++It)
{
    AActor* Actor = *It;
    // ...
}

// λ‚΄λ¶€ κµ¬ν„
class FThreadSafeObjectIterator
{
    int32 Index;
    FUObjectArray& ObjectArray;

    void Advance()
    {
        while (Index < ObjectArray.GetObjectArrayNum())
        {
            FUObjectItem* Item = ObjectArray.IndexToObject(Index);
            if (Item && Item->GetObject())
            {
                return;  // μ ν¨ν• μ¤λΈμ νΈ λ°κ²¬
            }
            ++Index;
        }
    }
};
```

### GC λ€μƒλ§ μν

```cpp
// GCκ°€ μ¤μΊ”ν•λ” λ²”μ„λ§
int32 Start = GUObjectArray.GetObjectArrayNumNotConsideredByGC();
int32 End = GUObjectArray.GetObjectArrayNum();

for (int32 Index = Start; Index < End; ++Index)
{
    FUObjectItem* Item = GUObjectArray.IndexToObject(Index);
    if (Item && Item->GetObject())
    {
        UObject* Object = (UObject*)Item->GetObject();
        // GC λ§ν‚Ή...
    }
}
```

---

## π“ λ©”λ¨λ¦¬ λ μ΄μ•„μ›ƒ

### FUObjectItem ν¬κΈ° λ¶„μ„

**μ••μ¶• μ—†μ (κΈ°λ³Έ):**
```
sizeof(FUObjectItem) =
    8 bytes  (UObjectBase* Object)
  + 4 bytes  (int32 Flags)
  + 4 bytes  (int32 ClusterRootIndex)
  + 4 bytes  (int32 SerialNumber)
  + 4 bytes  (int32 RefCount)
  + 8 bytes  (FRemoteObjectId, μ΅°κ±΄λ¶€)
  + 8 bytes  (TStatId, μ΅°κ±΄λ¶€)
β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
  32~48 bytes per object
```

**μ••μ¶• ν™μ„±ν™” (UE_PACK_FUOBJECT_ITEM):**
```
sizeof(FUObjectItem) =
    4 bytes  (uint32 ObjectPtrLow)
  + 4 bytes  (int32 Flags + ν¬μΈν„° μƒμ„ λΉ„νΈ)
  + 4 bytes  (int32 ClusterRootIndex)
  + 4 bytes  (int32 SerialNumber)
  + 4 bytes  (int32 RefCount)
  + 8 bytes  (FRemoteObjectId, μ΅°κ±΄λ¶€)
  + 8 bytes  (TStatId, μ΅°κ±΄λ¶€)
β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
  28~44 bytes per object
```

### μ „μ²΄ λ°°μ—΄ λ©”λ¨λ¦¬ μ‚¬μ©λ‰

**μμ‹: 2M μ¤λΈμ νΈ μµλ€**
```cpp
MaxUObjects = 2,097,152

// μ²­ν¬ μ
MaxChunks = 2,097,152 / 65,536 = 32 chunks

// μ²­ν¬ ν¬μΈν„° λ°°μ—΄
sizeof(FUObjectItem*) * 32 = 256 bytes

// μ „μ²΄ FUObjectItem λ°°μ—΄ (μ‚¬μ „ ν• λ‹Ή μ‹)
sizeof(FUObjectItem) * 2,097,152
= 32 bytes * 2,097,152
= 67,108,864 bytes
= ~64 MB

// ObjAvailableList (worst case - λ¨λ‘ λΉ”)
sizeof(int32) * 2,097,152
= 8,388,608 bytes
= ~8 MB

// μ΄ λ©”λ¨λ¦¬
~72 MB (μ¤λΈμ νΈκ°€ μ—†μ„ λ•)
```

**λ™μ  ν• λ‹Ή μ‹ (bPreAllocateObjectArray = false):**
- μ²­ν¬ ν¬μΈν„° λ°°μ—΄: ~256 bytes
- μ‹¤μ  μ²­ν¬: ν•„μ”ν•  λ•λ§ ν• λ‹Ή
- μ¤λΈμ νΈ 100Kκ°μΌ λ•: ~3.2 MB (2 chunks Γ— 32 bytes Γ— 65536)

---

## π’΅ μ„±λ¥ μµμ ν™”

### 1. ObjAvailableList ν™μ©

```cpp
// β λ‚μ¨: λ°°μ—΄ λμ— κ³„μ† μ¶”κ°€
// - λ©”λ¨λ¦¬ λ‚­λΉ„ (μ¤‘κ°„μ— λΉ μ¬λ΅―)
// - μΊμ‹ λ―Έμ¤ μ¦κ°€ (ν¬μ† λ°°μ—΄)

// β… μΆ‹μ: λΉ μ¬λ΅― μ¬μ‚¬μ©
// - λ©”λ¨λ¦¬ λ°€λ„ λ†’μ
// - μΊμ‹ ν¨μ¨ μΆ‹μ
if (ObjAvailableList.Num() > 0)
{
    Index = ObjAvailableList.Pop();  // LIFO - O(1)
}
```

**LIFO vs FIFO:**
- **LIFO (μ‚¬μ© μ¤‘):** μµκ·Όμ— ν•΄μ λ μ¬λ΅― μ¬μ‚¬μ© β†’ μΊμ‹ μΉν™”μ 
- **FIFO (μ‚¬μ© μ• ν•¨):** μ¤λλ μ¬λ΅― μ¬μ‚¬μ© β†’ μΊμ‹ λ―Έμ¤

### 2. Disregard for GC ν’€

```cpp
// GC μ¤μΊ” λ²”μ„ κ°μ†
int32 GCScanStart = MaxObjectsNotConsideredByGC;  // μ: 100,000
int32 TotalObjects = ObjObjects.Num();            // μ: 500,000

// GCκ°€ 400,000κ°λ§ μ¤μΊ” (100,000κ° μ¤ν‚µ)
// 20% μ„±λ¥ ν–¥μƒ
```

**μ„¤μ •:**
```ini
; DefaultEngine.ini
[/Script/Engine.GarbageCollectionSettings]
gc.MaxObjectsNotConsideredByGC=100000
```

### 3. ν¬μΈν„° μ••μ¶•

```cpp
// μ••μ¶• ν™μ„±ν™”
#define UE_PACK_FUOBJECT_ITEM 1

// ν¨κ³Ό:
// - FUObjectItem ν¬κΈ°: 32 bytes β†’ 28 bytes (~12.5% κ°μ†)
// - 2M μ¤λΈμ νΈ: 64MB β†’ 56MB μ μ•½
// - μΊμ‹ λΌμΈμ— λ” λ§μ€ μ•„μ΄ν… fit
```

**νΈλ μ΄λ“μ¤ν”„:**
- **μ¥μ :** λ©”λ¨λ¦¬ μ μ•½, μΊμ‹ ν¨μ¨
- **λ‹¨μ :** λ””μ½”λ”© μ¤λ²„ν—¤λ“ (λΉ„νΈ μ‹ν”„νΈ 2ν), 45λΉ„νΈ μ£Όμ† μ ν•

### 4. μ²­ν¬ μ‚¬μ „ ν• λ‹Ή

```cpp
// μ‚¬μ „ ν• λ‹Ή (bPreAllocateObjectArray = true)
// - μ—°μ† λ©”λ¨λ¦¬ λΈ”λ΅
// - μ²­ν¬ ν• λ‹Ή μ¤λ²„ν—¤λ“ μ—†μ
// - νμ΄μ§€ ν΄νΈ κ°μ†

// λ™μ  ν• λ‹Ή (bPreAllocateObjectArray = false)
// - λ©”λ¨λ¦¬ μ μ•½ (μ‚¬μ©ν• λ§νΌλ§)
// - μ²­ν¬ ν™•μ¥ μ‹ μ•½κ°„μ μ¤λ²„ν—¤λ“
```

**κ¶μ¥ μ„¤μ •:**
- **κ²μ„ λΉλ“:** μ‚¬μ „ ν• λ‹Ή (μμΈ΅ κ°€λ¥ν• μ„±λ¥)
- **μ—λ””ν„° λΉλ“:** λ™μ  ν• λ‹Ή (λ©”λ¨λ¦¬ μ μ•½)

---

## π¨ μΌλ°μ μΈ ν•¨μ •

### β μΈλ±μ¤ μ§μ ‘ μ‚¬μ©

```cpp
// μ„ν—: μΈλ±μ¤λ” μ¬μ‚¬μ©λ  μ μμ
int32 MyObjectIndex = MyObject->GetInternalIndex();

// ... λ‚μ¤‘μ—
MyObject->MarkAsGarbage();
// MyObjectκ°€ GCλ¨
// μƒ μ¤λΈμ νΈκ°€ κ°™μ€ μΈλ±μ¤ μ¬μ‚¬μ©

FUObjectItem* Item = GUObjectArray.IndexToObject(MyObjectIndex);
// β λ‹¤λ¥Έ μ¤λΈμ νΈλ¥Ό κ°€λ¦¬ν‚¬ μ μμ!
```

**β… μ¬λ°”λ¥Έ λ°©λ²•:**
```cpp
// TWeakObjectPtr μ‚¬μ© - μ‹λ¦¬μ–Ό λ²νΈλ΅ κ²€μ¦
TWeakObjectPtr<UMyObject> WeakPtr = MyObject;

// ... λ‚μ¤‘μ—
if (WeakPtr.IsValid())
{
    UMyObject* Object = WeakPtr.Get();
    // β… μ•μ „: μ‹λ¦¬μ–Ό λ²νΈκ°€ μΌμΉν•λ” κ²½μ°λ§ λ°ν™
}
```

### β λ°λ³µ μ¤‘ μ¤λΈμ νΈ μƒμ„±/μ†λ©Έ

```cpp
// β μ„ν—: λ°λ³µ μ¤‘ λ°°μ—΄ μμ •
for (FThreadSafeObjectIterator It; It; ++It)
{
    UObject* Object = *It;

    // μƒ μ¤λΈμ νΈ μƒμ„±
    UObject* NewObject = NewObject<UObject>();  // λ°°μ—΄ ν™•μ¥ κ°€λ¥

    // μ¤λΈμ νΈ μ†λ©Έ
    Object->MarkAsGarbage();  // ObjAvailableList μμ •
}
```

**β… μ¬λ°”λ¥Έ λ°©λ²•:**
```cpp
// λ¨Όμ € λ¨μΌκ³  λ‚μ¤‘μ— μ²λ¦¬
TArray<UObject*> ObjectsToProcess;
for (FThreadSafeObjectIterator It; It; ++It)
{
    ObjectsToProcess.Add(*It);
}

for (UObject* Object : ObjectsToProcess)
{
    // μ΄μ  μ•μ „ν•κ² μƒμ„±/μ†λ©Έ
}
```

### β λ¦¬μ¤λ„μ—μ„ GUObjectArray μ§μ ‘ μμ •

```cpp
class FBadListener : public FUObjectCreateListener
{
    virtual void NotifyUObjectCreated(const UObjectBase* Object, int32 Index) override
    {
        // β λ°λ“λ½!
        GUObjectArray.AllocateUObjectIndex(...);  // CriticalSection μ¬μ§„μ…
    }
};
```

**β… μ¬λ°”λ¥Έ λ°©λ²•:**
```cpp
class FGoodListener : public FUObjectCreateListener
{
    TArray<const UObjectBase*> PendingCreates;

    virtual void NotifyUObjectCreated(const UObjectBase* Object, int32 Index) override
    {
        // β… λ‚μ¤‘μ— μ²λ¦¬ν•κΈ° μ„ν•΄ νμ‰
        PendingCreates.Add(Object);
    }

    void ProcessPending()
    {
        // λ¦¬μ¤λ„ μ½λ°± μ™Έλ¶€μ—μ„ μ²λ¦¬
        for (const UObjectBase* Object : PendingCreates)
        {
            // μ•μ „ν•κ² μ‘μ—…
        }
        PendingCreates.Empty();
    }
};
```

---

## π”— μ°Έκ³ μλ£

- [UObjectArray.h Source](Engine/Source/Runtime/CoreUObject/Public/UObject/UObjectArray.h)
- [UObjectBase.h Source](Engine/Source/Runtime/CoreUObject/Public/UObject/UObjectBase.h)
- [Object Handling in Unreal](https://docs.unrealengine.com/object-handling-in-unreal-engine/)
- [Garbage Collection](https://docs.unrealengine.com/unreal-engine-garbage-collection/)

---

> π“… μƒμ„±: 2025-10-17 β€” FUObjectArray λ° μ¤λΈμ νΈ μΈλ±μ‹± μ‹μ¤ν… λ¬Έμ„ν™”
