---
title: "Lumen Global Illumination ê°œìš”"
date: "2025-12-02"
status: "stable"
project: "UnrealEngine"
lang: "ko"
category: "unreal-summary"
track: "Lumen"
tags: ["unreal", "Lumen"]
---
# Lumen Global Illumination ê°œìš”

> Updated: 2025-12-02 â€” ì—”ì§„ ì†ŒìŠ¤ ì½”ë“œ ë¶„ì„ ê¸°ë°˜ ì „ë©´ ì¬ì •ë¦¬ + ê°œë³„ ì‹œìŠ¤í…œ ì‹¬ì¸µ ë¶„ì„ ë¬¸ì„œ ì¶”ê°€

## ğŸ“š ìƒì„¸ ë¬¸ì„œ ë§í¬

ì´ Overview ë¬¸ì„œëŠ” Lumen ì „ì²´ ì‹œìŠ¤í…œì˜ ê°œìš”ë¥¼ ì œê³µí•©ë‹ˆë‹¤. ê° ì„œë¸Œì‹œìŠ¤í…œì— ëŒ€í•œ ì‹¬ì¸µ ë¶„ì„ì€ ì•„ë˜ ê°œë³„ ë¬¸ì„œë¥¼ ì°¸ì¡°í•˜ì„¸ìš”:

| ë¬¸ì„œ | ì„¤ëª… |
|------|------|
| **[MeshDistanceField.md](./MeshDistanceField.md)** | Mesh SDF ìƒì„±, ì €ì¥, ìŠ¤íŠ¸ë¦¬ë°, íŠ¸ë ˆì´ì‹± ìƒì„¸ ë¶„ì„ |
| **[GlobalDistanceField.md](./GlobalDistanceField.md)** | Global SDF Clipmap êµ¬ì¡°, ì—…ë°ì´íŠ¸, Object Grid ë¶„ì„ |
| **[SurfaceCache.md](./SurfaceCache.md)** | Card ì‹œìŠ¤í…œ, Virtual Page Table, Atlas ìƒ˜í”Œë§ ë¶„ì„ |
| **[ScreenProbe.md](./ScreenProbe.md)** | Screen Probe ë°°ì¹˜, Octahedral Tracing, Filtering ë¶„ì„ |
| **[RadianceCache.md](./RadianceCache.md)** | World Space Clipmap, Probe ë³´ê°„, Sky Visibility ë¶„ì„ |
| **[LumenTracing.md](./LumenTracing.md)** | ë‹¤ì¤‘ ê³„ì¸µ íŠ¸ë ˆì´ì‹± (Screen/Mesh SDF/Global SDF/HWRT) ë¶„ì„ |
| **[LumenReflections.md](./LumenReflections.md)** | ë°˜ì‚¬ íŒŒì´í”„ë¼ì¸, Trace Compaction, Denoising ë¶„ì„ |

---

## ğŸ§­ Overview

Lumenì€ UE5ì˜ ì‹¤ì‹œê°„ ê¸€ë¡œë²Œ ì¼ë£¨ë¯¸ë„¤ì´ì…˜ (Global Illumination) ì‹œìŠ¤í…œìœ¼ë¡œ, **Signed Distance Field(SDF)**, **Surface Cache**, **ScreenProbe** ê¸°ë°˜ì˜ í•˜ì´ë¸Œë¦¬ë“œ íŠ¸ë ˆì´ì‹±ì„ í†µí•´ ë™ì ì¸ ê°„ì ‘ê´‘ê³¼ ë°˜ì‚¬ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ê³„ì‚°í•œë‹¤.

---

## ğŸ“‚ ì—”ì§„ ì½”ë“œ êµ¬ì¡°

### í•µì‹¬ ì†ŒìŠ¤ íŒŒì¼ ìœ„ì¹˜

```
Engine/Source/Runtime/
â”œâ”€â”€ Engine/Public/
â”‚   â””â”€â”€ DistanceFieldAtlas.h              // SDF ë°ì´í„° êµ¬ì¡° ì •ì˜
â”‚
â”œâ”€â”€ Renderer/Private/
â”‚   â”œâ”€â”€ DistanceFieldObjectManagement.cpp  // SDF ì˜¤ë¸Œì íŠ¸ ê´€ë¦¬
â”‚   â”œâ”€â”€ DistanceFieldLightingShared.h      // SDF ë¼ì´íŒ… ê³µìš© êµ¬ì¡°ì²´
â”‚   â”œâ”€â”€ GlobalDistanceField.h/.cpp         // Global SDF ì—…ë°ì´íŠ¸
â”‚   â”‚
â”‚   â””â”€â”€ Lumen/
â”‚       â”œâ”€â”€ Lumen.h                        // Lumen ì§„ì…ì 
â”‚       â”œâ”€â”€ LumenSceneData.h               // LumenScene ë°ì´í„° êµ¬ì¡°
â”‚       â”œâ”€â”€ LumenMeshCards.h               // Card ì‹œìŠ¤í…œ
â”‚       â”œâ”€â”€ LumenTracingUtils.h            // íŠ¸ë ˆì´ì‹± ìœ í‹¸ë¦¬í‹°
â”‚       â”œâ”€â”€ LumenScreenProbeGather.h       // ScreenProbe ì‹œìŠ¤í…œ
â”‚       â”œâ”€â”€ LumenRadianceCache.h           // Radiance Cache
â”‚       â”œâ”€â”€ LumenReflections.h             // ë°˜ì‚¬ ì‹œìŠ¤í…œ
â”‚       â””â”€â”€ LumenSceneLighting.h           // ì”¬ ë¼ì´íŒ…

Engine/Shaders/Private/
â”œâ”€â”€ DistanceField*.usf                     // SDF ì…°ì´ë”
â””â”€â”€ Lumen/
    â”œâ”€â”€ LumenScene.usf                     // ì”¬ ê´€ë¦¬
    â”œâ”€â”€ LumenTracingCommon.ush             // íŠ¸ë ˆì´ì‹± ê³µí†µ
    â”œâ”€â”€ LumenScreenProbeCommon.ush         // ScreenProbe ê³µí†µ
    â”œâ”€â”€ LumenCardCommon.ush                // Card ë°ì´í„° êµ¬ì¡°
    â”œâ”€â”€ LumenSoftwareRayTracing.ush        // ì†Œí”„íŠ¸ì›¨ì–´ RT
    â””â”€â”€ SurfaceCache/
        â””â”€â”€ LumenSurfaceCache.ush          // Surface Cache ìƒ˜í”Œë§
```

---

## ğŸ§± ì „ì²´ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Lumen GI ì•„í‚¤í…ì²˜                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    LumenScene (ëŸ°íƒ€ì„ ì”¬ í‘œí˜„)                     â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚
â”‚  â”‚  â”‚   Mesh SDF          â”‚  â”‚      Surface Cache (Cards)          â”‚â”‚ â”‚
â”‚  â”‚  â”‚   + Global SDF      â”‚  â”‚  Albedo/Normal/Emissive/Lighting   â”‚â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                              â†‘                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    Tracing ê³„ì¸µ (íˆíŠ¸ í¬ì¸íŠ¸ ì°¾ê¸°)                 â”‚ â”‚
â”‚  â”‚  1. Screen Space (HZB) â†’ 2. Mesh SDF â†’ 3. Global SDF â†’ 4. HW RT  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                              â†“                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    Probe ì‹œìŠ¤í…œ (Radiance ìˆ˜ì§‘)                   â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚
â”‚  â”‚  â”‚    ScreenProbe      â”‚  â”‚      Radiance Cache                 â”‚â”‚ â”‚
â”‚  â”‚  â”‚    (í™”ë©´ ê³µê°„)       â”‚  â”‚      (ì›”ë“œ ê³µê°„, ì›ê±°ë¦¬)             â”‚â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                              â†“                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    Final Gather (í”½ì…€ë³„ ì ë¶„)                     â”‚ â”‚
â”‚  â”‚          DiffuseIndirect + SpecularIndirect â†’ Final Image        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

# Part 1: Mesh Distance Field (SDF)

## ğŸ§­ Overview

Signed Distance Field(SDF)ëŠ” 3D ê³µê°„ì˜ ê° ì ì—ì„œ ê°€ì¥ ê°€ê¹Œìš´ í‘œë©´ê¹Œì§€ì˜ **ë¶€í˜¸ ìˆëŠ” ê±°ë¦¬**ë¥¼ ì €ì¥í•˜ëŠ” ë°ì´í„° êµ¬ì¡°ë‹¤. ë£¨ë©˜ì€ ì´ SDFë¥¼ í™œìš©í•˜ì—¬ ë¹ ë¥¸ ë ˆì´ íŠ¸ë ˆì´ì‹±(Sphere Tracing)ì„ ìˆ˜í–‰í•œë‹¤.

**ğŸ“‚ ìœ„ì¹˜:** `Engine/Source/Runtime/Engine/Public/DistanceFieldAtlas.h`

---

## ğŸ§± SDF ë°ì´í„° êµ¬ì¡°

### í•µì‹¬ ìƒìˆ˜ (DistanceField ë„¤ì„ìŠ¤í˜ì´ìŠ¤)

```cpp
// DistanceFieldAtlas.h:35-50
namespace DistanceField
{
    // ì˜¤ë¸Œì íŠ¸ ê²½ê³„ ì²˜ë¦¬ìš© 1 ë³µì…€ ë³´ë”
    inline constexpr int32 MeshDistanceFieldObjectBorder = 1;

    // ì‹¤ì œ ë°ì´í„° ì €ì¥ìš© ë¸Œë¦­ í¬ê¸° (7Â³ ë³µì…€)
    inline constexpr int32 UniqueDataBrickSize = 7;

    // Trilinear í•„í„°ë§ìš© ë³´ë” í¬í•¨ (8Â³ ë³µì…€)
    inline constexpr int32 BrickSize = 8;

    // SDF ë°´ë“œ í¬ê¸° (í‘œë©´ì—ì„œ 4 ë³µì…€ ì´ë‚´ë§Œ ì •í™•)
    inline constexpr int32 BandSizeInVoxels = 4;

    // Mip ë ˆë²¨ ìˆ˜
    inline constexpr int32 NumMips = 3;

    // ë¬´íš¨ ë¸Œë¦­ ì¸ë±ìŠ¤
    inline constexpr uint32 InvalidBrickIndex = 0xFFFFFFFF;

    // SDF ì €ì¥ í¬ë§· (8ë¹„íŠ¸ Grayscale)
    inline constexpr EPixelFormat DistanceFieldFormat = PF_G8;

    // ìµœëŒ€ Indirection ì°¨ì›
    inline constexpr uint32 MaxIndirectionDimension = 1024;
}
```

### Sparse SDF Mip êµ¬ì¡°

```cpp
// DistanceFieldAtlas.h:198-237
class FSparseDistanceFieldMip
{
public:
    // Indirection í…ìŠ¤ì²˜ ì°¨ì›
    FInt32Vector IndirectionDimensions;

    // í™œì„± ë¸Œë¦­ ìˆ˜
    int32 NumDistanceFieldBricks;

    // ë³¼ë¥¨ â†’ ê°€ìƒ UV ë³€í™˜
    FVector3f VolumeToVirtualUVScale;
    FVector3f VolumeToVirtualUVAdd;

    // ê±°ë¦¬ê°’ â†’ ë³¼ë¥¨ ê³µê°„ ë³€í™˜
    FVector2f DistanceFieldToVolumeScaleBias;

    // ë²Œí¬ ë°ì´í„° ì˜¤í”„ì…‹/í¬ê¸°
    uint32 BulkOffset;
    uint32 BulkSize;
};
```

### ë©”ì‹œë³„ SDF ë³¼ë¥¨ ë°ì´í„°

```cpp
// DistanceFieldAtlas.h:240-303
class FDistanceFieldVolumeData : public FDeferredCleanupInterface
{
public:
    // ë¡œì»¬ ê³µê°„ AABB
    FBox3f LocalSpaceMeshBounds;

    // ì–‘ë©´ ë¨¸í‹°ë¦¬ì–¼ ì—¬ë¶€
    bool bMostlyTwoSided;

    // ë¹„ë™ê¸° ë¹Œë“œ ì¤‘ ì—¬ë¶€
    bool bAsyncBuilding;

    // 3ê°œ Mip ë ˆë²¨
    TStaticArray<FSparseDistanceFieldMip, DistanceField::NumMips> Mips;

    // í•­ìƒ ë¡œë“œëœ Mip (ì €í•´ìƒë„)
    TArray<uint8> AlwaysLoadedMip;

    // ìŠ¤íŠ¸ë¦¬ë° Mip (ê³ í•´ìƒë„)
    FByteBulkData StreamableMips;

    // ê³ ìœ  ID
    uint64 Id;
};
```

---

## ğŸ§± SDF ë©”ëª¨ë¦¬ ë ˆì´ì•„ì›ƒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Sparse Distance Field êµ¬ì¡°                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  ã€Brick ê¸°ë°˜ í¬ì†Œ ì €ì¥ã€‘                                               â”‚
â”‚                                                                         â”‚
â”‚   ì „ì²´ ë³¼ë¥¨:          Indirection í…Œì´ë¸”:        Brick Atlas:           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚   â”‚ â–‘ â–‘ â–ˆ â–‘ â–‘ â”‚     â”‚ - - 1 - - â”‚           â”‚ Brick 0    â”‚        â”‚
â”‚   â”‚ â–‘ â–ˆ â–ˆ â–ˆ â–‘ â”‚     â”‚ - 2 2 3 - â”‚     â†’     â”‚ Brick 1    â”‚        â”‚
â”‚   â”‚ â–ˆ â–ˆ â–ˆ â–ˆ â–ˆ â”‚     â”‚ 4 5 5 5 6 â”‚           â”‚ Brick 2    â”‚        â”‚
â”‚   â”‚ â–‘ â–ˆ â–ˆ â–ˆ â–‘ â”‚     â”‚ - 7 7 8 - â”‚           â”‚ ...        â”‚        â”‚
â”‚   â”‚ â–‘ â–‘ â–ˆ â–‘ â–‘ â”‚     â”‚ - - 9 - - â”‚           â”‚ Brick N    â”‚        â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                         â”‚
â”‚   - = Empty (InvalidBrickIndex)                                        â”‚
â”‚   ìˆ«ì = Brick Atlas ì¸ë±ìŠ¤                                             â”‚
â”‚                                                                         â”‚
â”‚  ã€Brick ë‚´ë¶€ êµ¬ì¡° (8Ã—8Ã—8)ã€‘                                            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                                â”‚
â”‚   â”‚  â”‚   7Ã—7Ã—7 UniqueData          â”‚  â”‚  â† ì‹¤ì œ SDF ë°ì´í„°             â”‚
â”‚   â”‚  â”‚   (Distance Values)         â”‚  â”‚                                â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                                â”‚
â”‚   â”‚   + 0.5 voxel border              â”‚  â† Trilinear í•„í„°ë§ìš©          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§± Global Distance Field

### ê°œìš”

Global SDFëŠ” ê°œë³„ Mesh SDFë“¤ì„ í•˜ë‚˜ì˜ **Clipmap** êµ¬ì¡°ë¡œ í†µí•©í•œ ê²ƒì´ë‹¤.

**ğŸ“‚ ìœ„ì¹˜:** `Engine/Source/Runtime/Renderer/Private/GlobalDistanceField.h`

```cpp
// GlobalDistanceField.h:17-22
enum FGlobalDFCacheType
{
    GDF_MostlyStatic,  // ì •ì  ì˜¤ë¸Œì íŠ¸ìš© (ë³€ê²½ ì ìŒ)
    GDF_Full,          // ì „ì²´ ì˜¤ë¸Œì íŠ¸ (ë™ì  í¬í•¨)
    GDF_Num
};
```

### Clipmap íŒŒë¼ë¯¸í„°

```cpp
// GlobalDistanceField.cpp ì£¼ìš” ì„¤ì •
int32 GAOGlobalDistanceFieldNumClipmaps = 4;   // í´ë¦½ë§µ ë ˆë²¨ ìˆ˜
int32 GAOGlobalDFResolution = 128;              // ê° í´ë¦½ë§µ í•´ìƒë„
float GAOGlobalDFClipmapDistanceExponent = 2;   // ê±°ë¦¬ ì§€ìˆ˜ (ë©€ìˆ˜ë¡ ì»¤ì§)
```

### Clipmap êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Global Distance Field Clipmap                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚                     Clipmap 3 (ê°€ì¥ ë„“ìŒ)                               â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚                                                                â”‚    â”‚
â”‚   â”‚     Clipmap 2                                                  â”‚    â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚    â”‚
â”‚   â”‚   â”‚                                                    â”‚       â”‚    â”‚
â”‚   â”‚   â”‚     Clipmap 1                                      â”‚       â”‚    â”‚
â”‚   â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚       â”‚    â”‚
â”‚   â”‚   â”‚   â”‚                                        â”‚       â”‚       â”‚    â”‚
â”‚   â”‚   â”‚   â”‚     Clipmap 0 (ê°€ì¥ ì •ë°€)              â”‚       â”‚       â”‚    â”‚
â”‚   â”‚   â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚       â”‚       â”‚    â”‚
â”‚   â”‚   â”‚   â”‚   â”‚         Camera            â”‚       â”‚       â”‚       â”‚    â”‚
â”‚   â”‚   â”‚   â”‚   â”‚            â—              â”‚       â”‚       â”‚       â”‚    â”‚
â”‚   â”‚   â”‚   â”‚   â”‚                           â”‚       â”‚       â”‚       â”‚    â”‚
â”‚   â”‚   â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚       â”‚       â”‚    â”‚
â”‚   â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚       â”‚    â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                         â”‚
â”‚   Clipmap 0: 128Â³, ê°€ì¥ ë†’ì€ í•´ìƒë„, ê·¼ê±°ë¦¬                             â”‚
â”‚   Clipmap 1: 128Â³, ì¤‘ê°„ í•´ìƒë„, ì¤‘ê±°ë¦¬                                  â”‚
â”‚   Clipmap 2: 128Â³, ë‚®ì€ í•´ìƒë„, ì›ê±°ë¦¬                                  â”‚
â”‚   Clipmap 3: 128Â³, ê°€ì¥ ë‚®ì€ í•´ìƒë„, ìµœì›ê±°ë¦¬                           â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Global SDF ì—…ë°ì´íŠ¸

```cpp
// GlobalDistanceField.h:50-57
/**
 * ë·°ì— ëŒ€í•œ Global Distance Field ì—…ë°ì´íŠ¸.
 * ì¼ë°˜ì ìœ¼ë¡œ ì¹´ë©”ë¼ ì´ë™ìœ¼ë¡œ ìƒˆë¡œ ë…¸ì¶œëœ ì˜ì—­ë§Œ ì—…ë°ì´íŠ¸.
 * ì¹´ë©”ë¼ ì»·ì´ë‚˜ í° ë³€ê²½ ì‹œ ì „ì²´ ì—…ë°ì´íŠ¸ ìˆ˜í–‰.
 */
extern void UpdateGlobalDistanceFieldVolume(
    FRDGBuilder& GraphBuilder,
    FRDGExternalAccessQueue& ExternalAccessQueue,
    FViewInfo& View,
    FScene* Scene,
    float MaxOcclusionDistance,
    bool bLumenEnabled,
    FGlobalDistanceFieldInfo& Info);
```

---

## ğŸ§± SDF íŠ¸ë ˆì´ì‹± (Sphere Tracing)

### ì•Œê³ ë¦¬ì¦˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Sphere Tracing ì•Œê³ ë¦¬ì¦˜                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚   1. ì‹œì‘ì ì—ì„œ SDF ê°’ d ì½ê¸°                                          â”‚
â”‚   2. ë ˆì´ ë°©í–¥ìœ¼ë¡œ dë§Œí¼ ì „ì§„ (ì•ˆì „ ê±°ë¦¬)                              â”‚
â”‚   3. ìƒˆ ìœ„ì¹˜ì—ì„œ SDF ê°’ d' ì½ê¸°                                        â”‚
â”‚   4. d' < thresholdë©´ Hit, ì•„ë‹ˆë©´ 2ë²ˆ ë°˜ë³µ                             â”‚
â”‚                                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                                                                 â”‚   â”‚
â”‚   â”‚                         â•­â”€â”€â”€â”€â”€â”€â•®                               â”‚   â”‚
â”‚   â”‚                        â•±        â•²                              â”‚   â”‚
â”‚   â”‚                       â”‚  Object  â”‚                             â”‚   â”‚
â”‚   â”‚                        â•²        â•±                              â”‚   â”‚
â”‚   â”‚    Start               â•°â”€â”€â”€â”¬â”€â”€â”€â”€â•¯                              â”‚   â”‚
â”‚   â”‚      â”‚                     â”‚                                   â”‚   â”‚
â”‚   â”‚      â”‚  d=5   d=3   d=1   â”‚                                   â”‚   â”‚
â”‚   â”‚      â”œâ”€â”€â”€â”€â”€â”€â”€â—‹â”€â”€â”€â”€â”€â”€â”€â—‹â”€â”€â”€â”€â”€â—  Hit!                            â”‚   â”‚
â”‚   â”‚      â”‚       â”‚       â”‚     â”‚                                   â”‚   â”‚
â”‚   â”‚      â†“       â†“       â†“     â†“                                   â”‚   â”‚
â”‚   â”‚   SDF=5   SDF=3   SDF=1  SDFâ‰ˆ0                                â”‚   â”‚
â”‚   â”‚                                                                 â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚   ì¥ì : ë¹ˆ ê³µê°„ì„ ë¹ ë¥´ê²Œ ìŠ¤í‚µ                                          â”‚
â”‚   ë‹¨ì : í‘œë©´ ê·¼ì²˜ì—ì„œ ìˆ˜ë ´ ëŠë¦¼                                        â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì…°ì´ë” íŒŒë¼ë¯¸í„°

```cpp
// DistanceFieldLightingShared.h:78-94
BEGIN_SHADER_PARAMETER_STRUCT(FDistanceFieldAtlasParameters, )
    // SDF ì—ì…‹ ë°ì´í„°
    SHADER_PARAMETER_RDG_BUFFER_SRV(StructuredBuffer<float4>, SceneDistanceFieldAssetData)

    // Indirection í…Œì´ë¸”
    SHADER_PARAMETER_RDG_BUFFER_SRV(StructuredBuffer<uint>, DistanceFieldIndirectionTable)

    // Brick í…ìŠ¤ì²˜ (3D)
    SHADER_PARAMETER_RDG_TEXTURE(Texture3D, DistanceFieldBrickTexture)
    SHADER_PARAMETER_SAMPLER(SamplerState, DistanceFieldSampler)

    // ë¸Œë¦­ Atlas íŒŒë¼ë¯¸í„°
    SHADER_PARAMETER(FVector3f, DistanceFieldBrickSize)
    SHADER_PARAMETER(FIntVector, DistanceFieldBrickAtlasSizeInBricks)
END_SHADER_PARAMETER_STRUCT()
```

---

# Part 2: LumenScene & Surface Cache

## ğŸ§­ Overview

LumenSceneì€ Lumenì´ ì‚¬ìš©í•˜ëŠ” **ëŸ°íƒ€ì„ ì”¬ í‘œí˜„**ìœ¼ë¡œ, Mesh SDFì™€ Surface Cacheë¡œ êµ¬ì„±ëœë‹¤.

**ğŸ“‚ ìœ„ì¹˜:** `Engine/Source/Runtime/Renderer/Private/Lumen/LumenSceneData.h`

---

## ğŸ§± Card ì‹œìŠ¤í…œ

### Card ë°ì´í„° êµ¬ì¡°

```cpp
// LumenMeshCards.h:28-65
class FLumenMeshCards
{
public:
    // ë¡œì»¬â†’ì›”ë“œ ë³€í™˜
    FMatrix LocalToWorld;
    FVector3f LocalToWorldScale;
    FMatrix WorldToLocalRotation;
    FBox LocalBounds;

    // í”„ë¦¬ë¯¸í‹°ë¸Œ ê·¸ë£¹ ì¸ë±ìŠ¤
    int32 PrimitiveGroupIndex;

    // í”Œë˜ê·¸
    bool bFarField;
    bool bHeightfield;
    bool bMostlyTwoSided;
    bool bEmissiveLightSource;

    // Card ì¸ë±ìŠ¤
    uint32 FirstCardIndex;
    uint32 NumCards;

    // 6ë°©í–¥ Card ë£©ì—… (Â±X, Â±Y, Â±Z)
    uint32 CardLookup[Lumen::NumAxisAlignedDirections];  // 6
};
```

### ì…°ì´ë” Card ë°ì´í„° (LumenCardCommon.ush)

```hlsl
// LumenCardCommon.ush:7-35
struct FLumenCardData
{
    // MeshCards ê³µê°„ OBB
    float3x3 MeshCardsToLocalRotation;
    float3 MeshCardsOrigin;
    float3 MeshCardsExtent;

    // ì›”ë“œ ê³µê°„ OBB
    float3x3 WorldToLocalRotation;
    float3 Origin;
    float3 LocalExtent;

    // í˜ì´ì§€ ì •ë³´
    uint2 SizeInPages;
    uint PageTableOffset;
    uint2 HiResSizeInPages;
    uint HiResPageTableOffset;

    // í•´ìƒë„ ë ˆë²¨ ë³€í™˜
    uint2 ResLevelToResLevelXYBias;

    // í”Œë˜ê·¸
    bool bVisible;
    bool bHeightfield;
    uint AxisAlignedDirection;
    uint LightingChannelMask;

    // í…ì…€ í¬ê¸°
    float TexelSize;
};

#define LUMEN_CARD_DATA_STRIDE 10  // float4 10ê°œ
```

### Card ìƒì„± (6ë°©í–¥ ìº¡ì²˜)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Card 6ë°©í–¥ ìº¡ì²˜                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚                        +Y (Top)                                         â”‚
â”‚                           â”‚                                             â”‚
â”‚                           â†“                                             â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                     â”‚
â”‚                    â”‚             â”‚                                     â”‚
â”‚           -X â†     â”‚   Mesh      â”‚     â†’ +X                            â”‚
â”‚           (Left)   â”‚   Object    â”‚     (Right)                         â”‚
â”‚                    â”‚             â”‚                                     â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                     â”‚
â”‚                           â†‘                                             â”‚
â”‚                           â”‚                                             â”‚
â”‚                        -Y (Bottom)                                      â”‚
â”‚                                                                         â”‚
â”‚                    +Z (Front), -Z (Back)ë„ ë™ì¼                         â”‚
â”‚                                                                         â”‚
â”‚   ê° ë°©í–¥ì—ì„œ Orthographic ìº¡ì²˜:                                        â”‚
â”‚   - Albedo (ë°˜ì‚¬ìœ¨)                                                    â”‚
â”‚   - Normal (ë…¸ë©€)                                                      â”‚
â”‚   - Emissive (ë°œê´‘)                                                    â”‚
â”‚   - Depth (ê¹Šì´)                                                       â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§± Surface Cache

### Surface Cache ë°ì´í„° êµ¬ì¡°

```hlsl
// LumenSurfaceCache.ush:63-74
struct FLumenSurfaceCacheData
{
    bool bValid;

    float Depth;
    float3 Albedo;
    float3 Emissive;

    // íŒŒìƒ ë°ì´í„°
    float3 WorldPosition;
    float3 WorldNormal;
};
```

### Surface Cache Atlas ë ˆì´ì•„ì›ƒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Surface Cache Atlas                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚   ã€Physical Atlas êµ¬ì¡°ã€‘                                               â”‚
â”‚                                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  Card    Card    Card    Card    Card    Card                   â”‚  â”‚
â”‚   â”‚   0       1       2       3       4       5                     â”‚  â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”   â”Œâ”€â”€â”€â”   â”Œâ”€â”€â”€â”   â”Œâ”€â”€â”€â”   â”Œâ”€â”€â”€â”   â”Œâ”€â”€â”€â”                 â”‚  â”‚
â”‚   â”‚  â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”‚  ...            â”‚  â”‚
â”‚   â”‚  â””â”€â”€â”€â”˜   â””â”€â”€â”€â”˜   â””â”€â”€â”€â”˜   â””â”€â”€â”€â”˜   â””â”€â”€â”€â”˜   â””â”€â”€â”€â”˜                 â”‚  â”‚
â”‚   â”‚                                                                 â”‚  â”‚
â”‚   â”‚  Card    Card    Card    Card    Card    Card                   â”‚  â”‚
â”‚   â”‚   6       7       8       9       10      11                    â”‚  â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”   â”Œâ”€â”€â”€â”   â”Œâ”€â”€â”€â”   â”Œâ”€â”€â”€â”   â”Œâ”€â”€â”€â”   â”Œâ”€â”€â”€â”                 â”‚  â”‚
â”‚   â”‚  â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”‚  ...            â”‚  â”‚
â”‚   â”‚  â””â”€â”€â”€â”˜   â””â”€â”€â”€â”˜   â””â”€â”€â”€â”˜   â””â”€â”€â”€â”˜   â””â”€â”€â”€â”˜   â””â”€â”€â”€â”˜                 â”‚  â”‚
â”‚   â”‚  ...                                                            â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                         â”‚
â”‚   ã€Atlas ì¢…ë¥˜ã€‘                                                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  Albedo Atlas    â”‚ RGB: ë°˜ì‚¬ìœ¨ (ê°ë§ˆ ì¸ì½”ë”©)                   â”‚   â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚   â”‚  Normal Atlas    â”‚ RG: 2D ë…¸ë©€ (Card ê³µê°„)                     â”‚   â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚   â”‚  Emissive Atlas  â”‚ R: ë°œê´‘ ê°•ë„                                â”‚   â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚   â”‚  Depth Atlas     â”‚ R: Card ê³µê°„ ê¹Šì´ (0-1 ì •ê·œí™”)              â”‚   â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚   â”‚  Direct Light    â”‚ RGB: ì§ì ‘ê´‘ Irradiance                      â”‚   â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚   â”‚  Indirect Light  â”‚ RGB: ê°„ì ‘ê´‘ Irradiance (Radiosity)          â”‚   â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚   â”‚  Final Lighting  â”‚ RGB: Direct + Indirect Ã— Albedo + Emissive â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Final Lighting ê³„ì‚°

```hlsl
// LumenSurfaceCache.ush:50-61
float3 CombineFinalLighting(float3 Albedo, float3 Emissive,
                             float3 DirectLighting, float3 IndirectLighting)
{
    Albedo = DecodeSurfaceCacheAlbedo(Albedo);

    float3 DiffuseLambert = Albedo * (1 / PI);
    float3 FinalLighting = (DirectLighting + IndirectLighting) * DiffuseLambert + Emissive;

    // ì´ìƒê°’ ë°©ì§€ (í”¼ë“œë°± ë£¨í”„ì— ì“°ê¸° ë•Œë¬¸)
    FinalLighting = max(MakeFinite(FinalLighting), float3(0.0f, 0.0f, 0.0f));

    return FinalLighting;
}
```

---

# Part 3: ScreenProbe ì‹œìŠ¤í…œ

## ğŸ§­ Overview

ScreenProbeëŠ” í™”ë©´ ê³µê°„ì— ë°°ì¹˜ëœ í”„ë¡œë¸Œë¡œ, ê° í”„ë¡œë¸Œê°€ ì£¼ë³€ í™˜ê²½ì˜ Radianceë¥¼ ìˆ˜ì§‘í•œë‹¤.

**ğŸ“‚ ìœ„ì¹˜:** `Engine/Source/Runtime/Renderer/Private/Lumen/LumenScreenProbeGather.h`

---

## ğŸ§± ScreenProbe ìƒìˆ˜

```hlsl
// LumenScreenProbeCommon.ush:10-18
#define PROBE_THREADGROUP_SIZE_2D 8
#define PROBE_THREADGROUP_SIZE_1D 64

#define PROBE_IRRADIANCE_FORMAT_SH3 0    // Spherical Harmonics
#define PROBE_IRRADIANCE_FORMAT_OCT 1    // Octahedron

#define IRRADIANCE_PROBE_RES 6           // Irradiance í•´ìƒë„
#define IRRADIANCE_PROBE_WITH_BORDER_RES (IRRADIANCE_PROBE_RES + 2)  // ë³´ë” í¬í•¨
```

### C++ ìƒìˆ˜

```cpp
// LumenScreenProbeGather.h:66-68
namespace LumenScreenProbeGather
{
    constexpr uint32 IrradianceProbeRes = 6;
    constexpr uint32 IrradianceProbeWithBorderRes = (IrradianceProbeRes + 2);
}
```

---

## ğŸ§± ScreenProbe ë°°ì¹˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ScreenProbe ë°°ì¹˜ ì „ëµ                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚   ã€Uniform Placementã€‘                                                 â”‚
â”‚                                                                         â”‚
â”‚   ScreenProbeDownsampleFactor = 16 (ê¸°ë³¸ê°’)                            â”‚
â”‚   1920Ã—1080 í™”ë©´ â†’ 120Ã—68 = 8,160ê°œ í”„ë¡œë¸Œ                             â”‚
â”‚                                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  Â·     Â·     Â·     Â·     Â·     Â·     Â·     Â·     Â·     Â·       â”‚  â”‚
â”‚   â”‚                                                                 â”‚  â”‚
â”‚   â”‚  Â·     Â·     Â·     Â·     Â·     Â·     Â·     Â·     Â·     Â·       â”‚  â”‚
â”‚   â”‚                16í”½ì…€ ê°„ê²©                                      â”‚  â”‚
â”‚   â”‚  Â·     Â·     Â·     Â·     Â·     Â·     Â·     Â·     Â·     Â·       â”‚  â”‚
â”‚   â”‚                                                                 â”‚  â”‚
â”‚   â”‚  Â·     Â·     Â·     Â·     Â·     Â·     Â·     Â·     Â·     Â·       â”‚  â”‚
â”‚   â”‚                                                                 â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                         â”‚
â”‚   ã€Adaptive Placementã€‘ (ê¹Šì´ ë¶ˆì—°ì† ì˜ì—­)                             â”‚
â”‚                                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  Â·     Â·     Â·     Â·     Â·     Â·     Â·     Â·     Â·     Â·       â”‚  â”‚
â”‚   â”‚              â†“ ê¹Šì´ ê²½ê³„                                        â”‚  â”‚
â”‚   â”‚  Â·     Â·  Â·Â·Â·Â·Â·  Â·     Â·     Â·     Â·     Â·     Â·     Â·        â”‚  â”‚
â”‚   â”‚         Â·Â·Â·Â·Â·                                                   â”‚  â”‚
â”‚   â”‚  Â·     Â·Â·Â·Â·     Â·     Â·     Â·     Â·     Â·     Â·     Â·         â”‚  â”‚
â”‚   â”‚        Â·Â·Â·                                                      â”‚  â”‚
â”‚   â”‚  Â·     Â·Â·      Â·     Â·     Â·     Â·     Â·     Â·     Â·          â”‚  â”‚
â”‚   â”‚                                                                 â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                         â”‚
â”‚   MaxNumAdaptiveProbesë¡œ ì¶”ê°€ í”„ë¡œë¸Œ ìˆ˜ ì œí•œ                           â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§± ScreenProbe GBuffer

```hlsl
// LumenScreenProbeCommon.ush:53-64
// ScreenProbeë³„ GBuffer (Atlasë¡œ ì €ì¥)
Texture2D<uint> ScreenProbeSceneDepth;    // í”„ë¡œë¸Œ ìœ„ì¹˜ ê¹Šì´ (ìŒìˆ˜=ë¬´íš¨)
Texture2D<float2> ScreenProbeWorldNormal; // ì˜¥íƒ€í—¤ë“œë¡  ì¸ì½”ë”© ë…¸ë©€
Texture2D<uint> ScreenProbeWorldSpeed;    // ì›€ì§ì„ ì†ë„ (Temporalìš©)

// Adaptive í”„ë¡œë¸Œ ë°ì´í„°
StructuredBuffer<uint> NumAdaptiveScreenProbes;  // í˜„ì¬ Adaptive í”„ë¡œë¸Œ ìˆ˜
StructuredBuffer<uint> AdaptiveScreenProbeData;  // í”„ë¡œë¸Œ ìœ„ì¹˜ ì¸ì½”ë”©

// íƒ€ì¼ë³„ Adaptive í”„ë¡œë¸Œ ì¸ë±ìŠ¤
Texture2D<uint> ScreenTileAdaptiveProbeHeader;
Texture2D<uint> ScreenTileAdaptiveProbeIndices;
```

### í”„ë¡œë¸Œ ë°ì´í„° ì¸ì½”ë”©

```hlsl
// LumenScreenProbeCommon.ush:111-119
uint EncodeScreenProbeData(uint2 ScreenProbeScreenPosition)
{
    return (ScreenProbeScreenPosition.x & 0xFFFF) |
           ((ScreenProbeScreenPosition.y & 0xFFFF) << 16);
}

uint2 DecodeScreenProbeData(uint EncodedProbeData)
{
    return uint2(EncodedProbeData & 0xFFFF, (EncodedProbeData >> 16) & 0xFFFF);
}
```

---

## ğŸ§± Octahedron RadianceMap

### êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Octahedron RadianceMap                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚   ã€Tracing í•´ìƒë„ã€‘ ScreenProbeTracingOctahedronResolution = 8        â”‚
â”‚   ã€Gather í•´ìƒë„ã€‘ ScreenProbeGatherOctahedronResolution = 8          â”‚
â”‚   ã€ë³´ë” í¬í•¨ã€‘ ScreenProbeGatherOctahedronResolutionWithBorder = 10   â”‚
â”‚                                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                                                                  â”‚  â”‚
â”‚   â”‚   êµ¬ë©´ â†’ íŒ”ë©´ì²´ â†’ 2D ì „ê°œ                                       â”‚  â”‚
â”‚   â”‚                                                                  â”‚  â”‚
â”‚   â”‚       ____                     /\                               â”‚  â”‚
â”‚   â”‚     /      \                  /  \                              â”‚  â”‚
â”‚   â”‚    |   â—   |    â†’           /    \      â†’   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚  â”‚
â”‚   â”‚    |  ë°©í–¥  |               /______\         â”‚ 8Ã—8 í…ì…€ â”‚       â”‚  â”‚
â”‚   â”‚     \____/                  \      /         â”‚ Radiance â”‚       â”‚  â”‚
â”‚   â”‚                              \    /          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚  â”‚
â”‚   â”‚   (ì „ë°©í–¥)                    \  /                              â”‚  â”‚
â”‚   â”‚                                \/                               â”‚  â”‚
â”‚   â”‚                                                                  â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                         â”‚
â”‚   ã€Atlas ì €ì¥ã€‘                                                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚  P0   P1   P2   P3   P4   P5   ...   P119                     â”‚    â”‚
â”‚   â”‚ â”Œâ”€â”€â” â”Œâ”€â”€â” â”Œâ”€â”€â” â”Œâ”€â”€â” â”Œâ”€â”€â” â”Œâ”€â”€â”       â”Œâ”€â”€â”                     â”‚    â”‚
â”‚   â”‚ â”‚8 â”‚ â”‚8 â”‚ â”‚8 â”‚ â”‚8 â”‚ â”‚8 â”‚ â”‚8 â”‚  ...  â”‚8 â”‚   â† í–‰ 0            â”‚    â”‚
â”‚   â”‚ â”‚Ã—8â”‚ â”‚Ã—8â”‚ â”‚Ã—8â”‚ â”‚Ã—8â”‚ â”‚Ã—8â”‚ â”‚Ã—8â”‚       â”‚Ã—8â”‚                     â”‚    â”‚
â”‚   â”‚ â””â”€â”€â”˜ â””â”€â”€â”˜ â””â”€â”€â”˜ â””â”€â”€â”˜ â””â”€â”€â”˜ â””â”€â”€â”˜       â””â”€â”€â”˜                     â”‚    â”‚
â”‚   â”‚  ...                                                          â”‚    â”‚
â”‚   â”‚                                                â† í–‰ 67        â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                         â”‚
â”‚   Atlas í¬ê¸°: (120Ã—8) Ã— (68Ã—8) = 960 Ã— 544 í…ì…€                        â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§± Temporal Jitter

```hlsl
// LumenScreenProbeCommon.ush:67-76
#define SCREEN_TEMPORAL_INDEX (FixedJitterIndex < 0 ? View.StateFrameIndexMod8 : FixedJitterIndex)
#define SCREEN_PROBE_JITTER_INDEX (FixedJitterIndex < 0 ? View.StateFrameIndex : FixedJitterIndex)

// [0, ScreenProbeDownsampleFactor - 1] ë²”ìœ„ ì§€í„° ì˜¤í”„ì…‹ ë°˜í™˜
uint2 GetScreenTileJitter(uint TemporalIndex)
{
    return Hammersley16(TemporalIndex, 8, 0) * ScreenProbeDownsampleFactor;
}
```

---

# Part 4: Radiance Cache

## ğŸ§­ Overview

Radiance CacheëŠ” **ì›”ë“œ ê³µê°„**ì— ë°°ì¹˜ëœ í”„ë¡œë¸Œ ìºì‹œë¡œ, ScreenProbeê°€ ë„ë‹¬í•˜ì§€ ëª»í•˜ëŠ” **ì›ê±°ë¦¬ ê°„ì ‘ê´‘**ì„ ì²˜ë¦¬í•œë‹¤.

**ğŸ“‚ ìœ„ì¹˜:** `Engine/Source/Runtime/Renderer/Private/Lumen/LumenRadianceCache.h`

---

## ğŸ§± Radiance Cache êµ¬ì¡°

```cpp
// LumenRadianceCache.h:26-30
struct FRadianceCacheConfiguration
{
    bool bFarField = true;       // ì›ê±°ë¦¬ í•„ë“œ ì‚¬ìš©
    bool bSkyVisibility = false; // í•˜ëŠ˜ ê°€ì‹œì„±
};
```

### Mark Parameters

```cpp
// LumenRadianceCache.h:15-21
BEGIN_SHADER_PARAMETER_STRUCT(FRadianceCacheMarkParameters, )
    SHADER_PARAMETER_RDG_TEXTURE_UAV(RWTexture3D<uint>, RWRadianceProbeIndirectionTexture)
    SHADER_PARAMETER_ARRAY(FVector4f, ClipmapCornerTWSAndCellSizeForMark, [MaxClipmaps])
    SHADER_PARAMETER(uint32, RadianceProbeClipmapResolutionForMark)
    SHADER_PARAMETER(uint32, NumRadianceProbeClipmapsForMark)
    SHADER_PARAMETER(float, InvClipmapFadeSizeForMark)
END_SHADER_PARAMETER_STRUCT()
```

### Update íŒŒì´í”„ë¼ì¸

```cpp
// LumenRadianceCache.h:99-112
/**
 * ìš”ì²­ëœ Radiance Cacheë“¤ì„ ì—…ë°ì´íŠ¸, ë””ìŠ¤íŒ¨ì¹˜ ì˜¤ë²„ë©ìœ¼ë¡œ GPU í™œìš©ë„ í–¥ìƒ.
 * MarkUsedRadianceCacheProbesì—ì„œ ë§ˆí‚¹ëœ ìœ„ì¹˜ ì£¼ë³€ì— í”„ë¡œë¸Œ ë°°ì¹˜,
 * ê°€ëŠ¥í•˜ë©´ ìºì‹œëœ ê²°ê³¼ ì¬ì‚¬ìš©, ì¼ë¶€ í”„ë¡œë¸Œë§Œ íŠ¸ë ˆì´ì‹±ìœ¼ë¡œ ì—…ë°ì´íŠ¸.
 * FRadianceCacheInterpolationParametersë¡œ ë§ˆí‚¹ëœ ìœ„ì¹˜ì—ì„œ ë³´ê°„ ê°€ëŠ¥.
 */
void UpdateRadianceCaches(
    FRDGBuilder& GraphBuilder,
    const FLumenSceneFrameTemporaries& FrameTemporaries,
    const TInlineArray<FUpdateInputs>& InputArray,
    TInlineArray<FUpdateOutputs>& OutputArray,
    const FScene* Scene,
    const FViewFamilyInfo& ViewFamily,
    bool bPropagateGlobalLightingChange,
    ERDGPassFlags ComputePassFlags = ERDGPassFlags::Compute);
```

---

## ğŸ§± Radiance Cache Clipmap

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Radiance Cache Clipmap                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚   Global SDFì™€ ìœ ì‚¬í•œ Clipmap êµ¬ì¡°, ì›”ë“œ ê³µê°„ì—ì„œ ìš´ì˜                  â”‚
â”‚                                                                         â”‚
â”‚               Clipmap 2 (ê°€ì¥ ë„“ìŒ)                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚                                                                â”‚    â”‚
â”‚   â”‚         Clipmap 1                                              â”‚    â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚    â”‚
â”‚   â”‚   â”‚                                                    â”‚       â”‚    â”‚
â”‚   â”‚   â”‚         Clipmap 0 (ê°€ì¥ ì •ë°€)                      â”‚       â”‚    â”‚
â”‚   â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚       â”‚    â”‚
â”‚   â”‚   â”‚   â”‚                                        â”‚       â”‚       â”‚    â”‚
â”‚   â”‚   â”‚   â”‚         Camera â—                       â”‚       â”‚       â”‚    â”‚
â”‚   â”‚   â”‚   â”‚                                        â”‚       â”‚       â”‚    â”‚
â”‚   â”‚   â”‚   â”‚   ScreenProbe ë²”ìœ„ ë‚´                  â”‚       â”‚       â”‚    â”‚
â”‚   â”‚   â”‚   â”‚                                        â”‚       â”‚       â”‚    â”‚
â”‚   â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚       â”‚    â”‚
â”‚   â”‚   â”‚                                                    â”‚       â”‚    â”‚
â”‚   â”‚   â”‚   Radiance Cacheê°€ ì›ê±°ë¦¬ ì»¤ë²„                     â”‚       â”‚    â”‚
â”‚   â”‚   â”‚                                                    â”‚       â”‚    â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚    â”‚
â”‚   â”‚                                                                â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                         â”‚
â”‚   ScreenProbe: í™”ë©´ ê³µê°„, ê·¼ê±°ë¦¬ ì •ë°€                                  â”‚
â”‚   Radiance Cache: ì›”ë“œ ê³µê°„, ì›ê±°ë¦¬ íš¨ìœ¨                               â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

# Part 5: Tracing ê³„ì¸µ

## ğŸ§­ Overview

Lumenì€ **ê³„ì¸µì  íŠ¸ë ˆì´ì‹±**ì„ í†µí•´ ë¹„ìš©ê³¼ í’ˆì§ˆì˜ ê· í˜•ì„ ë§ì¶˜ë‹¤.

**ğŸ“‚ ìœ„ì¹˜:** `Engine/Source/Runtime/Renderer/Private/Lumen/LumenTracingUtils.h`

---

## ğŸ§± íŠ¸ë ˆì´ì‹± ê³„ì¸µ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Lumen Tracing ê³„ì¸µ                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚   1ë‹¨ê³„: Screen Space Tracing (HZB)                                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  â€¢ Hierarchical Z-Buffer ì‚¬ìš©                                    â”‚  â”‚
â”‚   â”‚  â€¢ í™”ë©´ì— ë³´ì´ëŠ” ì§€ì˜¤ë©”íŠ¸ë¦¬ë§Œ ì¶”ì                                â”‚  â”‚
â”‚   â”‚  â€¢ ê°€ì¥ ë¹ ë¦„, ëŒ€ë¶€ë¶„ì˜ íˆíŠ¸ ì²˜ë¦¬                                 â”‚  â”‚
â”‚   â”‚  ë¹„ìš©: â˜…â˜†â˜†â˜†â˜†                                                    â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚ Miss                                     â”‚
â”‚                              â†“                                          â”‚
â”‚   2ë‹¨ê³„: Mesh SDF Tracing                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  â€¢ ê°œë³„ ë©”ì‹œì˜ SDF ì‚¬ìš©                                          â”‚  â”‚
â”‚   â”‚  â€¢ ê·¼~ì¤‘ê±°ë¦¬ ì •ë°€ ì¶”ì                                            â”‚  â”‚
â”‚   â”‚  â€¢ Sphere Tracing ì•Œê³ ë¦¬ì¦˜                                       â”‚  â”‚
â”‚   â”‚  ë¹„ìš©: â˜…â˜…â˜†â˜†â˜†                                                    â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚ Miss                                     â”‚
â”‚                              â†“                                          â”‚
â”‚   3ë‹¨ê³„: Global SDF Tracing                                            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  â€¢ í†µí•©ëœ Global SDF Clipmap ì‚¬ìš©                                â”‚  â”‚
â”‚   â”‚  â€¢ ì›ê±°ë¦¬ ì¶”ì ì— íš¨ìœ¨ì                                           â”‚  â”‚
â”‚   â”‚  â€¢ í•´ìƒë„ ì œí•œìœ¼ë¡œ ë””í…Œì¼ ì†ì‹¤                                   â”‚  â”‚
â”‚   â”‚  ë¹„ìš©: â˜…â˜…â˜…â˜†â˜†                                                    â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚ Hit                                      â”‚
â”‚                              â†“                                          â”‚
â”‚   Surface Cache ì¡°íšŒ                                                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  â€¢ SDF íˆíŠ¸ ì§€ì ì—ì„œ Card UV ê³„ì‚°                                â”‚  â”‚
â”‚   â”‚  â€¢ Final Lighting Atlasì—ì„œ Radiance ì½ê¸°                        â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                         â”‚
â”‚   ì„ íƒì : Hardware Ray Tracing                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  â€¢ RTX í•˜ë“œì›¨ì–´ í•„ìš”                                             â”‚  â”‚
â”‚   â”‚  â€¢ ê°€ì¥ ì •í™•, ê°€ì¥ ë¹„ìŒˆ                                          â”‚  â”‚
â”‚   â”‚  â€¢ SDF ëŒ€ì²´ ë˜ëŠ” í•˜ì´ë¸Œë¦¬ë“œ                                      â”‚  â”‚
â”‚   â”‚  ë¹„ìš©: â˜…â˜…â˜…â˜…â˜…                                                    â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§± íŠ¸ë ˆì´ì‹± íŒŒë¼ë¯¸í„°

```cpp
// LumenTracingUtils.h:108-122
BEGIN_SHADER_PARAMETER_STRUCT(FLumenIndirectTracingParameters, )
    SHADER_PARAMETER(float, StepFactor)
    SHADER_PARAMETER(float, CardTraceEndDistanceFromCamera)
    SHADER_PARAMETER(float, DiffuseConeHalfAngle)
    SHADER_PARAMETER(float, TanDiffuseConeHalfAngle)
    SHADER_PARAMETER(float, MinSampleRadius)
    SHADER_PARAMETER(float, MinTraceDistance)
    SHADER_PARAMETER(float, MaxTraceDistance)
    SHADER_PARAMETER(float, MaxMeshSDFTraceDistance)
    SHADER_PARAMETER(float, SurfaceBias)
    SHADER_PARAMETER(float, CardInterpolateInfluenceRadius)
    SHADER_PARAMETER(float, SpecularFromDiffuseRoughnessStart)
    SHADER_PARAMETER(float, SpecularFromDiffuseRoughnessEnd)
    SHADER_PARAMETER(int32, HeightfieldMaxTracingSteps)
END_SHADER_PARAMETER_STRUCT()
```

### MeshSDF Grid íŒŒë¼ë¯¸í„°

```cpp
// LumenTracingUtils.h:92-106
BEGIN_SHADER_PARAMETER_STRUCT(FLumenMeshSDFGridParameters, )
    SHADER_PARAMETER_STRUCT_INCLUDE(FLumenMeshSDFTracingParameters, TracingParameters)

    // ì»¬ë§ëœ MeshSDF ì˜¤ë¸Œì íŠ¸
    SHADER_PARAMETER_RDG_BUFFER_SRV(Buffer<uint>, NumGridCulledMeshSDFObjects)
    SHADER_PARAMETER_RDG_BUFFER_SRV(Buffer<uint>, GridCulledMeshSDFObjectStartOffsetArray)
    SHADER_PARAMETER_RDG_BUFFER_SRV(Buffer<uint>, GridCulledMeshSDFObjectIndicesArray)

    // ê·¸ë¦¬ë“œ íŒŒë¼ë¯¸í„°
    SHADER_PARAMETER(uint32, CardGridPixelSizeShift)
    SHADER_PARAMETER(FVector3f, CardGridZParams)
    SHADER_PARAMETER(FIntVector, CullGridSize)

    // Heightfield ë°ì´í„°
    SHADER_PARAMETER_RDG_BUFFER_SRV(Buffer<uint>, NumCulledHeightfieldObjects)
    SHADER_PARAMETER_RDG_BUFFER_SRV(Buffer<uint>, CulledHeightfieldObjectIndexBuffer)
END_SHADER_PARAMETER_STRUCT()
```

---

## ğŸ§± HZB Screen Tracing

```cpp
// LumenTracingUtils.h:132-141
BEGIN_SHADER_PARAMETER_STRUCT(FLumenHZBScreenTraceParameters, )
    SHADER_PARAMETER_RDG_TEXTURE_SRV(Texture2D, PrevSceneColorTexture)
    SHADER_PARAMETER_RDG_TEXTURE(Texture2D, HistorySceneDepth)
    SHADER_PARAMETER_STRUCT_INCLUDE(FHZBParameters, HZBParameters)
    SHADER_PARAMETER(FVector2f, PrevSceneColorBilinearUVMin)
    SHADER_PARAMETER(FVector2f, PrevSceneColorBilinearUVMax)
    SHADER_PARAMETER(FVector4f, PrevScreenPositionScaleBias)
    SHADER_PARAMETER(FVector4f, PrevScreenPositionScaleBiasForDepth)
    SHADER_PARAMETER(float, PrevSceneColorPreExposureCorrection)
END_SHADER_PARAMETER_STRUCT()
```

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    HZB (Hierarchical Z-Buffer) Tracing                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚   ã€HZB Mip Chainã€‘                                                     â”‚
â”‚                                                                         â”‚
â”‚   Mip 0: 1920Ã—1080 (ì›ë³¸ Depth)                                        â”‚
â”‚   Mip 1: 960Ã—540   (2Ã—2 ì˜ì—­ì˜ Min Depth)                              â”‚
â”‚   Mip 2: 480Ã—270   (2Ã—2 ì˜ì—­ì˜ Min Depth)                              â”‚
â”‚   Mip 3: 240Ã—135   (2Ã—2 ì˜ì—­ì˜ Min Depth)                              â”‚
â”‚   ...                                                                   â”‚
â”‚                                                                         â”‚
â”‚   ã€ì•Œê³ ë¦¬ì¦˜ã€‘                                                          â”‚
â”‚                                                                         â”‚
â”‚   1. ë†’ì€ Mipì—ì„œ ì‹œì‘ (ì €í•´ìƒë„)                                      â”‚
â”‚   2. Rayê°€ í˜„ì¬ ì…€ë³´ë‹¤ ì•: Mip ê°ì†Œ (ë” ì •ë°€í•˜ê²Œ)                      â”‚
â”‚   3. Rayê°€ í˜„ì¬ ì…€ë³´ë‹¤ ë’¤: ë‹¤ìŒ ìŠ¤í…ìœ¼ë¡œ                               â”‚
â”‚   4. Mip 0ì—ì„œ Depth êµì°¨: Hit!                                        â”‚
â”‚                                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚   â”‚                                                     â”‚               â”‚
â”‚   â”‚   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ     Mip 2 ê²€ì‚¬                  â”‚               â”‚
â”‚   â”‚       â†“ êµì°¨ ê°€ëŠ¥                                  â”‚               â”‚
â”‚   â”‚   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     Mip 1 ê²€ì‚¬                  â”‚               â”‚
â”‚   â”‚     â†“ êµì°¨ ê°€ëŠ¥                                    â”‚               â”‚
â”‚   â”‚   â–ˆâ–ˆâ–ˆâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     Mip 0 â† Hit!               â”‚               â”‚
â”‚   â”‚     â†‘                                              â”‚               â”‚
â”‚   â”‚   Ray ~~~~~~~~~~~~â†’                                â”‚               â”‚
â”‚   â”‚                                                     â”‚               â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

# Part 6: Reflections

## ğŸ§­ Overview

Lumen ReflectionsëŠ” Lumen GI ì¸í”„ë¼ë¥¼ í™œìš©í•˜ì—¬ **ì‹¤ì‹œê°„ ë°˜ì‚¬**ë¥¼ ê³„ì‚°í•œë‹¤.

**ğŸ“‚ ìœ„ì¹˜:** `Engine/Source/Runtime/Renderer/Private/Lumen/LumenReflections.h`

---

## ğŸ§± ë°˜ì‚¬ íŒŒë¼ë¯¸í„°

```cpp
// LumenReflections.h:48-91
BEGIN_SHADER_PARAMETER_STRUCT(FLumenReflectionTracingParameters, )
    // ë‹¤ìš´ìƒ˜í”Œë§
    SHADER_PARAMETER(FIntPoint, ReflectionDownsampleFactorXY)
    SHADER_PARAMETER(FIntPoint, ReflectionTracingViewSize)
    SHADER_PARAMETER(FIntPoint, ReflectionTracingBufferSize)

    // ë ˆì´ ê°•ë„ ì œí•œ
    SHADER_PARAMETER(float, MaxRayIntensity)

    // ë°˜ì‚¬ íŒ¨ìŠ¤ ì •ë³´
    SHADER_PARAMETER(uint32, ReflectionPass)
    SHADER_PARAMETER(uint32, UseJitter)
    SHADER_PARAMETER(uint32, UseHighResSurface)

    // ë°”ìš´ìŠ¤
    SHADER_PARAMETER(uint32, MaxReflectionBounces)
    SHADER_PARAMETER(uint32, MaxRefractionBounces)

    // íŠ¸ë ˆì´ìŠ¤ ê±°ë¦¬
    SHADER_PARAMETER(float, NearFieldMaxTraceDistance)
    SHADER_PARAMETER(float, FarFieldMaxTraceDistance)

    // í…ìŠ¤ì²˜
    SHADER_PARAMETER_RDG_TEXTURE(Texture2D<float4>, RayBuffer)
    SHADER_PARAMETER_RDG_TEXTURE(Texture2D, TraceHit)
    SHADER_PARAMETER_RDG_TEXTURE(Texture2D, TraceRadiance)

    // Pre-integrated GF (Split Sum)
    SHADER_PARAMETER_TEXTURE(Texture2D, PreIntegratedGF)
    SHADER_PARAMETER_SAMPLER(SamplerState, PreIntegratedGFSampler)
END_SHADER_PARAMETER_STRUCT()
```

### Composite íŒŒë¼ë¯¸í„°

```cpp
// LumenReflections.h:31-38
BEGIN_SHADER_PARAMETER_STRUCT(FCompositeParameters, )
    SHADER_PARAMETER(float, MaxRoughnessToTrace)
    SHADER_PARAMETER(float, MaxRoughnessToTraceForFoliage)
    SHADER_PARAMETER(float, InvRoughnessFadeLength)
    SHADER_PARAMETER(float, ReflectionSmoothBias)
END_SHADER_PARAMETER_STRUCT()
```

---

## ğŸ§± ë°˜ì‚¬ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜

```cpp
// LumenReflections.h:112-132
namespace LumenReflections
{
    bool UseFarField(const FSceneViewFamily& ViewFamily);
    bool UseHitLighting(const FViewInfo& View, EDiffuseIndirectMethod DiffuseIndirectMethod);
    bool UseTranslucentRayTracing(const FViewInfo& View);
    bool UseSurfaceCacheFeedback();
    bool UseScreenTraces(const FViewInfo& View);
    bool UseDistantScreenTraces(const FViewInfo& View, bool bUseFarField, bool bUseRadianceCache);
    bool UseRadianceCache();
    bool UseRadianceCacheSkyVisibility();
    bool UseRadianceCacheStochasticInterpolation();

    // ê¹Šì´/ë…¸ë©€ ì„ê³„ê°’
    float GetSampleSceneColorDepthTreshold();
    float GetSampleSceneColorNormalTreshold();
    float GetFarFieldSampleSceneColorDepthTreshold();
    float GetFarFieldSampleSceneColorNormalTreshold();

    // ë°”ìš´ìŠ¤ ìˆ˜
    uint32 GetMaxReflectionBounces(const FViewInfo& View);
    uint32 GetMaxRefractionBounces(const FViewInfo& View);
}
```

---

# Part 7: Scene Direct Lighting

## ğŸ§­ Overview

Lumen Scene Direct Lightingì€ Surface Cacheì— **ì§ì ‘ê´‘**ì„ ë Œë”ë§í•œë‹¤.

**ğŸ“‚ ìœ„ì¹˜:** `Engine/Source/Runtime/Renderer/Private/Lumen/LumenSceneLighting.h`

---

## ğŸ§± ë¼ì´íŠ¸ íƒ€ì…

```cpp
// LumenSceneLighting.h:146-155
// LumenSceneDirectLighting.usfì˜ LIGHT_TYPE_*ê³¼ ì¼ì¹˜
enum class ELumenLightType
{
    Directional,
    Point,
    Spot,
    Rect,

    MAX
};
```

### ë¼ì´íŠ¸ ë°ì´í„° íŒŒë¼ë¯¸í„°

```cpp
// LumenSceneLighting.h:227-231
BEGIN_SHADER_PARAMETER_STRUCT(FLightDataParameters, )
    SHADER_PARAMETER_RDG_BUFFER_SRV(StructuredBuffer<FLumenPackedLight>, LumenPackedLights)
    SHADER_PARAMETER_RDG_BUFFER_SRV(StructuredBuffer<float4>, LumenLightInfluenceSpheres)
END_SHADER_PARAMETER_STRUCT()
```

### Shadow Ray Bias

```cpp
// LumenSceneLighting.h:234-237
namespace LumenSceneDirectLighting
{
    float GetMeshSDFShadowRayBias();
    float GetHeightfieldShadowRayBias();
    float GetGlobalSDFShadowRayBias();
    float GetHardwareRayTracingShadowRayBias();

    bool UseStochasticLighting(const FSceneViewFamily& ViewFamily);
    bool UseLightTilesPerLightType();
}
```

---

## ğŸ§± Card Update Context

```cpp
// LumenSceneLighting.h:25-43
class FLumenCardUpdateContext
{
public:
    enum EIndirectArgOffset
    {
        ThreadPerPage = 0 * sizeof(FRHIDispatchIndirectParameters),
        ThreadPerTile = 1 * sizeof(FRHIDispatchIndirectParameters),
        MAX = 2,
    };

    FRDGBufferRef CardPageIndexAllocator;
    FRDGBufferRef CardPageIndexData;
    FRDGBufferRef DrawCardPageIndicesIndirectArgs;
    FRDGBufferRef DispatchCardPageIndicesIndirectArgs;

    FIntPoint UpdateAtlasSize;
    uint32 MaxUpdateTiles;
    uint32 UpdateFactor;
};
```

---

# Part 8: Importance Sampling & Temporal

## ğŸ§± Importance Sampling

```cpp
// LumenScreenProbeGather.h:91-95
BEGIN_SHADER_PARAMETER_STRUCT(FScreenProbeImportanceSamplingParameters, )
    SHADER_PARAMETER(uint32, MaxImportanceSamplingOctahedronResolution)
    SHADER_PARAMETER(uint32, ScreenProbeBRDFOctahedronResolution)
    SHADER_PARAMETER_RDG_TEXTURE(Texture2D<uint>, StructuredImportanceSampledRayInfosForTracing)
END_SHADER_PARAMETER_STRUCT()
```

### BRDF PDF ìƒì„±

```cpp
// LumenScreenProbeGather.h:183-190
extern void GenerateBRDF_PDF(
    FRDGBuilder& GraphBuilder,
    const FViewInfo& View,
    const FSceneTextures& SceneTextures,
    FRDGTextureRef& BRDFProbabilityDensityFunction,
    FRDGBufferSRVRef& BRDFProbabilityDensityFunctionSH,
    FScreenProbeParameters& ScreenProbeParameters,
    ERDGPassFlags ComputePassFlags);
```

---

## ğŸ§± Temporal Reprojection

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Temporal Reprojection                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚   ã€ì›ë¦¬ã€‘                                                              â”‚
â”‚   - ë§¤ í”„ë ˆì„ ì ì€ ìƒ˜í”Œ (N=4)ë¡œ íŠ¸ë ˆì´ì‹±                               â”‚
â”‚   - ì´ì „ í”„ë ˆì„ ê²°ê³¼ì™€ ë¸”ë Œë”©                                          â”‚
â”‚   - ì‹œê°„ì— ë”°ë¼ ìƒ˜í”Œ ëˆ„ì  â†’ í’ˆì§ˆ í–¥ìƒ                                  â”‚
â”‚                                                                         â”‚
â”‚   ã€íŒŒì´í”„ë¼ì¸ã€‘                                                        â”‚
â”‚                                                                         â”‚
â”‚   í˜„ì¬ í”„ë ˆì„          Velocity Buffer         íˆìŠ¤í† ë¦¬ ì¡°íšŒ            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚   â”‚ ìƒˆ ìƒ˜í”Œ  â”‚   +    â”‚ ì´ì „ ìœ„ì¹˜   â”‚   â†’    â”‚ ì´ì „ ê²°ê³¼   â”‚         â”‚
â”‚   â”‚ ê³„ì‚°     â”‚        â”‚ ê³„ì‚°        â”‚        â”‚ ì½ê¸°        â”‚         â”‚
â”‚   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚        â”‚                                              â”‚                 â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                           â†“                                             â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚                    â”‚   ë¸”ë Œë”©     â”‚                                    â”‚
â”‚                    â”‚ Î± = 1/(N+1) â”‚                                    â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚                           â†“                                             â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚                    â”‚ í˜„ì¬ ê²°ê³¼   â”‚                                    â”‚
â”‚                    â”‚ ì¶œë ¥        â”‚                                    â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚                                                                         â”‚
â”‚   ã€ë¬´íš¨í™” ì¡°ê±´ã€‘                                                       â”‚
â”‚   - í™”ë©´ ë°–ìœ¼ë¡œ ë‚˜ê°„ í”½ì…€                                              â”‚
â”‚   - ê¹Šì´ ì°¨ì´ê°€ í° ê²½ìš° (Disocclusion)                                 â”‚
â”‚   - ë…¸ë©€ ì°¨ì´ê°€ í° ê²½ìš°                                                â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

# Part 9: í†µí•© ìœ í‹¸ë¦¬í‹°

## ğŸ§± Card Tracing Parameters

```cpp
// LumenTracingUtils.h:38-74
BEGIN_SHADER_PARAMETER_STRUCT(FLumenCardTracingParameters, )
    SHADER_PARAMETER_STRUCT_REF(FViewUniformShaderParameters, View)
    SHADER_PARAMETER_RDG_UNIFORM_BUFFER(FSceneUniformParameters, Scene)
    SHADER_PARAMETER_RDG_UNIFORM_BUFFER(FReflectionUniformParameters, ReflectionStruct)
    SHADER_PARAMETER_RDG_UNIFORM_BUFFER(FLumenCardScene, LumenCardScene)

    // ë¼ì´íŒ… ë¶€ìŠ¤íŠ¸
    SHADER_PARAMETER(float, DiffuseColorBoost)

    // í•˜ëŠ˜ Leaking
    SHADER_PARAMETER(FVector3f, SkylightLeakingColor)
    SHADER_PARAMETER(float, ReflectionSkylightLeakingAverageAlbedo)
    SHADER_PARAMETER(float, SkylightLeakingRoughness)
    SHADER_PARAMETER(float, InvFullSkylightLeakingDistance)

    // Pre-exposure
    SHADER_PARAMETER(float, CachedLightingPreExposure)
    SHADER_PARAMETER(float, OneOverCachedLightingPreExposure)

    // Fog
    SHADER_PARAMETER(uint32, SampleHeightFog)
    SHADER_PARAMETER_RDG_UNIFORM_BUFFER(FFogUniformParameters, FogUniformParameters)

    // Surface Cache í”¼ë“œë°±
    SHADER_PARAMETER_RDG_BUFFER_UAV(RWStructuredBuffer<uint>, RWCardPageLastUsedBuffer)
    SHADER_PARAMETER_RDG_BUFFER_UAV(RWStructuredBuffer<uint>, RWCardPageHighResLastUsedBuffer)
    SHADER_PARAMETER_RDG_BUFFER_UAV(RWStructuredBuffer<uint>, RWSurfaceCacheFeedbackBufferAllocator)
    SHADER_PARAMETER_RDG_BUFFER_UAV(RWStructuredBuffer<uint2>, RWSurfaceCacheFeedbackBuffer)

    // Atlas í…ìŠ¤ì²˜
    SHADER_PARAMETER_RDG_TEXTURE(Texture2D, DirectLightingAtlas)
    SHADER_PARAMETER_RDG_TEXTURE(Texture2D, IndirectLightingAtlas)
    SHADER_PARAMETER_RDG_TEXTURE(Texture2D, FinalLightingAtlas)
    SHADER_PARAMETER_RDG_TEXTURE(Texture2D, AlbedoAtlas)
    SHADER_PARAMETER_RDG_TEXTURE(Texture2D, OpacityAtlas)
    SHADER_PARAMETER_RDG_TEXTURE(Texture2D, NormalAtlas)
    SHADER_PARAMETER_RDG_TEXTURE(Texture2D, EmissiveAtlas)
    SHADER_PARAMETER_RDG_TEXTURE(Texture2D, DepthAtlas)
END_SHADER_PARAMETER_STRUCT()
```

---

## ğŸ§© ì „ì²´ íŒŒì´í”„ë¼ì¸ ìš”ì•½

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Lumen GI ì „ì²´ íŒŒì´í”„ë¼ì¸                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  1. LumenScene ì¤€ë¹„                                                    â”‚
â”‚     â””â”€â†’ Mesh SDF ìƒì„±/ì—…ë°ì´íŠ¸                                         â”‚
â”‚     â””â”€â†’ Surface Cache (Cards) ìº¡ì²˜                                     â”‚
â”‚     â””â”€â†’ Global SDF Clipmap ì—…ë°ì´íŠ¸                                    â”‚
â”‚     â””â”€â†’ Direct Lighting â†’ Surface Cache                                â”‚
â”‚                                                                         â”‚
â”‚  2. ScreenProbe ë°°ì¹˜                                                   â”‚
â”‚     â””â”€â†’ Uniform ê·¸ë¦¬ë“œ (16Ã—16 í”½ì…€ ê°„ê²©)                               â”‚
â”‚     â””â”€â†’ Adaptive ì¶”ê°€ (ê¹Šì´ ë¶ˆì—°ì†)                                    â”‚
â”‚     â””â”€â†’ ~8,000-10,000ê°œ í”„ë¡œë¸Œ                                         â”‚
â”‚                                                                         â”‚
â”‚  3. Ray Generation                                                     â”‚
â”‚     â””â”€â†’ ê° í”„ë¡œë¸Œì—ì„œ 64ê°œ ë°©í–¥ (8Ã—8 Octahedron)                       â”‚
â”‚     â””â”€â†’ Importance Sampling (Normal + Previous Luminance)              â”‚
â”‚     â””â”€â†’ í”„ë ˆì„ë³„ Jitter                                                â”‚
â”‚                                                                         â”‚
â”‚  4. Hierarchical Tracing                                               â”‚
â”‚     â””â”€â†’ Screen Space (HZB) â†’ Hit: í™”ë©´ ìƒ‰ìƒ                            â”‚
â”‚     â””â”€â†’ Mesh SDF â†’ Hit: Surface Cache                                  â”‚
â”‚     â””â”€â†’ Global SDF â†’ Hit: Surface Cache                                â”‚
â”‚     â””â”€â†’ (Optional) Hardware RT                                         â”‚
â”‚                                                                         â”‚
â”‚  5. RadianceMap ìƒì„±                                                   â”‚
â”‚     â””â”€â†’ 64ê°œ ë°©í–¥ Radiance â†’ Atlas ì €ì¥                                â”‚
â”‚     â””â”€â†’ ê° í”„ë¡œë¸Œ = 8Ã—8 í…ì…€                                           â”‚
â”‚                                                                         â”‚
â”‚  6. RadianceMap â†’ IrradianceMap                                        â”‚
â”‚     â””â”€â†’ Cosine-weighted ì ë¶„                                           â”‚
â”‚     â””â”€â†’ Border ì¶”ê°€ (Bilinear ì •í™•ë„)                                  â”‚
â”‚                                                                         â”‚
â”‚  7. Integrate per Pixel                                                â”‚
â”‚     â””â”€â†’ Stochastic Probe ì„ íƒ (4ê°œ ì¤‘ 1ê°œ)                             â”‚
â”‚     â””â”€â†’ Diffuse: IrradianceMap                                         â”‚
â”‚     â””â”€â†’ Specular: RadianceMap (N=4 ìƒ˜í”Œë§)                             â”‚
â”‚                                                                         â”‚
â”‚  8. Temporal Reprojection                                              â”‚
â”‚     â””â”€â†’ Velocity Bufferë¡œ ì´ì „ ìœ„ì¹˜                                    â”‚
â”‚     â””â”€â†’ History ë¸”ë Œë”© (Î± = 1/(Count+1))                               â”‚
â”‚     â””â”€â†’ Count Buffer ì—…ë°ì´íŠ¸                                          â”‚
â”‚                                                                         â”‚
â”‚  9. ìµœì¢… ì¶œë ¥                                                          â”‚
â”‚     â””â”€â†’ DiffuseIndirect + SpecularIndirect                             â”‚
â”‚     â””â”€â†’ + Direct Lighting â†’ Final Image                                â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’¡ ì„±ëŠ¥ ìµœì í™” í¬ì¸íŠ¸

| ì˜ì—­ | ê¸°ë²• | íš¨ê³¼ |
|------|------|------|
| **ìƒ˜í”Œ ìˆ˜** | N=4 + Temporal | 256Ã— ì—°ì‚° ê°ì†Œ |
| **Probe ë³´ê°„** | Stochastic (1/4) | 4Ã— í…ìŠ¤ì²˜ ì½ê¸° ê°ì†Œ |
| **Tracing ê³„ì¸µ** | Screenâ†’Meshâ†’Global | ì¡°ê¸° ì¢…ë£Œë¡œ ë¹„ìš© ì ˆê° |
| **SDF í¬ì†Œ ì €ì¥** | Brick ê¸°ë°˜ | ë©”ëª¨ë¦¬ 80%+ ì ˆê° |
| **Surface Cache** | ê°€ìƒ í…ìŠ¤ì²˜ | ë™ì  í•´ìƒë„ |
| **Atlas íŒ¨í‚¹** | ë‹¨ì¼ í…ìŠ¤ì²˜ | Draw Call ìµœì†Œí™” |

---

## ğŸ”— References

- **ì†ŒìŠ¤ ì½”ë“œ:**
  - `Engine/Source/Runtime/Engine/Public/DistanceFieldAtlas.h`
  - `Engine/Source/Runtime/Renderer/Private/Lumen/`
  - `Engine/Shaders/Private/Lumen/`
- **ê³µì‹ ë¬¸ì„œ:**
  - [Lumen Global Illumination](https://docs.unrealengine.com/5.0/en-US/lumen-global-illumination-and-reflections-in-unreal-engine/)
  - [Distance Field How-To](https://docs.unrealengine.com/5.0/en-US/mesh-distance-fields-in-unreal-engine/)
- **ë°œí‘œ ìë£Œ:**
  - SIGGRAPH 2022: "Lumen: Real-time Global Illumination in Unreal Engine 5"

---

> ğŸ”„ Updated: 2025-12-02 â€” ì—”ì§„ ì†ŒìŠ¤ ì½”ë“œ ë¶„ì„ ê¸°ë°˜ ì „ë©´ ì¬ì •ë¦¬ + ê°œë³„ ì‹œìŠ¤í…œ ì‹¬ì¸µ ë¶„ì„ ë¬¸ì„œ (MeshDistanceField, GlobalDistanceField, SurfaceCache, ScreenProbe, RadianceCache, LumenTracing, LumenReflections) ì¶”ê°€
