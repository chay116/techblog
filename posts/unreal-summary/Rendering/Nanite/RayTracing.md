---
title: "Nanite Ray Tracing ì§€ì› ì‹œìŠ¤í…œ"
date: "2025-11-23"
status: "stable"
project: "UnrealEngine"
lang: "ko"
category: "unreal-summary"
track: "Rendering"
tags: ["unreal", "Rendering", "Nanite"]
---
# Nanite Ray Tracing ì§€ì› ì‹œìŠ¤í…œ

## ğŸ§­ ê°œìš” (Overview)

Naniteì˜ **Ray Tracing ì§€ì›**ì€ Nanite ì§€ì˜¤ë©”íŠ¸ë¦¬ë¥¼ í•˜ë“œì›¨ì–´ Ray Tracing (DXR/Vulkan RT)ê³¼ í†µí•©í•˜ê¸° ìœ„í•œ ì‹œìŠ¤í…œì…ë‹ˆë‹¤. Naniteì˜ GPU-Driven ì•„í‚¤í…ì²˜ì™€ ì „í†µì ì¸ RT BVH êµ¬ì¡° ê°„ì˜ ë¶ˆì¼ì¹˜ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ **StreamOut** ì‹œìŠ¤í…œì„ í†µí•´ RT ì „ìš© ì§€ì˜¤ë©”íŠ¸ë¦¬ë¥¼ ë™ì ìœ¼ë¡œ ìƒì„±í•©ë‹ˆë‹¤.

**í•µì‹¬ ê°œë…:**
- **StreamOut**: Nanite í´ëŸ¬ìŠ¤í„° â†’ ì „í†µì  Vertex/Index Buffer ë³€í™˜
- **BLAS (Bottom Level Acceleration Structure)**: RT ì „ìš© ê°€ì† êµ¬ì¡° ë¹Œë“œ
- **ë™ì  LOD ê´€ë¦¬**: RT ì „ìš© CutError ë° LODBias ì‹œìŠ¤í…œ
- **ì ì§„ì  ì—…ë°ì´íŠ¸**: í”„ë ˆì„ë‹¹ ì œí•œëœ ìˆ˜ì˜ BLASë§Œ ë¹Œë“œ (throttling)

**ğŸ“‚ ì£¼ìš” ì†ŒìŠ¤ ìœ„ì¹˜:**
- `Engine/Source/Runtime/Renderer/Private/Nanite/NaniteRayTracing.h` (181 ë¼ì¸)
- `Engine/Source/Runtime/Renderer/Private/Nanite/NaniteRayTracing.cpp` (1,359 ë¼ì¸)
- `Engine/Source/Runtime/Renderer/Private/Nanite/NaniteStreamOut.h` (96 ë¼ì¸)
- `Engine/Source/Runtime/Renderer/Private/Nanite/NaniteStreamOut.cpp` (515 ë¼ì¸)
- `Engine/Shaders/Private/Nanite/NaniteRayTracing.usf` (351 ë¼ì¸)
- `Engine/Shaders/Private/Nanite/NaniteStreamOut.usf` (ì…°ì´ë” êµ¬í˜„)

---

## ğŸ¯ ì„¤ê³„ ì² í•™: ì™œ ë³„ë„ì˜ RT ì§€ì˜¤ë©”íŠ¸ë¦¬ì¸ê°€?

### ë¬¸ì œ: Naniteì™€ RT BVHì˜ ë¶ˆì¼ì¹˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Nanite GPU-Driven ì•„í‚¤í…ì²˜                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  âœ… ê°•ì :                                                                â”‚
â”‚  - GPUì—ì„œ ë™ì  LOD ì„ íƒ                                                â”‚
â”‚  - Cluster ë‹¨ìœ„ ì»¬ë§                                                    â”‚
â”‚  - ì†Œí”„íŠ¸ì›¨ì–´ ë˜ìŠ¤í„°í™”                                                  â”‚
â”‚  - Visibility Buffer ê¸°ë°˜ Shading                                       â”‚
â”‚                                                                         â”‚
â”‚  âŒ RTì™€ì˜ ë¶ˆì¼ì¹˜:                                                       â”‚
â”‚  - RTëŠ” CPUê°€ BLAS ë¹Œë“œ                                                 â”‚
â”‚  - ì‚¼ê°í˜• ê¸°ë°˜ ASë§Œ ì§€ì›                                                â”‚
â”‚  - GPU-Driven LODë¥¼ í‘œí˜„ ë¶ˆê°€                                           â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
                   Nanite RT ì†”ë£¨ì…˜:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                         â”‚
â”‚  [1] StreamOut: Nanite â†’ ì „í†µì  Vertex/Index Buffer                     â”‚
â”‚  [2] BLAS ë¹Œë“œ: CPUì—ì„œ RT ì „ìš© AS ìƒì„±                                  â”‚
â”‚  [3] ì ì§„ì  ì—…ë°ì´íŠ¸: í”„ë ˆì„ë‹¹ ì œí•œëœ ìˆ˜ë§Œ ë¹Œë“œ                           â”‚
â”‚  [4] LOD ê´€ë¦¬: RT ì „ìš© CutError ì‹œìŠ¤í…œ                                  â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì„¤ê³„ ê²°ì •

| ê²°ì • ì‚¬í•­ | ì´ìœ  | íŠ¸ë ˆì´ë“œì˜¤í”„ |
|----------|------|-------------|
| **ë³„ë„ RT ì§€ì˜¤ë©”íŠ¸ë¦¬** | RTëŠ” ì‚¼ê°í˜• ê¸°ë°˜ ASë§Œ ì§€ì› | ë©”ëª¨ë¦¬ 2ë°° (Nanite + RT) |
| **StreamOut ì‹œìŠ¤í…œ** | Nanite í´ëŸ¬ìŠ¤í„°ë¥¼ ì‚¼ê°í˜•ìœ¼ë¡œ ë³€í™˜ | GPU â†’ CPU ë°ì´í„° ì „ì†¡ ë¹„ìš© |
| **ì ì§„ì  BLAS ë¹Œë“œ** | í”„ë ˆì„ë ˆì´íŠ¸ ìœ ì§€ | ì™„ì „ ì—…ë°ì´íŠ¸ê¹Œì§€ ì—¬ëŸ¬ í”„ë ˆì„ |
| **RT ì „ìš© LOD** | ì¼ë°˜ ë Œë”ë§ê³¼ ë³„ë„ í’ˆì§ˆ ì œì–´ | ë¶ˆì¼ì¹˜ ê°€ëŠ¥ (ê·¸ë¦¼ì ë“±) |

---

## ğŸ§± ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ (Architecture)

### ì „ì²´ íŒŒì´í”„ë¼ì¸

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Phase 1: ìŠ¤íŠ¸ë¦¬ë° ìš”ì²­ ìƒì„± (UpdateStreaming)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  For each visible Nanite primitive:                                    â”‚
â”‚    1. Hierarchy ìˆœíšŒ (GPU Compute Shader)                               â”‚
â”‚    2. CutError ê³„ì‚°                                                     â”‚
â”‚    3. LOD ì„ íƒ â†’ StreamingRequests ë²„í¼                                 â”‚
â”‚                                                                         â”‚
â”‚  ê²°ê³¼: TMap<ResourceID, NumResidentClusters>                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Phase 2: StreamOut ì‹¤í–‰ (ProcessUpdateRequests)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  For each update request:                                              â”‚
â”‚    1. Hierarchy ìˆœíšŒ (ì¬ìˆ˜í–‰)                                           â”‚
â”‚    2. í´ëŸ¬ìŠ¤í„° ë°ì´í„° ì¶”ì¶œ                                               â”‚
â”‚       - Position, Normal, Tangent, UVs ë””ì½”ë”©                          â”‚
â”‚       - Triangle Indices ìƒì„±                                           â”‚
â”‚    3. VertexBuffer & IndexBufferì— ê¸°ë¡                                 â”‚
â”‚    4. AuxiliaryDataBuffer ì—…ë°ì´íŠ¸ (ì˜¤í”„ì…‹ ì •ë³´)                         â”‚
â”‚                                                                         â”‚
â”‚  ê²°ê³¼: GPU ë²„í¼ â†’ CPU Readback                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Phase 3: BLAS ë¹Œë“œ (ProcessBuildRequests)                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  For each scheduled build (throttled):                                 â”‚
â”‚    1. FRayTracingGeometry ìƒì„±/ì—…ë°ì´íŠ¸                                 â”‚
â”‚    2. RHI BLAS ë¹Œë“œ                                                     â”‚
â”‚       - Scratch Buffer í• ë‹¹                                             â”‚
â”‚       - RHICmdList.BuildAccelerationStructure()                         â”‚
â”‚    3. í”„ë¦¬ë¯¸í‹°ë¸Œì— RayTracingGeometry í• ë‹¹                               â”‚
â”‚                                                                         â”‚
â”‚  Throttling:                                                           â”‚
â”‚  - r.RayTracing.Nanite.MaxBuiltPrimitivesPerFrame (ê¸°ë³¸: 8M tris)      â”‚
â”‚  - ì´ˆê³¼ ì‹œ PendingBuilds íì— ëŒ€ê¸°                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—ï¸ í•µì‹¬ êµ¬ì¡° (Core Structures)

### 1. FRayTracingManager

**ğŸ“‚ ìœ„ì¹˜:** `NaniteRayTracing.h:24-174`

```cpp
class FRayTracingManager : public FRenderResource
{
public:
    // === ë¼ì´í”„ì‚¬ì´í´ ===
    void Initialize();
    void Shutdown();
    void InitRHI(FRHICommandListBase& RHICmdList) override;
    void ReleaseRHI() override;

    // === í”„ë¦¬ë¯¸í‹°ë¸Œ ê´€ë¦¬ ===
    void Add(FPrimitiveSceneInfo* SceneInfo);
    void Remove(FPrimitiveSceneInfo* SceneInfo);
    void AddVisiblePrimitive(const FPrimitiveSceneInfo* SceneInfo);

    // === ì—…ë°ì´íŠ¸ íŒŒì´í”„ë¼ì¸ ===
    void RequestUpdates(const TMap<uint32, uint32>& InUpdateRequests);
    void UpdateStreaming(FRDGBuilder& GraphBuilder, ...);
    void ProcessUpdateRequests(FRDGBuilder& GraphBuilder, ...);
    bool ProcessBuildRequests(FRDGBuilder& GraphBuilder);

    // === ì•¡ì„¸ì„œ ===
    FRHIRayTracingGeometry* GetRayTracingGeometry(FPrimitiveSceneInfo* SceneInfo) const;
    FRDGBufferSRV* GetAuxiliaryDataSRV(FRDGBuilder& GraphBuilder) const;

private:
    struct FInternalData;  // RT ì§€ì˜¤ë©”íŠ¸ë¦¬ ì •ë³´

    TSparseArray<FInternalData*> Geometries;
    TMap<uint32, uint32> ResourceToRayTracingIdMap;

    TSet<uint32> UpdateRequests;
    TSet<uint32> VisibleGeometries;

    // ë²„í¼ë“¤
    TRefCountPtr<FRDGPooledBuffer> AuxiliaryDataBuffer;
    TRefCountPtr<FRDGPooledBuffer> VertexBuffer;
    TRefCountPtr<FRDGPooledBuffer> IndexBuffer;
};
```

### 2. FInternalData (RT ì§€ì˜¤ë©”íŠ¸ë¦¬ ë°ì´í„°)

**ğŸ“‚ ìœ„ì¹˜:** `NaniteRayTracing.h:78-109`

```cpp
struct FInternalData
{
    // === Nanite ë¦¬ì†ŒìŠ¤ ì •ë³´ ===
    uint32 ResourceId;
    uint32 HierarchyOffset;
    uint32 NumClusters;
    uint32 NumNodes;
    uint32 NumVertices;
    uint32 NumTriangles;
    uint32 NumMaterials;
    uint32 NumSegments;

    // === ìŠ¤íŠ¸ë¦¬ë° ì •ë³´ ===
    uint32 NumResidentClusters;          // í˜„ì¬ ë©”ëª¨ë¦¬ ìƒì£¼ í´ëŸ¬ìŠ¤í„° ìˆ˜
    uint32 NumResidentClustersUpdate;    // ì—…ë°ì´íŠ¸ ìš”ì²­ëœ ìˆ˜

    // === RT ì§€ì˜¤ë©”íŠ¸ë¦¬ ===
    FRayTracingGeometryRHIRef RayTracingGeometryRHI;

    // === ë²„í¼ ì˜¤í”„ì…‹ ===
    uint32 AuxiliaryDataOffset = INDEX_NONE;
    uint32 AuxiliaryDataSize = 0;

    uint32 StagingAuxiliaryDataOffset = INDEX_NONE;
    int32 BaseMeshDataOffset = -1;

    bool bUpdating = false;
    bool bAssembly;

    TSet<FPrimitiveSceneInfo*> Primitives;  // ì´ ì§€ì˜¤ë©”íŠ¸ë¦¬ë¥¼ ì‚¬ìš©í•˜ëŠ” í”„ë¦¬ë¯¸í‹°ë¸Œë“¤
};
```

---

## ğŸ”„ ì—…ë°ì´íŠ¸ íŒŒì´í”„ë¼ì¸ ìƒì„¸ (Update Pipeline Details)

### Phase 1: UpdateStreaming

**ğŸ“‚ ìœ„ì¹˜:** `NaniteRayTracing.cpp:800-900` (UpdateStreaming)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   UpdateStreaming - LOD ì„ íƒ ë° ìš”ì²­ ìƒì„±                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  [Input]                                                                â”‚
â”‚  - Views: í˜„ì¬ í”„ë ˆì„ì˜ ì¹´ë©”ë¼ ë·°ë“¤                                      â”‚
â”‚  - VisiblePrimitives: í™”ë©´ì— ë³´ì´ëŠ” Nanite í”„ë¦¬ë¯¸í‹°ë¸Œ                    â”‚
â”‚                                                                         â”‚
â”‚  [Step 1: í ì´ˆê¸°í™”]                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚  â”‚ FRayTracingStreamingInitQueueCS       â”‚                            â”‚
â”‚  â”‚ - LoadBalancerë¡œ ì¸ìŠ¤í„´ìŠ¤ ë¶„ë°°         â”‚                            â”‚
â”‚  â”‚ - QueueState ì´ˆê¸°í™”                    â”‚                            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                    â†“                                                   â”‚
â”‚  [Step 2: Hierarchy ìˆœíšŒ]                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚  â”‚ FNaniteRayTracingStreamingTraversalCS â”‚                            â”‚
â”‚  â”‚ - BVH ë…¸ë“œ ìˆœíšŒ                        â”‚                            â”‚
â”‚  â”‚ - CutError ê³„ì‚°                        â”‚                            â”‚
â”‚  â”‚   Error = ScreenSize * LODError        â”‚                            â”‚
â”‚  â”‚   if (Error < CutErrorThreshold)       â”‚                            â”‚
â”‚  â”‚       â†’ ì´ í´ëŸ¬ìŠ¤í„° ì„ íƒ                â”‚                            â”‚
â”‚  â”‚ - StreamingRequests ë²„í¼ì— ê¸°ë¡        â”‚                            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                    â†“                                                   â”‚
â”‚  [Step 3: CPUë¡œ ê²°ê³¼ ì „ë‹¬]                                               â”‚
â”‚  - GPU â†’ CPU Readback (ë¹„ë™ê¸°)                                          â”‚
â”‚  - RequestUpdates(ResourceID â†’ NumResidentClusters)                    â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**LOD bias ê³„ì‚°:**

```hlsl
// NaniteRayTracing.usf
float LODBias = r.RayTracing.Nanite.Streaming.LODBias;

if (bOffscreen)
{
    LODBias = r.RayTracing.Nanite.Streaming.Offscreen.LODBias;
}

float ScreenSize = ComputeScreenSize(ClusterBounds, View);
float Error = ScreenSize * ClusterLODError * exp2(LODBias);

if (Error < CutErrorThreshold)
{
    // ì´ í´ëŸ¬ìŠ¤í„° ì„ íƒ â†’ StreamOut
}
else
{
    // ë” ë†’ì€ LOD(ë‹¨ìˆœí™”ëœ) í´ëŸ¬ìŠ¤í„° ì„ íƒ
}
```

---

### Phase 2: ProcessUpdateRequests (StreamOut)

**ğŸ“‚ ìœ„ì¹˜:** `NaniteRayTracing.cpp:950-1100`

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ProcessUpdateRequests - StreamOut ì‹¤í–‰                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  [Input]                                                                â”‚
â”‚  - UpdateRequests: RequestUpdatesì—ì„œ ìƒì„±ëœ ì—…ë°ì´íŠ¸ ëª©ë¡               â”‚
â”‚                                                                         â”‚
â”‚  [Step 1: ë²„í¼ í¬ê¸° ê³„ì‚°]                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚  â”‚ ê° ìš”ì²­ì— ëŒ€í•´:                         â”‚                            â”‚
â”‚  â”‚   NumVertices = NumClusters Ã— 256      â”‚                            â”‚
â”‚  â”‚   NumTriangles = NumClusters Ã— 128     â”‚                            â”‚
â”‚  â”‚                                        â”‚                            â”‚
â”‚  â”‚ ì´í•© ê³„ì‚° í›„ ë²„í¼ í• ë‹¹:                 â”‚                            â”‚
â”‚  â”‚   StagingVertexBuffer                  â”‚                            â”‚
â”‚  â”‚   StagingIndexBuffer                   â”‚                            â”‚
â”‚  â”‚   StagingAuxiliaryDataBuffer           â”‚                            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                    â†“                                                   â”‚
â”‚  [Step 2: Hierarchy ìˆœíšŒ (Count Pass)]                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚  â”‚ FNaniteStreamOutTraversalCS            â”‚                            â”‚
â”‚  â”‚ (NANITE_STREAM_OUT_COUNT_VERTICES_AND_TRIANGLES=1)                  â”‚
â”‚  â”‚                                        â”‚                            â”‚
â”‚  â”‚ - Hierarchy ìˆœíšŒ                       â”‚                            â”‚
â”‚  â”‚ - ê° í´ëŸ¬ìŠ¤í„°ë‹¹ ì •í™•í•œ ë²„í…ìŠ¤/ì‚¼ê°í˜• ìˆ˜ â”‚                            â”‚
â”‚  â”‚ - MeshDataBufferì— ì˜¤í”„ì…‹ ê¸°ë¡         â”‚                            â”‚
â”‚  â”‚ - ì„ íƒì : í´ëŸ¬ìŠ¤í„° ìºì‹± (CacheClusters) â”‚                            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                    â†“                                                   â”‚
â”‚  [Step 3: ë²„í¼ í• ë‹¹]                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚  â”‚ FAllocateRangesCS                      â”‚                            â”‚
â”‚  â”‚ - Count Pass ê²°ê³¼ ì½ê¸°                  â”‚                            â”‚
â”‚  â”‚ - VertexBuffer ë²”ìœ„ í• ë‹¹                â”‚                            â”‚
â”‚  â”‚ - IndexBuffer ë²”ìœ„ í• ë‹¹                 â”‚                            â”‚
â”‚  â”‚ - ì‹¤íŒ¨ ì‹œ throttle (ë‹¤ìŒ í”„ë ˆì„ ì¬ì‹œë„) â”‚                            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                    â†“                                                   â”‚
â”‚  [Step 4: StreamOut Pass]                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚  â”‚ FNaniteStreamOutCS                     â”‚                            â”‚
â”‚  â”‚                                        â”‚                            â”‚
â”‚  â”‚ For each cluster:                      â”‚                            â”‚
â”‚  â”‚   1. ì••ì¶• í•´ì œ:                         â”‚                            â”‚
â”‚  â”‚      - Position (ì–‘ìí™” ë³µì›)           â”‚                            â”‚
â”‚  â”‚      - Normal (Octahedral â†’ 3D)        â”‚                            â”‚
â”‚  â”‚      - Tangent                         â”‚                            â”‚
â”‚  â”‚      - UVs (ì••ì¶• í•´ì œ)                  â”‚                            â”‚
â”‚  â”‚      - Color                           â”‚                            â”‚
â”‚  â”‚   2. VertexBufferì— ì“°ê¸°                â”‚                            â”‚
â”‚  â”‚   3. IndexBufferì— ì“°ê¸°                 â”‚                            â”‚
â”‚  â”‚   4. Segment ì •ë³´ ê¸°ë¡                  â”‚                            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                    â†“                                                   â”‚
â”‚  [Step 5: CPU Readback]                                                â”‚
â”‚  - MeshDataBuffer â†’ CPU (ë¹„ë™ê¸°, 4í”„ë ˆì„ ì§€ì—°)                           â”‚
â”‚  - ë‹¤ìŒ ProcessBuildRequestsì—ì„œ ì‚¬ìš©                                   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Throttling ë©”ì»¤ë‹ˆì¦˜:**

```cpp
// NaniteRayTracing.cpp
if (TotalNumVertices > GNaniteRayTracingMaxNumVertices ||
    TotalNumIndices > GNaniteRayTracingMaxNumIndices)
{
    // ì´ë²ˆ í”„ë ˆì„ ìƒëµ, ë‹¤ìŒ í”„ë ˆì„ ì¬ì‹œë„
    INC_DWORD_STAT(STAT_NaniteRayTracingFailedStreamOutRequests);
    continue;
}
```

---

### Phase 3: ProcessBuildRequests (BLAS ë¹Œë“œ)

**ğŸ“‚ ìœ„ì¹˜:** `NaniteRayTracing.cpp:1150-1300`

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               ProcessBuildRequests - BLAS ë¹Œë“œ ë° ì—…ë°ì´íŠ¸                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  [Input]                                                                â”‚
â”‚  - ReadbackBuffers: ì´ì „ í”„ë ˆì„ì—ì„œ StreamOutí•œ ë°ì´í„°                   â”‚
â”‚                                                                         â”‚
â”‚  [Step 1: Readback ë°ì´í„° í™•ì¸]                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚  â”‚ For each readback buffer:              â”‚                            â”‚
â”‚  â”‚   if (IsReady())                       â”‚                            â”‚
â”‚  â”‚   {                                    â”‚                            â”‚
â”‚  â”‚       FMeshData* Data = Lock();        â”‚                            â”‚
â”‚  â”‚       ScheduledBuilds.Add(GeometryId); â”‚                            â”‚
â”‚  â”‚   }                                    â”‚                            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                    â†“                                                   â”‚
â”‚  [Step 2: Throttling]                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚  â”‚ ëˆ„ì  ì‚¼ê°í˜• ìˆ˜ ê³„ì‚°:                    â”‚                            â”‚
â”‚  â”‚   TotalPrimitives += NumTriangles;     â”‚                            â”‚
â”‚  â”‚                                        â”‚                            â”‚
â”‚  â”‚ if (TotalPrimitives > MaxBuiltPrimitivesPerFrame)                   â”‚
â”‚  â”‚ {                                      â”‚                            â”‚
â”‚  â”‚     // PendingBuilds íë¡œ ì´ë™          â”‚                            â”‚
â”‚  â”‚     // ë‹¤ìŒ í”„ë ˆì„ì— ë¹Œë“œ               â”‚                            â”‚
â”‚  â”‚ }                                      â”‚                            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                    â†“                                                   â”‚
â”‚  [Step 3: FRayTracingGeometry ì—…ë°ì´íŠ¸]                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚  â”‚ FRayTracingGeometryInitializer Init;   â”‚                            â”‚
â”‚  â”‚ Init.IndexBuffer = IndexBuffer;        â”‚                            â”‚
â”‚  â”‚ Init.VertexBuffer = VertexBuffer;      â”‚                            â”‚
â”‚  â”‚ Init.BaseVertexIndex = VertexOffset;   â”‚                            â”‚
â”‚  â”‚ Init.BaseIndexIndex = IndexOffset;     â”‚                            â”‚
â”‚  â”‚                                        â”‚                            â”‚
â”‚  â”‚ For each segment:                      â”‚                            â”‚
â”‚  â”‚ {                                      â”‚                            â”‚
â”‚  â”‚     FRayTracingGeometrySegment Seg;    â”‚                            â”‚
â”‚  â”‚     Seg.VertexBuffer = ...;            â”‚                            â”‚
â”‚  â”‚     Seg.FirstPrimitive = ...;          â”‚                            â”‚
â”‚  â”‚     Seg.NumPrimitives = ...;           â”‚                            â”‚
â”‚  â”‚     Init.Segments.Add(Seg);            â”‚                            â”‚
â”‚  â”‚ }                                      â”‚                            â”‚
â”‚  â”‚                                        â”‚                            â”‚
â”‚  â”‚ if (bFirstTime)                        â”‚                            â”‚
â”‚  â”‚     RayTracingGeometry = RHICreateRayTracingGeometry(Init);         â”‚
â”‚  â”‚ else                                   â”‚                            â”‚
â”‚  â”‚     RHIUpdateRayTracingGeometry(RayTracingGeometry);                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                    â†“                                                   â”‚
â”‚  [Step 4: BLAS ë¹Œë“œ]                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚  â”‚ FRayTracingGeometryBuildParams Params; â”‚                            â”‚
â”‚  â”‚ Params.Geometry = RayTracingGeometry;  â”‚                            â”‚
â”‚  â”‚ Params.BuildMode = FastTrace;          â”‚                            â”‚
â”‚  â”‚                                        â”‚                            â”‚
â”‚  â”‚ // Scratch Buffer í• ë‹¹ (64MB ë‹¨ìœ„)      â”‚                            â”‚
â”‚  â”‚ uint64 ScratchSize = RoundUp(RequiredSize, 64MB);                  â”‚
â”‚  â”‚ FRDGBuffer* Scratch = GraphBuilder.CreateBuffer(...);               â”‚
â”‚  â”‚                                        â”‚                            â”‚
â”‚  â”‚ RHICmdList.BuildAccelerationStructure(Params);                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                    â†“                                                   â”‚
â”‚  [Step 5: í”„ë¦¬ë¯¸í‹°ë¸Œì— í• ë‹¹]                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚  â”‚ For each primitive using this geometry:â”‚                            â”‚
â”‚  â”‚ {                                      â”‚                            â”‚
â”‚  â”‚     SceneInfo->RayTracingGeometries[0] = RayTracingGeometry;       â”‚
â”‚  â”‚ }                                      â”‚                            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âš™ï¸ ì£¼ìš” ì„¤ì • ë° ì½˜ì†” ë³€ìˆ˜ (Configuration)

### ì½˜ì†” ë³€ìˆ˜

| CVars | ê¸°ë³¸ê°’ | ì„¤ëª… |
|-------|--------|------|
| `r.RayTracing.Nanite.Update` | 1 | Nanite RT ì—…ë°ì´íŠ¸ í™œì„±í™” |
| `r.RayTracing.Nanite.CutError` | 0.0 | ê¸€ë¡œë²Œ CutError (0 = ìµœëŒ€ ë””í…Œì¼) |
| `r.RayTracing.Nanite.Streaming` | 0 | RT ê¸°ë°˜ ìŠ¤íŠ¸ë¦¬ë° êµ¬ë™ |
| `r.RayTracing.Nanite.Streaming.LODBias` | 0.0 | RT LOD ë°”ì´ì–´ìŠ¤ (0=ìµœëŒ€ ë””í…Œì¼) |
| `r.RayTracing.Nanite.Streaming.Offscreen.LODBias` | 1.0 | ì˜¤í”„ìŠ¤í¬ë¦° LOD ë°”ì´ì–´ìŠ¤ |
| `r.RayTracing.Nanite.StreamOut.MaxNumVertices` | 16M | í”„ë ˆì„ë‹¹ ìµœëŒ€ ë²„í…ìŠ¤ |
| `r.RayTracing.Nanite.StreamOut.MaxNumIndices` | 64M | í”„ë ˆì„ë‹¹ ìµœëŒ€ ì¸ë±ìŠ¤ |
| `r.RayTracing.Nanite.MaxBuiltPrimitivesPerFrame` | 8M | í”„ë ˆì„ë‹¹ ìµœëŒ€ BLAS ì‚¼ê°í˜• ìˆ˜ |
| `r.RayTracing.Nanite.MaxStagingBufferSizeMB` | 1024 | ìŠ¤í…Œì´ì§• ë²„í¼ ìµœëŒ€ í¬ê¸° (MB) |

### ì„¤ì • ì˜ˆì‹œ

**ê³ í’ˆì§ˆ RT (ì •ì  ì”¬):**
```cpp
r.RayTracing.Nanite.CutError 0.0
r.RayTracing.Nanite.Streaming.LODBias 0.0
r.RayTracing.Nanite.MaxBuiltPrimitivesPerFrame 64000000  // 64M
```

**ê· í˜• (ë™ì  ì”¬):**
```cpp
r.RayTracing.Nanite.CutError 0.0
r.RayTracing.Nanite.Streaming.LODBias 0.5
r.RayTracing.Nanite.MaxBuiltPrimitivesPerFrame 8000000   // 8M (ê¸°ë³¸ê°’)
```

**ì €ì‚¬ì–‘ (ì„±ëŠ¥ ìš°ì„ ):**
```cpp
r.RayTracing.Nanite.CutError 1.0
r.RayTracing.Nanite.Streaming.LODBias 1.0
r.RayTracing.Nanite.Streaming.Offscreen.LODBias 2.0
r.RayTracing.Nanite.MaxBuiltPrimitivesPerFrame 2000000   // 2M
```

---

## ğŸ’¡ ì„±ëŠ¥ ìµœì í™” (Performance Optimization)

### âœ… í•´ì•¼ í•  ê²ƒ

**1. LOD Bias ì¡°ì •ìœ¼ë¡œ í’ˆì§ˆ/ì„±ëŠ¥ ê· í˜•:**

```cpp
// ì¹´ë©”ë¼ ê·¼ì²˜: ë†’ì€ ë””í…Œì¼
r.RayTracing.Nanite.Streaming.LODBias 0.0

// ë¨¼ ê±°ë¦¬/ì˜¤í”„ìŠ¤í¬ë¦°: ë‚®ì€ ë””í…Œì¼
r.RayTracing.Nanite.Streaming.Offscreen.LODBias 1.5
```

**2. Throttling íŒŒë¼ë¯¸í„° ì¡°ì •:**

```cpp
// í”„ë ˆì„ ë“œë ë°œìƒ ì‹œ
r.RayTracing.Nanite.MaxBuiltPrimitivesPerFrame 4000000  // ì ˆë°˜ìœ¼ë¡œ ê°ì†Œ

// ì—¬ìœ  ìˆëŠ” ê²½ìš°
r.RayTracing.Nanite.MaxBuiltPrimitivesPerFrame 16000000  // 2ë°° ì¦ê°€
```

**3. ì •ì  ì§€ì˜¤ë©”íŠ¸ë¦¬ ìš°ì„ :**

Nanite RTëŠ” **ë™ì  ì—…ë°ì´íŠ¸**ê°€ ë¹„ìš©ì´ ë†’ìŠµë‹ˆë‹¤. ê°€ëŠ¥í•˜ë©´:
- ì •ì  ì§€ì˜¤ë©”íŠ¸ë¦¬: Nanite RT ì‚¬ìš©
- ë™ì  ì§€ì˜¤ë©”íŠ¸ë¦¬: ì „í†µì  ë©”ì‹œ + RT ì‚¬ìš©

---

### âŒ í”¼í•´ì•¼ í•  ê²ƒ

**1. ë§¤ í”„ë ˆì„ ê°•ì œ ì—…ë°ì´íŠ¸:**

```cpp
// âŒ ë‚˜ìœ ì˜ˆ: ë§¤ í”„ë ˆì„ ëª¨ë“  Nanite ì§€ì˜¤ë©”íŠ¸ë¦¬ ì¬ë¹Œë“œ
r.RayTracing.Nanite.ForceUpdateVisible 1

// CPU/GPU ë³‘ëª© ë°œìƒ, í”„ë ˆì„ë ˆì´íŠ¸ ê¸‰ë½
```

**2. ë„ˆë¬´ ì‘ì€ CutError:**

```cpp
// âŒ ë‚˜ìœ ì˜ˆ: ê·¹ë„ë¡œ ë†’ì€ ë””í…Œì¼
r.RayTracing.Nanite.CutError 0.0
r.RayTracing.Nanite.Streaming.LODBias 0.0

// ìˆ˜ë°±ë§Œ ê°œì˜ ì‚¼ê°í˜• â†’ BLAS ë¹Œë“œ ì‹œê°„ í­ë°œ
```

**3. ë¬´ì œí•œ ë²„í¼ í¬ê¸°:**

```cpp
// âŒ ë‚˜ìœ ì˜ˆ: ë©”ëª¨ë¦¬ ì œí•œ ì œê±°
r.RayTracing.Nanite.MaxStagingBufferSizeMB 4096

// OOM (Out of Memory) ìœ„í—˜
```

---

## ğŸ“Š ì„±ëŠ¥ íŠ¹ì„± (Performance Characteristics)

### ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰

```
ë‹¨ì¼ Nanite ë©”ì‹œ (1M ì‚¼ê°í˜•):

Nanite ë°ì´í„° (ì••ì¶•):
- í´ëŸ¬ìŠ¤í„° ë©”íƒ€ë°ì´í„°: ~40 KB
- ì§€ì˜¤ë©”íŠ¸ë¦¬ ë°ì´í„°: ~5.6 MB (ì••ì¶•, 5.6 bytes/tri)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ì´í•©: ~5.64 MB

RT ì§€ì˜¤ë©”íŠ¸ë¦¬ (ë¯¸ì••ì¶•):
- VertexBuffer (256 verts Ã— 8K clusters): ~80 MB
- IndexBuffer (128 tris Ã— 8K clusters): ~12 MB
- BLAS ë©”íƒ€ë°ì´í„°: ~10 MB
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ì´í•©: ~102 MB

ë©”ëª¨ë¦¬ ë¹„ìœ¨: Nanite (5.64 MB) vs RT (102 MB) = 1 : 18
```

### ë¹Œë“œ ì‹œê°„ (BLAS)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     BLAS ë¹Œë“œ ì‹œê°„ ì¸¡ì • (RTX 3090)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  [10K ì‚¼ê°í˜•]                                                            â”‚
â”‚  - Build: ~0.1ms                                                        â”‚
â”‚  - Update: ~0.05ms                                                      â”‚
â”‚                                                                         â”‚
â”‚  [100K ì‚¼ê°í˜•]                                                           â”‚
â”‚  - Build: ~1ms                                                          â”‚
â”‚  - Update: ~0.5ms                                                       â”‚
â”‚                                                                         â”‚
â”‚  [1M ì‚¼ê°í˜•]                                                             â”‚
â”‚  - Build: ~10ms                                                         â”‚
â”‚  - Update: ~5ms                                                         â”‚
â”‚                                                                         â”‚
â”‚  [10M ì‚¼ê°í˜• (í”„ë ˆì„ë‹¹ ìµœëŒ€)]                                             â”‚
â”‚  - Build: ~100ms  âš ï¸                                                    â”‚
â”‚  - Update: ~50ms  âš ï¸                                                    â”‚
â”‚                                                                         â”‚
â”‚  â†’ Throttling í•„ìˆ˜ (8M ê¸°ë³¸ê°’)                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### StreamOut ì˜¤ë²„í—¤ë“œ

```
ë‹¨ì¼ ì—…ë°ì´íŠ¸ ìš”ì²­ (10K ì‚¼ê°í˜•):

GPU ì‹œê°„:
- Hierarchy ìˆœíšŒ: ~0.2ms
- Count Pass: ~0.1ms
- StreamOut Pass: ~0.5ms
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
GPU ì´í•©: ~0.8ms

CPU ì‹œê°„:
- Readback ëŒ€ê¸°: 4 í”„ë ˆì„ (ë¹„ë™ê¸°)
- BLAS ë¹Œë“œ ì¤€ë¹„: ~0.1ms
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
CPU ì´í•©: ~0.1ms (4í”„ë ˆì„ ì§€ì—°)

ì´ ë ˆì´í„´ì‹œ: ìš”ì²­ â†’ BLAS ì™„ë£Œ = ì•½ 4-5 í”„ë ˆì„
```

---

## âš ï¸ í•œê³„ì  ë° íŠ¸ë ˆì´ë“œì˜¤í”„ (Limitations & Trade-offs)

### 1. ë©”ëª¨ë¦¬ ì˜¤ë²„í—¤ë“œ

**ë¬¸ì œ:**
- Nanite ë°ì´í„° + RT ì§€ì˜¤ë©”íŠ¸ë¦¬ = **ì•½ 18ë°° ë©”ëª¨ë¦¬**
- ëŒ€ê·œëª¨ ì”¬ì—ì„œ ë©”ëª¨ë¦¬ ì••ë°•

**ì™„í™”ì±…:**
- ì¤‘ìš”í•˜ì§€ ì•Šì€ ì§€ì˜¤ë©”íŠ¸ë¦¬: RT ë¹„í™œì„±í™”
- LOD Bias ì¦ê°€ë¡œ ì‚¼ê°í˜• ìˆ˜ ê°ì†Œ

---

### 2. ì—…ë°ì´íŠ¸ ë ˆì´í„´ì‹œ

**ë¬¸ì œ:**
- StreamOut â†’ Readback â†’ BLAS ë¹Œë“œ = **4-5 í”„ë ˆì„ ì§€ì—°**
- ë™ì  ì”¬ì—ì„œ RT ì§€ì˜¤ë©”íŠ¸ë¦¬ "ëŠ¦ê²Œ ë„ì°©"

**ì˜ˆì‹œ:**
```
Frame 1: ì˜¤ë¸Œì íŠ¸ ê°€ì‹œí™” â†’ UpdateStreaming
Frame 2: ProcessUpdateRequests (StreamOut)
Frame 3-5: Readback ëŒ€ê¸° (ë¹„ë™ê¸°)
Frame 6: ProcessBuildRequests (BLAS ë¹Œë“œ)
         â†’ ì´ì œ RTì—ì„œ ë³´ì„
```

---

### 3. LOD ë¶ˆì¼ì¹˜

**ë¬¸ì œ:**
- **ì¼ë°˜ ë Œë”ë§**: Nanite GPU-Driven LOD (í”½ì…€ ë‹¨ìœ„)
- **Ray Tracing**: CPU-Driven LOD (CutError ê¸°ë°˜)
- ë‘ LODê°€ ë‹¤ë¥¼ ìˆ˜ ìˆìŒ

**ì‹œê°ì  ì˜í–¥:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ì¹´ë©”ë¼ ë·°:                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚
â”‚  â”‚  Nanite ë Œë”ë§: ê·¹ë„ë¡œ ìƒì„¸       â”‚                                  â”‚
â”‚  â”‚  (GPUê°€ í”½ì…€ë‹¹ ìµœì  LOD ì„ íƒ)     â”‚                                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚
â”‚                                                                         â”‚
â”‚  Ray Traced ê·¸ë¦¼ì:                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚
â”‚  â”‚  RT ì§€ì˜¤ë©”íŠ¸ë¦¬: ëœ ìƒì„¸           â”‚                                  â”‚
â”‚  â”‚  (CutError + LODBias)            â”‚                                  â”‚
â”‚  â”‚  â†’ ê·¸ë¦¼ì ì—£ì§€ ë¶€ì •í™•             â”‚                                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ì™„í™”ì±…:**
```cpp
// LODBias ê°ì†Œ (ë” ë†’ì€ ë””í…Œì¼)
r.RayTracing.Nanite.Streaming.LODBias 0.0

// ë‹¨ì : ì„±ëŠ¥ ì €í•˜
```

---

### 4. ë°˜íˆ¬ëª… ë° Masked Material ì œí•œ

**ë¬¸ì œ:**
- Nanite RTëŠ” **Opaque ì§€ì˜¤ë©”íŠ¸ë¦¬ë§Œ** ì™„ë²½ ì§€ì›
- Masked Material: Alpha Test ì§€ì›í•˜ì§€ë§Œ ì„±ëŠ¥ ì €í•˜
- Translucent: ë¯¸ì§€ì›

**ëŒ€ì•ˆ:**
- Translucent ì˜¤ë¸Œì íŠ¸: ì „í†µì  ë©”ì‹œ + RT ì‚¬ìš©

---

## ğŸ”§ ë””ë²„ê¹… ë° í”„ë¡œíŒŒì¼ë§ (Debugging & Profiling)

### Stat ëª…ë ¹ì–´

```
stat NaniteRayTracing           // ì „ë°˜ì  í†µê³„

ì£¼ìš” ì§€í‘œ:
- In-flight Updates: í˜„ì¬ ì²˜ë¦¬ ì¤‘ì¸ ì—…ë°ì´íŠ¸ ìˆ˜
- Stream Out Requests: ì´ë²ˆ í”„ë ˆì„ ìš”ì²­ ìˆ˜
- Failed Stream Out Requests: Throttlingìœ¼ë¡œ ì‹¤íŒ¨í•œ ìˆ˜
- Scheduled Builds: BLAS ë¹Œë“œ ì˜ˆì •
- Pending Builds: Throttlingìœ¼ë¡œ ëŒ€ê¸° ì¤‘ì¸ ë¹Œë“œ
- Auxiliary Data Buffer: ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰
```

### GPU Profiler

```
GPU íƒ€ì´ë° ì´ë²¤íŠ¸:
- NaniteRayTracingUpdateStreaming: ìŠ¤íŠ¸ë¦¬ë° ìš”ì²­ ìƒì„±
- NaniteStreamOutData: StreamOut ì‹¤í–‰
- RebuildNaniteBLAS: BLAS ë¹Œë“œ
```

### ë””ë²„ê¹… íŒ

**âœ… ì—…ë°ì´íŠ¸ í™•ì¸:**
```cpp
// ì—…ë°ì´íŠ¸ ì¤‘ì¸ ì§€ì˜¤ë©”íŠ¸ë¦¬ í™•ì¸
Nanite::GRayTracingManager.GetInternalData(GeometryId)->bUpdating
```

**âœ… Throttling ë°œìƒ í™•ì¸:**
```cpp
// stat NaniteRayTracing
// Failed Stream Out Requests > 0 â†’ Throttling ë°œìƒ

// í•´ê²°:
r.RayTracing.Nanite.StreamOut.MaxNumVertices 32000000  // 2ë°° ì¦ê°€
```

**âœ… BLAS ëˆ„ë½ í™•ì¸:**
```cpp
// SceneInfo->RayTracingGeometries[0] == nullptr
// â†’ BLAS ì•„ì§ ë¹Œë“œ ì•ˆ ë¨ (4-5 í”„ë ˆì„ ëŒ€ê¸°)
```

---

## ğŸ”— ê´€ë ¨ ë¬¸ì„œ (Related Documents)

- [Overview.md](./Overview.md) - Nanite ì‹œìŠ¤í…œ ì „ì²´ ê°œìš”
- [Streaming.md](./Streaming.md) - Nanite ìŠ¤íŠ¸ë¦¬ë° ì‹œìŠ¤í…œ
- [Material.md](./Material.md) - Nanite Material Shading
- [Culling.md](./Culling.md) - Nanite ì»¬ë§ ì‹œìŠ¤í…œ

---

## ğŸ“š ì°¸ê³  ìë£Œ (References)

### ì†ŒìŠ¤ ì½”ë“œ
- `Engine/Source/Runtime/Renderer/Private/Nanite/NaniteRayTracing.h` (181 ë¼ì¸)
- `Engine/Source/Runtime/Renderer/Private/Nanite/NaniteRayTracing.cpp` (1,359 ë¼ì¸)
- `Engine/Source/Runtime/Renderer/Private/Nanite/NaniteStreamOut.h` (96 ë¼ì¸)
- `Engine/Source/Runtime/Renderer/Private/Nanite/NaniteStreamOut.cpp` (515 ë¼ì¸)
- `Engine/Shaders/Private/Nanite/NaniteRayTracing.usf` (351 ë¼ì¸)
- `Engine/Shaders/Private/Nanite/NaniteStreamOut.usf`

### ê³µì‹ ë¬¸ì„œ
- [Unreal Engine - Ray Tracing](https://docs.unrealengine.com/5.7/en-US/ray-tracing-in-unreal-engine/)
- [Nanite Virtualized Geometry](https://docs.unrealengine.com/5.7/en-US/nanite-virtualized-geometry-in-unreal-engine/)

---

> ğŸ”„ **ì‘ì„±ì¼**: 2025-11-07
> ğŸ“ **ë¬¸ì„œ ë²„ì „**: v1.0
> âœ… **ì†ŒìŠ¤ ê²€ì¦**: UE 5.7.0
> ğŸ“‚ **ì£¼ìš” ì†ŒìŠ¤**: NaniteRayTracing.cpp (1,359 ë¼ì¸), NaniteStreamOut.cpp (515 ë¼ì¸)
