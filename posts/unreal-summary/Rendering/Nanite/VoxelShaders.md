---
title: "Nanite Voxel Shaders (Nanite ì²´ì†Œ ì…°ì´ë”)"
date: "2025-11-23"
status: "stable"
project: "UnrealEngine"
lang: "ko"
category: "unreal-summary"
track: "Rendering"
tags: ["unreal", "Rendering", "Nanite"]
---
# Nanite Voxel Shaders (Nanite ì²´ì†Œ ì…°ì´ë”)

## ğŸ§­ ê°œìš” (Overview)

**Nanite Voxel Shaders**ëŠ” Naniteì˜ ì²´ì†Œ ë Œë”ë§ì„ ë‹´ë‹¹í•˜ëŠ” GPU ì¸¡ êµ¬í˜„ì…ë‹ˆë‹¤. CPUì—ì„œ ìƒì„±ëœ ì²´ì†Œ ë°ì´í„°(FClusterì˜ FBrick)ë¥¼ ì‹¤ì œë¡œ í™”ë©´ì— ê·¸ë¦¬ê¸° ìœ„í•œ ëª¨ë“  ì…°ì´ë” ì½”ë“œê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

**í•µì‹¬ ê¸°ëŠ¥:**
- **DDA ì•Œê³ ë¦¬ì¦˜** - 3D ê·¸ë¦¬ë“œ ìˆœíšŒë¥¼ í†µí•œ ë ˆì´ ì¶”ì 
- **BlockBounds ë””ì½”ë”©** - 64-bit VoxelMaskì—ì„œ ìµœì†Œ/ìµœëŒ€ ë²”ìœ„ ì¶”ì¶œ
- **Brick Key ì¸ì½”ë”©/ë””ì½”ë”©** - ê³µê°„ í•´ì‹± ê¸°ë°˜ ì²´ì†Œ ìœ„ì¹˜ ì €ì¥
- **Visible Brick Detection** - í™”ë©´ì— ë³´ì´ëŠ” ì²´ì†Œ ê°ì§€ ë° í•´ì‹œ í…Œì´ë¸” ì‚½ì…
- **Hybrid Rasterization** - Vertex/Pixel Shaderì™€ Compute Shader í˜¼ìš©
- **Tile-Based Binning** - íƒ€ì¼ ê¸°ë°˜ ë Œë”ë§ ìµœì í™”

**ğŸ“‚ ìœ„ì¹˜:** `Engine/Shaders/Private/Nanite/Voxel/`

**íŒŒì¼ êµ¬ì„±:**
```
Voxel/
â”œâ”€â”€ Voxel.ush               (835 ë¼ì¸) - DDA ì•Œê³ ë¦¬ì¦˜ ë° ë ˆì´ìºìŠ¤íŒ…
â”œâ”€â”€ Brick.ush               (156 ë¼ì¸) - Brick Key ì¸ì½”ë”©/ë””ì½”ë”©
â”œâ”€â”€ AutoVoxel.usf           (200 ë¼ì¸) - ìë™ ì²´ì†Œ ê°ì§€ (Compute Shader)
â”œâ”€â”€ RasterizeBricks.usf     (258 ë¼ì¸) - Brick ë˜ìŠ¤í„°í™” (VS/PS)
â”œâ”€â”€ ScatterBricks.usf       (175 ë¼ì¸) - ì²´ì†Œ ìŠ¤ìºí„° (Compute Shader)
â””â”€â”€ TileBricks.usf          (309 ë¼ì¸) - íƒ€ì¼ ê¸°ë°˜ ë¹ˆë‹ (Compute Shader)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ì´ 1,933 ë¼ì¸
```

**ì—”ì§„ ë²„ì „:** Unreal Engine 5.7.0

---

## ğŸ§± êµ¬ì¡° (Structure)

### ì…°ì´ë” íŒŒì¼ ì—­í•  ë¶„ë‹´

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Nanite Voxel Shader System                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  [1] í—¤ë” íŒŒì¼ (Include Headers)                                        â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Voxel.ush                                                       â”‚  â”‚
â”‚  â”‚  - DDA ì•Œê³ ë¦¬ì¦˜ (InitDDA, StartDDA, StepDDA, NextTime)          â”‚  â”‚
â”‚  â”‚  - BlockBounds() - 64-bit VoxelMask ë””ì½”ë”©                       â”‚  â”‚
â”‚  â”‚  - Ray-Box Intersection                                          â”‚  â”‚
â”‚  â”‚  - RayCastBrick ë³€í˜•ë“¤ (L1, L2, YZ ìµœì í™”)                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Brick.ush                                                       â”‚  â”‚
â”‚  â”‚  - EncodeBrickKey() - ê³µê°„ ì¢Œí‘œ â†’ í•´ì‹œ í‚¤ ë³€í™˜                   â”‚  â”‚
â”‚  â”‚  - DecodeBrickKey() - í•´ì‹œ í‚¤ â†’ ê³µê°„ ì¢Œí‘œ ë³€í™˜                   â”‚  â”‚
â”‚  â”‚  - Brick ë ˆë²¨ ë° í¬ê¸° ê³„ì‚°                                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  [2] Compute Shaders (ë¹„ë™ê¸° ì²˜ë¦¬)                                       â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  AutoVoxel.usf                                                   â”‚  â”‚
â”‚  â”‚  - VisibleBricksHash: í™”ë©´ì— ë³´ì´ëŠ” ì²´ì†Œ ê°ì§€                    â”‚  â”‚
â”‚  â”‚  - Hash Table ì‚½ì… (GPU ë³‘ë ¬)                                    â”‚  â”‚
â”‚  â”‚  - Depth Buffer â†’ Voxel ì¢Œí‘œ ë³€í™˜                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                          â†“                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ScatterBricks.usf                                               â”‚  â”‚
â”‚  â”‚  - ScatterVoxels: ì²´ì†Œ â†’ í”½ì…€ íˆ¬ì˜                               â”‚  â”‚
â”‚  â”‚  - ê° ì²´ì†Œë¥¼ í™”ë©´ì— ì‚°ë€                                          â”‚  â”‚
â”‚  â”‚  - [numthreads(4, 4, 4)] - 64 ìŠ¤ë ˆë“œ/Brick                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                          â†“                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  TileBricks.usf                                                  â”‚  â”‚
â”‚  â”‚  - BinBricksInTiles: Brick â†’ 8x8 íƒ€ì¼ ë¹ˆë‹                       â”‚  â”‚
â”‚  â”‚  - Linked List ê¸°ë°˜ íƒ€ì¼ë³„ Brick ëª©ë¡ ìƒì„±                       â”‚  â”‚
â”‚  â”‚  - Depth ì •ë ¬                                                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  [3] Rasterization Shaders (VS/PS íŒŒì´í”„ë¼ì¸)                           â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  RasterizeBricks.usf                                             â”‚  â”‚
â”‚  â”‚                                                                  â”‚  â”‚
â”‚  â”‚  DrawBricksVS:                                                   â”‚  â”‚
â”‚  â”‚  - Brick Bounding Box ìƒì„±                                       â”‚  â”‚
â”‚  â”‚  - Ray Origin/Direction ê³„ì‚°                                     â”‚  â”‚
â”‚  â”‚                                                                  â”‚  â”‚
â”‚  â”‚  DrawBricksPS:                                                   â”‚  â”‚
â”‚  â”‚  - Pixel Shaderì—ì„œ DDA ì¶”ì                                      â”‚  â”‚
â”‚  â”‚  - RayCastBrick() í˜¸ì¶œ                                           â”‚  â”‚
â”‚  â”‚  - Hit ì‹œ Depth ë° Color ì¶œë ¥                                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”¬ í•µì‹¬ ì•Œê³ ë¦¬ì¦˜ (Key Algorithms)

### 1. DDA (Digital Differential Analyzer) ì•Œê³ ë¦¬ì¦˜

**ğŸ“‚ ìœ„ì¹˜:** `Voxel.ush:33-132`

#### êµ¬ì¡°ì²´ ì •ì˜

```hlsl
struct FRay
{
    float3  Origin;
    float3  Direction;
    float2  Time;       // [tMin, tMax]
};

struct FDDA
{
    float2  Time;       // [Current, End]

    bool3   IsPositive; // ë°©í–¥ ë¶€í˜¸
    int3    Step;       // ì¸ë±ìŠ¤ ì¦ê°€ëŸ‰ (1, 4, 16 ë˜ëŠ” -1, -4, -16)
    uint    VoxelIndex; // í˜„ì¬ ì²´ì†Œ ì„ í˜• ì¸ë±ìŠ¤ (x + y*4 + z*16)

    float3  InvDir;     // 1 / Ray.Direction
    float3  Next;       // ë‹¤ìŒ ê²½ê³„ê¹Œì§€ì˜ ì‹œê°„ [tX, tY, tZ]
};
```

#### DDA ì´ˆê¸°í™”

```hlsl
// Voxel.ush:53-62
FDDA InitDDA( FRay Ray )
{
    FDDA DDA;
    DDA.Time = Ray.Time;
    DDA.IsPositive = Ray.Direction >= 0;

    // Step ë°©í–¥ ê²°ì •
    // x: Â±1, y: Â±4 (4*1), z: Â±16 (4*4)
    DDA.Step = select( DDA.IsPositive, int3( 1, 4, 16 ), -int3( 1, 4, 16 ) );

    DDA.VoxelIndex = 0;
    DDA.InvDir = rcp( Ray.Direction );  // 1 / Direction
    return DDA;
}
```

**Step ê°’ì˜ ì˜ë¯¸:**
```
4x4x4 ê·¸ë¦¬ë“œì—ì„œ ì„ í˜• ì¸ë±ìŠ¤:
Index = x + y * 4 + z * 16

x ë°©í–¥ +1 â†’ Index += 1
y ë°©í–¥ +1 â†’ Index += 4
z ë°©í–¥ +1 â†’ Index += 16
```

#### DDA ì‹œì‘

```hlsl
// Voxel.ush:64-75
void StartDDA( inout FDDA DDA, const uint Dimension, const FRay Ray )
{
    float3 Position = Ray.Origin + Ray.Direction * DDA.Time[0];
    int3 Voxel = floor( Position );  // ì •ìˆ˜ ì²´ì†Œ ì¢Œí‘œ

    // ì„ í˜• ì¸ë±ìŠ¤ ê³„ì‚°
    DDA.VoxelIndex = uint( ( Voxel.x + Voxel.y * 4 ) + Voxel.z * 16 );
    DDA.InvDir = rcp( Ray.Direction );

    // ë‹¤ìŒ ê²½ê³„ê¹Œì§€ì˜ ê±°ë¦¬ ê³„ì‚°
    float3 Frac = select_internal( DDA.IsPositive, Dimension, 0.0f ) - frac( Position );
    DDA.Next = DDA.Time[0] + Frac * DDA.InvDir;
}
```

#### DDA ìŠ¤í…

```hlsl
// Voxel.ush:82-132
void StepDDA( inout FDDA DDA, const uint Dimension )
{
    DDA.Time[0] = NextTime( DDA );  // min(Next.x, Next.y, Next.z)

    // ê°€ì¥ ê°€ê¹Œìš´ ê²½ê³„ ì°¾ê¸°
    BRANCH
    if( DDA.Next.x == DDA.Time[0] )
    {
        // X ê²½ê³„ í†µê³¼
        DDA.Next.x += abs( DDA.InvDir.x );
        DDA.VoxelIndex += DDA.Step.x;  // Â±1
    }
    else
    {
        BRANCH
        if( DDA.Next.y == DDA.Time[0] )
        {
            // Y ê²½ê³„ í†µê³¼
            DDA.Next.y += abs( DDA.InvDir.y );
            DDA.VoxelIndex += DDA.Step.y;  // Â±4
        }
        else
        {
            // Z ê²½ê³„ í†µê³¼
            DDA.Next.z += abs( DDA.InvDir.z );
            DDA.VoxelIndex += DDA.Step.z;  // Â±16
        }
    }
}

float NextTime( FDDA DDA )
{
    return min3( DDA.Next.x, DDA.Next.y, DDA.Next.z );
}
```

#### DDA ì•Œê³ ë¦¬ì¦˜ ì‹œê°í™”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     DDA ì•Œê³ ë¦¬ì¦˜ - 3D ê·¸ë¦¬ë“œ ìˆœíšŒ                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  [Step 0: ì´ˆê¸°í™”]                                                        â”‚
â”‚                                                                         â”‚
â”‚     z=1                                                                 â”‚
â”‚     â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”                                                  â”‚
â”‚     â”‚   â”‚   â”‚   â”‚   â”‚                                                  â”‚
â”‚     â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤                                                  â”‚
â”‚     â”‚   â”‚ â—‰ â”‚ â–  â”‚ â–  â”‚  â† Ray.Origin (1.5, 1.3)                        â”‚
â”‚     â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤     Direction (0.6, 0.5)                         â”‚
â”‚     â”‚   â”‚   â”‚   â”‚   â”‚                                                  â”‚
â”‚     â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤                                                  â”‚
â”‚     â”‚   â”‚   â”‚   â”‚   â”‚                                                  â”‚
â”‚     â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜                                                  â”‚
â”‚         xâ†’                                                              â”‚
â”‚                                                                         â”‚
â”‚  DDA.VoxelIndex = 5 (1 + 1*4 = 5)                                      â”‚
â”‚  DDA.Next = (t_x, t_y, t_z) = (0.83, 1.40, ...)                        â”‚
â”‚                                                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  [Step 1: X ê²½ê³„ í†µê³¼]                                                   â”‚
â”‚                                                                         â”‚
â”‚     â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”                                                  â”‚
â”‚     â”‚   â”‚   â”‚   â”‚   â”‚                                                  â”‚
â”‚     â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤                                                  â”‚
â”‚     â”‚   â”‚   â”‚ â—‰ â”‚ â–  â”‚  â† VoxelIndex = 6 (5 + 1)                       â”‚
â”‚     â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤                                                  â”‚
â”‚     â”‚   â”‚   â”‚   â”‚   â”‚                                                  â”‚
â”‚     â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤                                                  â”‚
â”‚     â”‚   â”‚   â”‚   â”‚   â”‚                                                  â”‚
â”‚     â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜                                                  â”‚
â”‚                                                                         â”‚
â”‚  DDA.Time[0] = 0.83 (ì´ì „ Next.x)                                       â”‚
â”‚  DDA.Next.x += abs( InvDir.x ) = 2.50                                  â”‚
â”‚                                                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  [Step 2: Y ê²½ê³„ í†µê³¼]                                                   â”‚
â”‚                                                                         â”‚
â”‚     â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”                                                  â”‚
â”‚     â”‚   â”‚   â”‚   â”‚   â”‚                                                  â”‚
â”‚     â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤                                                  â”‚
â”‚     â”‚   â”‚   â”‚   â”‚ â–  â”‚                                                  â”‚
â”‚     â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤                                                  â”‚
â”‚     â”‚   â”‚   â”‚ â—‰ â”‚   â”‚  â† VoxelIndex = 10 (6 + 4)                      â”‚
â”‚     â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤                                                  â”‚
â”‚     â”‚   â”‚   â”‚   â”‚   â”‚                                                  â”‚
â”‚     â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜                                                  â”‚
â”‚                                                                         â”‚
â”‚  DDA.Time[0] = 1.40 (ì´ì „ Next.y)                                       â”‚
â”‚  DDA.Next.y += abs( InvDir.y ) = 3.40                                  â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  ì„±ëŠ¥:
  - ê° ìŠ¤í…: 3ê°œ ë¹„êµ + 1ê°œ ë§ì…ˆ = O(1)
  - ì´ ìŠ¤í… ìˆ˜: ì²´ì†Œ ê·¸ë¦¬ë“œ í¬ê¸°ì— ì„ í˜• ë¹„ë¡€
  - ë¶„ê¸° ì˜ˆì¸¡ ì¹œí™”ì  (ìˆœì°¨ ì ‘ê·¼)
```

---

### 2. BlockBounds - 64-bit VoxelMask ë””ì½”ë”©

**ğŸ“‚ ìœ„ì¹˜:** `Voxel.ush:10-31`

#### ì•Œê³ ë¦¬ì¦˜ ì„¤ëª…

4x4x4 = 64ê°œ ì²´ì†Œë¥¼ 64-bitë¡œ ì¸ì½”ë”©í•˜ë©´, ê° ë¹„íŠ¸ê°€ ì²´ì†Œì˜ ì¡´ì¬ ì—¬ë¶€ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤:

```
Bit = x + y * 4 + z * 16
```

BlockBoundsëŠ” ì´ 64-bit ë¹„íŠ¸ë§ˆìŠ¤í¬ì—ì„œ **ì‹¤ì œ ì¡´ì¬í•˜ëŠ” ì²´ì†Œì˜ ìµœì†Œ/ìµœëŒ€ ë²”ìœ„**ë¥¼ ì¶”ì¶œí•©ë‹ˆë‹¤.

#### êµ¬í˜„

```hlsl
// Voxel.ush:10-31
void BlockBounds( uint2 Block, out uint3 Min, out uint3 Max )
{
    // Block is 64bits split into 2 uints to represent 4x4x4.
    // Bit = x + y * 4 + z * 16;

    // Min is inclusive. Max is exclusive.

    const uint Low  = Block.x ? Block.x : Block.y;
    const uint High = Block.y ? Block.y : Block.x;

    // Zì¶• ë²”ìœ„ ê³„ì‚°
    Min.z = ( firstbitlow( Low )   >> 4 ) + ( Block.x ? 0 : 2 );
    Max.z = ( firstbithigh( High ) >> 4 ) + ( Block.y ? 3 : 1 );

    // Yì¶• ë²”ìœ„ ê³„ì‚°
    uint Bits = Block.x | Block.y;
    Bits = ( Bits | ( Bits << 16 ) );
    Min.y = firstbitlow( Bits >> 16 ) >> 2;
    Max.y = (firstbithigh( Bits ) >> 2 ) - 4 + 1;

    // Xì¶• ë²”ìœ„ ê³„ì‚°
    Bits = ( Bits | ( Bits << 8 ) );
    Bits = ( Bits | ( Bits << 4 ) );
    Min.x = firstbitlow( Bits >> 28 );
    Max.x = firstbithigh( Bits ) - 28 + 1;
}
```

#### ë¹„íŠ¸ ì¡°ì‘ ì‹œê°í™”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BlockBounds ë¹„íŠ¸ ë””ì½”ë”©                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  [ì…ë ¥] 64-bit VoxelMask (Block.x, Block.y)                             â”‚
â”‚                                                                         â”‚
â”‚  Block.x = 0b00000000_00000000_00000000_11110000                        â”‚
â”‚  Block.y = 0b00000000_00000000_00001111_00000000                        â”‚
â”‚                                                                         â”‚
â”‚  4x4x4 ê·¸ë¦¬ë“œ í•´ì„:                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚  â”‚  z=0 (Bit 0-15 in Block.x)              â”‚                           â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”                      â”‚                           â”‚
â”‚  â”‚  â”‚   â”‚   â”‚   â”‚   â”‚  y=3                 â”‚                           â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤                      â”‚                           â”‚
â”‚  â”‚  â”‚   â”‚   â”‚   â”‚   â”‚  y=2                 â”‚                           â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤                      â”‚                           â”‚
â”‚  â”‚  â”‚ â–  â”‚ â–  â”‚ â–  â”‚ â–  â”‚  y=1  â† Block.x Bit 4-7                        â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤                      â”‚                           â”‚
â”‚  â”‚  â”‚   â”‚   â”‚   â”‚   â”‚  y=0                 â”‚                           â”‚
â”‚  â”‚  â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜                      â”‚                           â”‚
â”‚  â”‚   x=0  1   2   3                        â”‚                           â”‚
â”‚  â”‚                                          â”‚                           â”‚
â”‚  â”‚  z=1 (Bit 16-31 in Block.x)             â”‚                           â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”                      â”‚                           â”‚
â”‚  â”‚  â”‚   â”‚   â”‚   â”‚   â”‚  y=3                 â”‚                           â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤                      â”‚                           â”‚
â”‚  â”‚  â”‚   â”‚   â”‚   â”‚   â”‚  y=2                 â”‚                           â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤                      â”‚                           â”‚
â”‚  â”‚  â”‚   â”‚   â”‚   â”‚   â”‚  y=1                 â”‚                           â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤                      â”‚                           â”‚
â”‚  â”‚  â”‚   â”‚   â”‚   â”‚   â”‚  y=0                 â”‚                           â”‚
â”‚  â”‚  â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜                      â”‚                           â”‚
â”‚  â”‚                                          â”‚                           â”‚
â”‚  â”‚  z=2 (Bit 0-15 in Block.y)              â”‚                           â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”                      â”‚                           â”‚
â”‚  â”‚  â”‚   â”‚   â”‚   â”‚   â”‚  y=3                 â”‚                           â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤                      â”‚                           â”‚
â”‚  â”‚  â”‚ â–  â”‚ â–  â”‚ â–  â”‚ â–  â”‚  y=2  â† Block.y Bit 8-11                       â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤                      â”‚                           â”‚
â”‚  â”‚  â”‚   â”‚   â”‚   â”‚   â”‚  y=1                 â”‚                           â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤                      â”‚                           â”‚
â”‚  â”‚  â”‚   â”‚   â”‚   â”‚   â”‚  y=0                 â”‚                           â”‚
â”‚  â”‚  â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜                      â”‚                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                                                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  [ê³„ì‚° ê³¼ì •]                                                             â”‚
â”‚                                                                         â”‚
â”‚  1. Zì¶• ë²”ìœ„:                                                            â”‚
â”‚     firstbitlow( Block.x ) = 4   â†’ 4 >> 4 = 0, z_min = 0               â”‚
â”‚     firstbithigh( Block.y ) = 11 â†’ 11 >> 4 = 0, z_max = 0 + 3 = 3      â”‚
â”‚                                                                         â”‚
â”‚  2. Yì¶• ë²”ìœ„:                                                            â”‚
â”‚     Bits = Block.x | Block.y = 0x00000FF0 | 0x00000F00                  â”‚
â”‚     Bits |= Bits << 16 = 0x0FF00FF0                                     â”‚
â”‚     firstbitlow( Bits >> 16 ) = 8 â†’ 8 >> 2 = 2, y_min = 1              â”‚
â”‚     firstbithigh( Bits ) = 11 â†’ 11 >> 2 = 2, y_max = 2 - 4 + 1 = 3     â”‚
â”‚                                                                         â”‚
â”‚  3. Xì¶• ë²”ìœ„:                                                            â”‚
â”‚     Bits |= Bits << 8  = 0xFFF0FFF0                                     â”‚
â”‚     Bits |= Bits << 4  = 0xFFFFFFFF                                     â”‚
â”‚     firstbitlow( Bits >> 28 ) = 0, x_min = 0                            â”‚
â”‚     firstbithigh( Bits ) = 31 â†’ 31 - 28 + 1 = 4, x_max = 4             â”‚
â”‚                                                                         â”‚
â”‚  [ê²°ê³¼]                                                                  â”‚
â”‚  Min = (0, 1, 0)  â† í¬í•¨                                                â”‚
â”‚  Max = (4, 3, 3)  â† ì œì™¸ (exclusive)                                    â”‚
â”‚                                                                         â”‚
â”‚  ì‹¤ì œ ë°”ìš´ë”© ë°•ìŠ¤: [0, 4) x [1, 3) x [0, 3)                              â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ìµœì í™” ê¸°ë²•

1. **64-bit ì¸íŠ¸ë¦°ì‹ ë¯¸ì§€ì› í”Œë«í¼ ëŒ€ì‘**
   - `uint2`ë¡œ ë¶„í• í•˜ì—¬ 32-bit ì¸íŠ¸ë¦°ì‹ ì‚¬ìš©
   - `firstbitlow()`, `firstbithigh()` - í•˜ë“œì›¨ì–´ ê°€ì†

2. **ë¹„íŠ¸ OR ì „íŒŒ**
   - X, Y ì¶• ë²”ìœ„ ê³„ì‚° ì‹œ ë¹„íŠ¸ë¥¼ ì‹œí”„íŠ¸í•˜ì—¬ OR ì—°ì‚°
   - ìµœì†Œ/ìµœëŒ€ ë¹„íŠ¸ ìœ„ì¹˜ë¥¼ ë¹ ë¥´ê²Œ ì°¾ê¸°

---

### 3. Brick Key ì¸ì½”ë”©/ë””ì½”ë”© ì‹œìŠ¤í…œ

**ğŸ“‚ ìœ„ì¹˜:** `Brick.ush:1-156`

#### Brick Key êµ¬ì¡°

```hlsl
// 3 x uint32 = 96 bits
uint3 BrickKey;

// êµ¬ì¡°:
// Key.x: BrickPos.x (28 bits signed, 0x0FFFFFFF ë§ˆìŠ¤í¬)
// Key.y: BrickPos.y (28 bits signed, 0x0FFFFFFF ë§ˆìŠ¤í¬)
// Key.z: BrickPos.z (28 bits signed) + Level (4 bits, ìƒìœ„ 28-31 bit)
```

#### ì¸ì½”ë”© í•¨ìˆ˜

```hlsl
uint3 EncodeBrickKey( float3 BrickPos, float Level )
{
    // Signed â†’ Unsigned ë³€í™˜ (0x1000000 ì˜¤í”„ì…‹)
    int3 Signed = int3( BrickPos ) + 0x1000000;
    uint3 Brick = uint3( Signed ) & 0xfffffff;  // 28-bit ë§ˆìŠ¤í¬

    uint uLevel = uint( Level ) & 15;  // 4-bit ë ˆë²¨

    uint3 Key;
    Key.x = Brick.x;
    Key.y = Brick.y;
    Key.z = Brick.z;
    Key.z |= uLevel << 28;  // ë ˆë²¨ì„ ìƒìœ„ 4ë¹„íŠ¸ì— ì €ì¥

    return Key;
}
```

#### ë””ì½”ë”© í•¨ìˆ˜

```hlsl
void DecodeBrickKey( uint3 BrickKey, out float3 BrickPos, out float CubeSize )
{
    // Unsigned â†’ Signed ë³€í™˜
    int3 Signed;
    Signed.x = BrickKey.x;
    Signed.y = BrickKey.y;
    Signed.z = BrickKey.z & 0xfffffff;  // í•˜ìœ„ 28ë¹„íŠ¸ë§Œ
    Signed -= 0x1000000;

    BrickPos = float3( Signed );

    // ë ˆë²¨ ì¶”ì¶œ
    float Level = float( ( BrickKey.z >> 28 ) & 0xf );

    // íë¸Œ í¬ê¸° ê³„ì‚°
    CubeSize = (VoxelSize * BrickSize) * exp2( Level );
    // Level 0: 1.0
    // Level 1: 2.0
    // Level 2: 4.0
    // ...
}
```

#### Brick Key ì‹œê°í™”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Brick Key ì¸ì½”ë”© ì‹œìŠ¤í…œ                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  [ì…ë ¥] BrickPos = (-1234.5, 567.8, 890.1), Level = 2                   â”‚
â”‚                                                                         â”‚
â”‚  [Step 1] Signed â†’ Unsigned ë³€í™˜                                         â”‚
â”‚                                                                         â”‚
â”‚  Signed = int3( BrickPos ) + 0x1000000                                  â”‚
â”‚         = (-1235, 567, 890) + 0x1000000                                 â”‚
â”‚         = (0xFFFFB2D, 0x1000237, 0x100037A)                             â”‚
â”‚                                                                         â”‚
â”‚  Brick = Signed & 0xFFFFFFF  (28-bit ë§ˆìŠ¤í¬)                            â”‚
â”‚        = (0xFFFB2D, 0x0000237, 0x000037A)                               â”‚
â”‚                                                                         â”‚
â”‚  [Step 2] Level íŒ¨í‚¹                                                     â”‚
â”‚                                                                         â”‚
â”‚  uLevel = 2 & 15 = 2                                                    â”‚
â”‚  Key.z = 0x000037A | (2 << 28)                                          â”‚
â”‚        = 0x000037A | 0x20000000                                         â”‚
â”‚        = 0x2000037A                                                     â”‚
â”‚                                                                         â”‚
â”‚  [ê²°ê³¼] BrickKey = (0x0FFFB2D, 0x0000237, 0x2000037A)                   â”‚
â”‚                                                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  [ë””ì½”ë”©]                                                                â”‚
â”‚                                                                         â”‚
â”‚  Signed.x = 0x0FFFB2D â†’ -1235 (after - 0x1000000)                      â”‚
â”‚  Signed.y = 0x0000237 â†’ 567                                             â”‚
â”‚  Signed.z = 0x2000037A & 0xFFFFFFF = 0x000037A â†’ 890                    â”‚
â”‚                                                                         â”‚
â”‚  Level = ( 0x2000037A >> 28 ) & 0xF = 2                                 â”‚
â”‚                                                                         â”‚
â”‚  BrickPos = (-1235.0, 567.0, 890.0)                                     â”‚
â”‚  CubeSize = (VoxelSize * BrickSize) * exp2( 2 )                         â”‚
â”‚           = (VoxelSize * BrickSize) * 4.0                               â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  ìš©ë„:
  - í•´ì‹œ í…Œì´ë¸” í‚¤ë¡œ ì‚¬ìš© (Visible Brick Detection)
  - ê³µê°„ ì •ë ¬ (Morton Code ëŒ€ì‹  ë‹¨ìˆœ XYZ ì¢Œí‘œ)
  - ë ˆë²¨ë³„ LOD êµ¬ë¶„

  ì œì•½:
  - 28-bit signed: Â±134,217,728 ë²”ìœ„
  - 4-bit level: 0-15 ë ˆë²¨ ì§€ì›
```

---

## ğŸ¨ ë Œë”ë§ íŒ¨ìŠ¤ (Rendering Passes)

### 1. AutoVoxel - ê°€ì‹œ ì²´ì†Œ ê°ì§€

**ğŸ“‚ ìœ„ì¹˜:** `AutoVoxel.usf:1-200`

#### ì—­í• 

í™”ë©´ì— ë Œë”ë§ëœ í”½ì…€ì˜ Depth Bufferë¥¼ ì½ì–´ í•´ë‹¹ ìœ„ì¹˜ì˜ ì²´ì†Œë¥¼ ê°ì§€í•˜ê³ , í•´ì‹œ í…Œì´ë¸”ì— ì‚½ì…í•©ë‹ˆë‹¤.

#### Compute Shader

```hlsl
[numthreads(8, 8, 1)]
void VisibleBricksHash(uint2 PixelPos : SV_DispatchThreadID, uint GroupIndex : SV_GroupIndex)
{
    // 1. Depth Buffer ì½ê¸°
    float Depth = SceneTexturesStruct.SceneDepthTexture.Load( int3( PixelPos, 0 ) ).r;

    // 2. Depth â†’ Voxel ì¢Œí‘œ ë³€í™˜
    int4 Voxel = DepthToVoxel( PixelPos, Depth );
    // Voxel.xyz: ì²´ì†Œ ìœ„ì¹˜
    // Voxel.w: ë ˆë²¨

    // 3. Brick Key ìƒì„±
    uint3 BrickKey = EncodeBrickKey( Voxel.xyz >> uint( BrickSizeLog2 ), Voxel.w );

    // 4. í•´ì‹œ í…Œì´ë¸”ì— ì‚½ì… ì‹œë„
    uint4 Hash = Rand4DPCG32( int4( Voxel.xyz >> uint( BrickSizeLog2 ), Voxel.w ) );
    bool bAdded = HashTableAdd( Hash.x, Hash.y );

    // 5. ìƒˆë¡œ ì¶”ê°€ëœ ê²½ìš° Brick Bufferì— ì €ì¥
    if( bAdded )
    {
        uint BrickIndex = RWBrickBuffer.IncrementCounter();

        FBrick Brick;
        Brick.Key = BrickKey;

        RWBrickBuffer[ BrickIndex ] = Brick;
    }
}
```

#### í”„ë¡œì„¸ìŠ¤ ì‹œê°í™”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     AutoVoxel - Visible Brick Detection                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  [í™”ë©´]                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚  â”‚  PixelPos (123, 456)                    â”‚                           â”‚
â”‚  â”‚  Depth = 0.765                          â”‚                           â”‚
â”‚  â”‚         â†“                                â”‚                           â”‚
â”‚  â”‚  DepthToVoxel()                         â”‚                           â”‚
â”‚  â”‚         â†“                                â”‚                           â”‚
â”‚  â”‚  Voxel = (12, 34, 56, Level=1)          â”‚                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚         â†“                                                               â”‚
â”‚  EncodeBrickKey( (12>>2, 34>>2, 56>>2), 1 )                             â”‚
â”‚         = EncodeBrickKey( (3, 8, 14), 1 )                               â”‚
â”‚         â†“                                                               â”‚
â”‚  BrickKey = (0x1000003, 0x1000008, 0x100000E)                           â”‚
â”‚                                                                         â”‚
â”‚         â†“                                                               â”‚
â”‚  Hash = Rand4DPCG32( (3, 8, 14, 1) )                                    â”‚
â”‚       = (0xA7B9C3D2, 0x4F5E6D1C, ...)                                   â”‚
â”‚                                                                         â”‚
â”‚         â†“                                                               â”‚
â”‚  HashTableAdd( 0xA7B9C3D2, 0x4F5E6D1C )                                 â”‚
â”‚         â†“                                                               â”‚
â”‚  [í•´ì‹œ í…Œì´ë¸” ì²´í¬]                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚  â”‚  Slot = Hash % TableSize              â”‚                             â”‚
â”‚  â”‚  if( Table[Slot] == Empty )           â”‚                             â”‚
â”‚  â”‚  {                                     â”‚                             â”‚
â”‚  â”‚      Table[Slot] = (Hash, BrickKey);  â”‚                             â”‚
â”‚  â”‚      return true;  // ìƒˆë¡œ ì¶”ê°€ë¨      â”‚                             â”‚
â”‚  â”‚  }                                     â”‚                             â”‚
â”‚  â”‚  else                                  â”‚                             â”‚
â”‚  â”‚      return false; // ì´ë¯¸ ì¡´ì¬        â”‚                             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚         â†“                                                               â”‚
â”‚  if( bAdded )                                                           â”‚
â”‚  {                                                                      â”‚
â”‚      BrickIndex = BrickBuffer.IncrementCounter();                       â”‚
â”‚      BrickBuffer[BrickIndex] = Brick { BrickKey };                      â”‚
â”‚  }                                                                      â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  ì„±ëŠ¥:
  - Dispatch: (ScreenWidth/8, ScreenHeight/8, 1)
  - 1920x1080 í™”ë©´ â†’ 240x135 = 32,400 ìŠ¤ë ˆë“œ ê·¸ë£¹
  - ê° ìŠ¤ë ˆë“œ: 1 Depth ì½ê¸° + 1 Hash Table ì ‘ê·¼
  - ë³‘ë ¬ ì²˜ë¦¬ë¡œ ë§¤ìš° ë¹ ë¦„ (< 0.5ms)
```

---

### 2. RasterizeBricks - Brick ë˜ìŠ¤í„°í™”

**ğŸ“‚ ìœ„ì¹˜:** `RasterizeBricks.usf:1-258`

#### ì—­í• 

ê° Brickì„ Bounding Boxë¡œ ê·¸ë¦¬ê³ , Pixel Shaderì—ì„œ DDA ì¶”ì ìœ¼ë¡œ ì‹¤ì œ ì²´ì†Œë¥¼ ë Œë”ë§í•©ë‹ˆë‹¤.

#### Vertex Shader

```hlsl
void DrawBricksVS(
    uint VertexID : SV_VertexID,
    uint InstanceID : SV_InstanceID,
    out uint OutBrickOffset : TEXCOORD0,
    out float3 RayOrigin : TEXCOORD2,
    out float3 RayDirection : TEXCOORD3,
    out float4 OutPosition : SV_POSITION)
{
    // 1. Brick ì •ë³´ ì½ê¸°
    FBrick Brick = BrickBuffer[ InstanceID ];

    // 2. Brick Key ë””ì½”ë”©
    float3 BrickPos;
    float CubeSize;
    DecodeBrickKey( Brick.Key, BrickPos, CubeSize );

    // 3. Bounding Box ìƒì„± (Cube 8 vertices)
    float3 VertexPos[8] = {
        BrickPos + float3(0, 0, 0) * CubeSize,
        BrickPos + float3(1, 0, 0) * CubeSize,
        BrickPos + float3(0, 1, 0) * CubeSize,
        BrickPos + float3(1, 1, 0) * CubeSize,
        BrickPos + float3(0, 0, 1) * CubeSize,
        BrickPos + float3(1, 0, 1) * CubeSize,
        BrickPos + float3(0, 1, 1) * CubeSize,
        BrickPos + float3(1, 1, 1) * CubeSize,
    };

    // 4. Cube ì¸ë±ìŠ¤ ë²„í¼ (36 triangles for a cube)
    uint Index = CubeIndices[ VertexID ];
    float3 LocalPos = VertexPos[ Index ];

    // 5. ì›”ë“œ â†’ í´ë¦½ ê³µê°„
    OutPosition = mul( float4( LocalPos, 1 ), View.TranslatedWorldToClip );

    // 6. Ray ì •ë³´ ì „ë‹¬
    RayOrigin = View.WorldCameraOrigin - BrickPos;
    RayDirection = normalize( LocalPos - View.WorldCameraOrigin );
    OutBrickOffset = Brick.Offset;
}
```

#### Pixel Shader

```hlsl
void DrawBricksPS(
    uint BrickOffset : TEXCOORD0,
    float3 RayOrigin : TEXCOORD2,
    float3 RayDirection : TEXCOORD3,
    out float4 OutColor : SV_Target0,
    out float OutDepth : SV_Depth)
{
    // 1. Ray ì„¤ì •
    FRay Ray;
    Ray.Origin = RayOrigin / CubeSize;  // Local 0-1 space
    Ray.Direction = normalize( RayDirection );
    Ray.Time = float2( 0, 1 );

    // 2. Brick-Box êµì°¨ í…ŒìŠ¤íŠ¸
    Ray.Time = RayUnitBox( Ray );

    if( Ray.Time[0] >= Ray.Time[1] )
        discard;  // êµì°¨ ì—†ìŒ

    // 3. DDA ë ˆì´ìºìŠ¤íŒ…
    FRayCastCounters Counters = (FRayCastCounters)0;
    float HitTime = RayCastBrick_L2( Ray, BrickOffset, Counters );

    if( HitTime > Ray.Time[1] )
        discard;  // Hit ì—†ìŒ

    // 4. Hit ì§€ì  ê³„ì‚°
    float3 HitPos = Ray.Origin + Ray.Direction * HitTime;
    float3 WorldHitPos = HitPos * CubeSize + BrickPos;

    // 5. Depth ì¶œë ¥
    float4 ClipPos = mul( float4( WorldHitPos, 1 ), View.TranslatedWorldToClip );
    OutDepth = ClipPos.z / ClipPos.w;

    // 6. Color ì¶œë ¥
    OutColor = float4( VoxelColor, 1 );
}
```

#### ë Œë”ë§ íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   RasterizeBricks ë Œë”ë§ íŒŒì´í”„ë¼ì¸                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  [Input Assembler]                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚  â”‚ DrawInstancedIndirect( BrickCount )         â”‚                       â”‚
â”‚  â”‚ - VertexCount: 36 (Cube triangles)          â”‚                       â”‚
â”‚  â”‚ - InstanceCount: 1234 (Visible Bricks)      â”‚                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚         â†“                                                               â”‚
â”‚  [Vertex Shader - DrawBricksVS]                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚  â”‚ For each Brick:                             â”‚                       â”‚
â”‚  â”‚   1. BrickKey ë””ì½”ë”©                         â”‚                       â”‚
â”‚  â”‚   2. Bounding Box ìƒì„± (8 vertices)          â”‚                       â”‚
â”‚  â”‚   3. Cube ê·¸ë¦¬ê¸° (36 triangles)              â”‚                       â”‚
â”‚  â”‚   4. Ray Origin/Direction ê³„ì‚°               â”‚                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚         â†“                                                               â”‚
â”‚  [Rasterizer]                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚  â”‚ Brickì˜ Bounding Boxë¥¼ í”½ì…€ë¡œ ë³€í™˜           â”‚                       â”‚
â”‚  â”‚ - ìŠ¤í¬ë¦° ê³µê°„ íˆ¬ì˜                            â”‚                       â”‚
â”‚  â”‚ - í”½ì…€ ë‹¨ìœ„ Shader í˜¸ì¶œ                       â”‚                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚         â†“                                                               â”‚
â”‚  [Pixel Shader - DrawBricksPS]                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚  â”‚ For each Pixel:                             â”‚                       â”‚
â”‚  â”‚   1. Ray-Box êµì°¨ í…ŒìŠ¤íŠ¸                     â”‚                       â”‚
â”‚  â”‚   2. DDA ë ˆì´ìºìŠ¤íŒ… (RayCastBrick_L2)        â”‚                       â”‚
â”‚  â”‚      â†“                                       â”‚                       â”‚
â”‚  â”‚      [DDA Loop]                              â”‚                       â”‚
â”‚  â”‚      - InitDDA()                             â”‚                       â”‚
â”‚  â”‚      - StartDDA()                            â”‚                       â”‚
â”‚  â”‚      - while( Time < End )                   â”‚                       â”‚
â”‚  â”‚        {                                     â”‚                       â”‚
â”‚  â”‚            if( VoxelExists )                 â”‚                       â”‚
â”‚  â”‚                return HitTime;               â”‚                       â”‚
â”‚  â”‚            StepDDA();                        â”‚                       â”‚
â”‚  â”‚        }                                     â”‚                       â”‚
â”‚  â”‚   3. Hit ì‹œ Depth/Color ì¶œë ¥                 â”‚                       â”‚
â”‚  â”‚   4. Miss ì‹œ discard                         â”‚                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚         â†“                                                               â”‚
â”‚  [Output Merger]                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚  â”‚ VisibilityBuffer (64-bit)                   â”‚                       â”‚
â”‚  â”‚ - ClusterIndex: 25 bits                     â”‚                       â”‚
â”‚  â”‚ - TriangleIndex: 7 bits                     â”‚                       â”‚
â”‚  â”‚ - Depth: 32 bits                            â”‚                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  ì„±ëŠ¥:
  - Vertex Shader: 36 x BrickCount í˜¸ì¶œ
  - Pixel Shader: í”½ì…€ë‹¹ DDA ì¶”ì  (~10-20 steps)
  - Early-Z ë° Depth Testë¡œ Overdraw ìµœì†Œí™”
```

---

### 3. ScatterBricks - ì²´ì†Œ ìŠ¤ìºí„°

**ğŸ“‚ ìœ„ì¹˜:** `ScatterBricks.usf:1-175`

#### ì—­í• 

ê° Brickì˜ ì²´ì†Œë¥¼ í™”ë©´ì— ì§ì ‘ íˆ¬ì˜í•˜ëŠ” Compute Shader ê¸°ë°˜ ì ‘ê·¼ë²•ì…ë‹ˆë‹¤.

#### Compute Shader

```hlsl
[numthreads(4, 4, 4)]
void ScatterVoxels(uint BrickIndex : SV_GroupID, uint3 Voxel : SV_GroupThreadID)
{
    // 1. Brick ì •ë³´
    FBrick Brick = BrickBuffer[ BrickIndex ];

    float3 BrickPos;
    float CubeSize;
    DecodeBrickKey( Brick.Key, BrickPos, CubeSize );

    // 2. ì²´ì†Œ ì¸ë±ìŠ¤
    uint VoxelIndex = Voxel.x + Voxel.y * 4 + Voxel.z * 16;
    uint VoxelMask = 1u << ( VoxelIndex & 31 );

    uint2 Block = BlockBuffer.Load2( 8 * Brick.Offset );
    bool bVoxelExists = ( VoxelIndex < 32 ? Block.x : Block.y ) & VoxelMask;

    if( !bVoxelExists )
        return;  // ë¹ˆ ì²´ì†Œ

    // 3. ì²´ì†Œ ì›”ë“œ ìœ„ì¹˜
    float3 WorldMin = BrickPos * CubeSize;
    float3 WorldMax = WorldMin + CubeSize;
    float3 PointWorld = lerp( WorldMin, WorldMax, Voxel * 0.25 + 0.125 );

    // 4. ìŠ¤í¬ë¦° íˆ¬ì˜
    float4 PointClip = mul( float4( PointWorld, 1 ), View.TranslatedWorldToClip );
    float3 PointNDC = PointClip.xyz / PointClip.w;

    uint2 PointPixels = ( PointNDC.xy * 0.5 + 0.5 ) * View.ViewSizeAndInvSize.xy;
    float DeviceZ = PointNDC.z;

    // 5. í”½ì…€ì— ì“°ê¸° (Atomic Min Depth)
    WritePixel( VoxelIndex, PointPixels, DeviceZ );
}
```

#### ìŠ¤ìºí„° ë°©ì‹ ì‹œê°í™”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       ScatterBricks - Voxel Scattering                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  [Brick 0]                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚  â”‚  4x4x4 = 64 Voxels                    â”‚                             â”‚
â”‚  â”‚  [numthreads(4,4,4)]                  â”‚                             â”‚
â”‚  â”‚  â†’ 64 Compute Threads                 â”‚                             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚         â†“ ê° ìŠ¤ë ˆë“œê°€ 1ê°œ ì²´ì†Œ ì²˜ë¦¬                                      â”‚
â”‚  â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”                                                     â”‚
â”‚  â”‚ â–  â”‚   â”‚ â–  â”‚   â”‚  Thread(0,0,0) â†’ Voxel(0,0,0) â†’ Screen(123, 456)   â”‚
â”‚  â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤  Thread(1,0,0) â†’ Voxel(1,0,0) â†’ (empty, skip)      â”‚
â”‚  â”‚   â”‚ â–  â”‚   â”‚ â–  â”‚  Thread(2,0,0) â†’ Voxel(2,0,0) â†’ Screen(125, 456)   â”‚
â”‚  â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤  ...                                                â”‚
â”‚  â”‚ â–  â”‚   â”‚ â–  â”‚   â”‚                                                     â”‚
â”‚  â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤                                                     â”‚
â”‚  â”‚   â”‚ â–  â”‚   â”‚ â–  â”‚                                                     â”‚
â”‚  â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜                                                     â”‚
â”‚         â†“ ë³‘ë ¬ íˆ¬ì˜                                                      â”‚
â”‚  [í™”ë©´]                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚  â”‚ (123, 456) â† Voxel(0,0,0)               â”‚                           â”‚
â”‚  â”‚ (125, 456) â† Voxel(2,0,0)               â”‚                           â”‚
â”‚  â”‚ (124, 457) â† Voxel(1,1,0)               â”‚                           â”‚
â”‚  â”‚ ...                                      â”‚                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                                                                         â”‚
â”‚  [Atomic Min Depth]                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚  â”‚ ì—¬ëŸ¬ ì²´ì†Œê°€ ê°™ì€ í”½ì…€ì— íˆ¬ì˜ë  ê²½ìš°:      â”‚                           â”‚
â”‚  â”‚ InterlockedMin( DepthBuffer[Pixel], Depth )                         â”‚
â”‚  â”‚ â†’ ê°€ì¥ ê°€ê¹Œìš´ ì²´ì†Œë§Œ ë‚¨ìŒ                 â”‚                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  ì„±ëŠ¥:
  - Dispatch: (BrickCount, 1, 1)
  - ê° ê·¸ë£¹: 64 ìŠ¤ë ˆë“œ (4x4x4)
  - ì¥ì : ë¹ˆ ì²´ì†Œ ìŠ¤í‚µ (Occupancyì— ë”°ë¼ íš¨ìœ¨ ì¦ê°€)
  - ë‹¨ì : Atomic ì—°ì‚° ì˜¤ë²„í—¤ë“œ
```

---

### 4. TileBricks - íƒ€ì¼ ê¸°ë°˜ ë¹ˆë‹

**ğŸ“‚ ìœ„ì¹˜:** `TileBricks.usf:1-309`

#### ì—­í• 

í™”ë©´ì„ 8x8 íƒ€ì¼ë¡œ ë‚˜ëˆ„ê³ , ê° Brickì´ ì–´ëŠ íƒ€ì¼ì— ì˜í–¥ì„ ì£¼ëŠ”ì§€ ë¹ˆë‹í•©ë‹ˆë‹¤.

#### íƒ€ì¼ êµ¬ì¡°

```hlsl
static const uint TileShift = 3; // 2^3 = 8
static const uint TileSize = 1 << TileShift; // 8x8

struct FTileListElement
{
    float Depth;            // Brickì˜ ìµœì†Œ Depth
    uint BrickIndex;        // Brick ì¸ë±ìŠ¤
    uint NextIndex;         // Linked Listì˜ ë‹¤ìŒ ë…¸ë“œ
};
```

#### Binning Compute Shader

```hlsl
[numthreads(64, 1, 1)]
void BinBricksInTiles( uint BrickIndex : SV_DispatchThreadID )
{
    // 1. Brick ì •ë³´
    FBrick Brick = BrickBuffer[ BrickIndex ];

    float3 BrickPos;
    float CubeSize;
    DecodeBrickKey( Brick.Key, BrickPos, CubeSize );

    // 2. Brickì˜ AABBë¥¼ í™”ë©´ì— íˆ¬ì˜
    float3 Bounds[2] = {
        BrickPos,
        BrickPos + float3( CubeSize, CubeSize, CubeSize )
    };

    float4 ScreenMin = mul( float4( Bounds[0], 1 ), View.TranslatedWorldToClip );
    float4 ScreenMax = mul( float4( Bounds[1], 1 ), View.TranslatedWorldToClip );

    ScreenMin.xyz /= ScreenMin.w;
    ScreenMax.xyz /= ScreenMax.w;

    // 3. íƒ€ì¼ ë²”ìœ„ ê³„ì‚°
    uint2 TileMin = uint2( ScreenMin.xy * View.ViewSizeAndInvSize.xy ) >> TileShift;
    uint2 TileMax = uint2( ScreenMax.xy * View.ViewSizeAndInvSize.xy ) >> TileShift;

    // 4. ê° íƒ€ì¼ì— Brick ì¶”ê°€
    for( uint TileY = TileMin.y; TileY <= TileMax.y; ++TileY )
    {
        for( uint TileX = TileMin.x; TileX <= TileMax.x; ++TileX )
        {
            uint TileIndex = TileX + TileY * TileCountX;

            // Linked Listì— ë…¸ë“œ ì¶”ê°€
            uint NodeIndex = RWTileListBuffer.IncrementCounter();

            FTileListElement Node;
            Node.Depth = ScreenMin.z;  // ìµœì†Œ Depth
            Node.BrickIndex = BrickIndex;
            Node.NextIndex = 0xFFFFFFFF;  // Sentinel

            // Atomic Exchangeë¡œ Head ì—…ë°ì´íŠ¸
            uint OldHead;
            InterlockedExchange( RWTileHeadBuffer[ TileIndex ], NodeIndex, OldHead );
            Node.NextIndex = OldHead;

            RWTileListBuffer[ NodeIndex ] = Node;
        }
    }
}
```

#### íƒ€ì¼ ë¹ˆë‹ ì‹œê°í™”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      TileBricks - Tile-Based Binning                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  [í™”ë©´ â†’ 8x8 íƒ€ì¼ ë¶„í• ]                                                  â”‚
â”‚                                                                         â”‚
â”‚  1920 x 1080 í™”ë©´ â†’ 240 x 135 íƒ€ì¼ = 32,400 íƒ€ì¼                        â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”                            â”‚
â”‚  â”‚ T0 â”‚ T1 â”‚ T2 â”‚ T3 â”‚ T4 â”‚ T5 â”‚ T6 â”‚ T7 â”‚ â† 8x8 í”½ì…€/íƒ€ì¼             â”‚
â”‚  â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¤                            â”‚
â”‚  â”‚ T8 â”‚ T9 â”‚ T10â”‚ T11â”‚ T12â”‚ T13â”‚ T14â”‚ T15â”‚                            â”‚
â”‚  â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¤                            â”‚
â”‚  â”‚T16 â”‚T17 â”‚T18 â”‚T19 â”‚T20 â”‚T21 â”‚T22 â”‚T23 â”‚                            â”‚
â”‚  â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜                            â”‚
â”‚                                                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  [Brick â†’ íƒ€ì¼ ë§¤í•‘]                                                     â”‚
â”‚                                                                         â”‚
â”‚  Brick A (ìŠ¤í¬ë¦° ì˜ì—­: T9, T10, T17, T18)                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚  â”‚                                        â”‚                            â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”                           â”‚                            â”‚
â”‚  â”‚  â”‚ T9 â”‚T10 â”‚  â† Brick A íˆ¬ì˜ ë²”ìœ„       â”‚                            â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¤                           â”‚                            â”‚
â”‚  â”‚  â”‚T17 â”‚T18 â”‚                           â”‚                            â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜                           â”‚                            â”‚
â”‚  â”‚                                        â”‚                            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚         â†“                                                               â”‚
â”‚  T9  â†’ List: [Brick A] â†’ [Brick B] â†’ ...                               â”‚
â”‚  T10 â†’ List: [Brick A] â†’ [Brick C] â†’ ...                               â”‚
â”‚  T17 â†’ List: [Brick A] â†’ [Brick D] â†’ ...                               â”‚
â”‚  T18 â†’ List: [Brick A] â†’ [Brick E] â†’ ...                               â”‚
â”‚                                                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  [Linked List êµ¬ì¡°]                                                      â”‚
â”‚                                                                         â”‚
â”‚  TileHeadBuffer[ T9 ] = 1234                                            â”‚
â”‚  TileListBuffer[ 1234 ] = { Depth: 0.5, BrickIndex: A, Next: 5678 }    â”‚
â”‚  TileListBuffer[ 5678 ] = { Depth: 0.7, BrickIndex: B, Next: 0xFFFF }  â”‚
â”‚                                                                         â”‚
â”‚  [ë Œë”ë§ ì‹œ]                                                             â”‚
â”‚  íƒ€ì¼ T9ë¥¼ ì²˜ë¦¬í•˜ëŠ” Pixel ShaderëŠ”:                                      â”‚
â”‚  1. TileHeadBuffer[T9] ì½ê¸° â†’ 1234                                      â”‚
â”‚  2. TileListBuffer[1234] â†’ Brick A ì²˜ë¦¬                                 â”‚
â”‚  3. TileListBuffer[5678] â†’ Brick B ì²˜ë¦¬                                 â”‚
â”‚  4. Next == 0xFFFF â†’ ì¢…ë£Œ                                               â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  ì¥ì :
  - Tileë³„ë¡œ ê´€ë ¨ Brickë§Œ ì²˜ë¦¬ (Culling íš¨ê³¼)
  - Front-to-Back ì •ë ¬ ê°€ëŠ¥ (Depth ê¸°ì¤€)
  - í”½ì…€ë‹¹ ì˜¤ë²„í—¤ë“œ ê°ì†Œ

  ì„±ëŠ¥:
  - Binning: O(BrickCount x OverlappedTiles)
  - Rendering: O(Pixels x BricksPerTile)
  - ì „í˜•ì ì¸ ì”¬: í”½ì…€ë‹¹ 1-3ê°œ Brick
```

---

## ğŸ’¡ ìµœì í™” ê¸°ë²• (Optimization Techniques)

### 1. DDA ë³€í˜• ì„ íƒ

```cpp
// Voxel.ushì— ì—¬ëŸ¬ DDA ë³€í˜• ì¡´ì¬

// âœ… L1 (ë‹¨ì¼ ë ˆë²¨): ì‘ì€ Brick (4x4x4)
float RayCastBrick_L1( FRay Ray, uint BrickOffset, inout FRayCastCounters Counters );
// - ìµœëŒ€ 64 ìŠ¤í… (4*4*4)
// - ë‹¨ìˆœí•˜ê³  ë¹ ë¦„
// - ë©”ëª¨ë¦¬ ì ‘ê·¼ ìµœì†Œ

// âœ… L2 (2 ë ˆë²¨): í° Brick (16x16x16 = 4096 ì²´ì†Œ)
float RayCastBrick_L2( FRay Ray, uint BrickOffset, inout FRayCastCounters Counters );
// - Root (4x4x4 blocks) + Leaf (4x4x4 voxels per block)
// - ê³„ì¸µì  ìˆœíšŒë¡œ Empty Space Skip
// - ë©”ëª¨ë¦¬ íš¨ìœ¨ì 

// âœ… L1_YZ ìµœì í™”: Xì¶• ë¼ì¸ í…ŒìŠ¤íŠ¸
float RayCastBrick_L1_YZ( FRay Ray, uint BrickOffset, inout FRayCastCounters Counters );
// - YZ í‰ë©´ ìˆœíšŒ + Xì¶• ì „ì²´ ë¼ì¸ í•œ ë²ˆì— í…ŒìŠ¤íŠ¸
// - ë¹„íŠ¸ ì—°ì‚°ìœ¼ë¡œ Xì¶• êµì°¨ ê²€ì‚¬
// - íŠ¹ì • ë ˆì´ ë°©í–¥ì—ì„œ 2-3ë°° ë¹ ë¦„
```

### 2. ë¹„íŠ¸ ì—°ì‚° ìµœì í™”

```hlsl
// âŒ ë‚˜ì´ë¸Œí•œ Occupancy ì²´í¬
for( uint i = 0; i < 64; ++i )
{
    uint Mask = 1u << i;
    if( Block & Mask )
        Count++;
}
// â†’ 64ë²ˆ ë£¨í”„

// âœ… ë¹„íŠ¸ ì¹´ìš´íŠ¸ ì¸íŠ¸ë¦°ì‹
uint Count = countbits( Block.x ) + countbits( Block.y );
// â†’ 2ë²ˆ ì¸íŠ¸ë¦°ì‹ í˜¸ì¶œ (í•˜ë“œì›¨ì–´ ê°€ì†)
```

### 3. Early-Out ìµœì í™”

```hlsl
// Ray-Box êµì°¨ í…ŒìŠ¤íŠ¸ë¡œ ì¡°ê¸° ì¢…ë£Œ
Ray.Time = RayUnitBox( Ray );

if( Ray.Time[0] >= Ray.Time[1] )
    discard;  // êµì°¨ ì—†ìŒ â†’ Pixel Shader ì¦‰ì‹œ ì¢…ë£Œ

// DDA ì‹œì‘ ì „ ë¯¸ë¦¬ ì²´í¬í•˜ì—¬ ë¶ˆí•„ìš”í•œ ê³„ì‚° ì œê±°
```

### 4. Wave Intrinsics í™œìš©

```hlsl
// Tile ë‚´ ìŠ¤ë ˆë“œ ê°„ í˜‘ë ¥
uint TileIndex = GroupID.x + GroupID.y * TileCountX;
uint WaveMin = WaveActiveMin( LocalDepth );
uint WaveMax = WaveActiveMax( LocalDepth );

// Wave ë‹¨ìœ„ë¡œ Min/Max ê³„ì‚°í•˜ì—¬ Shared Memory ì ‘ê·¼ ìµœì†Œí™”
```

---

## ğŸ¯ ì„±ëŠ¥ ê³ ë ¤ì‚¬í•­ (Performance Considerations)

### ë Œë”ë§ ë°©ì‹ ë¹„êµ

| ë°©ì‹ | ì¥ì  | ë‹¨ì  | ì‚¬ìš© ì¼€ì´ìŠ¤ |
|------|------|------|-------------|
| **RasterizeBricks (VS/PS)** | âœ… ê¸°ì¡´ ë˜ìŠ¤í„°í™” íŒŒì´í”„ë¼ì¸<br>âœ… Early-Z í™œìš©<br>âœ… HW ê°€ì† | âŒ Overdraw<br>âŒ Pixel Shader ë³µì¡ | ì¼ë°˜ ì¼€ì´ìŠ¤ |
| **ScatterBricks (Compute)** | âœ… ë¹ˆ ì²´ì†Œ ìŠ¤í‚µ<br>âœ… ë³‘ë ¬ ì²˜ë¦¬ | âŒ Atomic ì˜¤ë²„í—¤ë“œ<br>âŒ í”½ì…€ë‹¹ ë‹¤ì¤‘ ì“°ê¸° | Sparse Brick |
| **TileBricks + Raster** | âœ… íƒ€ì¼ë³„ Culling<br>âœ… Depth ì •ë ¬ | âŒ Binning ë¹„ìš©<br>âŒ Linked List ì˜¤ë²„í—¤ë“œ | ë³µì¡í•œ ì”¬ |

### DDA ì„±ëŠ¥ ë¶„ì„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     DDA ì„±ëŠ¥ ì¸¡ì • (1920x1080)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  [ì‹œë‚˜ë¦¬ì˜¤ 1: Dense Brick (Occupancy 80%)]                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  RayCastBrick_L1:        0.5ms                                          â”‚
â”‚  - í‰ê·  ìŠ¤í… ìˆ˜: 8-12                                                    â”‚
â”‚  - Hit í™•ë¥ : 80%                                                         â”‚
â”‚                                                                         â”‚
â”‚  RayCastBrick_L2:        0.7ms                                          â”‚
â”‚  - í‰ê·  ìŠ¤í… ìˆ˜: 15-20 (Root + Leaf)                                     â”‚
â”‚  - ê³„ì¸µ ì˜¤ë²„í—¤ë“œ > L1                                                    â”‚
â”‚                                                                         â”‚
â”‚  â†’ L1 ê¶Œì¥ (Dense ë°ì´í„°)                                                â”‚
â”‚                                                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  [ì‹œë‚˜ë¦¬ì˜¤ 2: Sparse Brick (Occupancy 10%)]                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  RayCastBrick_L1:        0.6ms                                          â”‚
â”‚  - í‰ê·  ìŠ¤í… ìˆ˜: 40-50 (Empty ìˆœíšŒ)                                      â”‚
â”‚  - Hit í™•ë¥ : 10%                                                         â”‚
â”‚                                                                         â”‚
â”‚  RayCastBrick_L2:        0.3ms  âš¡                                       â”‚
â”‚  - í‰ê·  ìŠ¤í… ìˆ˜: 10-15 (Rootì—ì„œ Empty Block Skip)                       â”‚
â”‚  - ê³„ì¸µì  Skip íš¨ê³¼                                                      â”‚
â”‚                                                                         â”‚
â”‚  â†’ L2 ê¶Œì¥ (Sparse ë°ì´í„°)                                               â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ìµœì í™” íŒ

**âœ… í•´ì•¼ í•  ê²ƒ:**

```hlsl
// 1. Brick LOD í™œìš©
// - ë¨¼ ê±°ë¦¬: ë‚®ì€ ë ˆë²¨ (í° ì²´ì†Œ)
// - ê°€ê¹Œìš´ ê±°ë¦¬: ë†’ì€ ë ˆë²¨ (ì‘ì€ ì²´ì†Œ)

float DistanceLOD = distance( CameraPos, BrickPos );
float Level = clamp( log2( DistanceLOD / 100.0 ), 0, 15 );

// 2. Occupancy ê¸°ë°˜ ë°©ì‹ ì„ íƒ
if( Occupancy > 0.5 )
    RayCastBrick_L1();  // Dense â†’ L1
else
    RayCastBrick_L2();  // Sparse â†’ L2

// 3. Early-Z í™œì„±í™”
[earlydepthstencil]
void DrawBricksPS( ... )
```

**âŒ í”¼í•´ì•¼ í•  ê²ƒ:**

```hlsl
// 1. ëª¨ë“  Brickì— L2 ì‚¬ìš©
// â†’ Dense ë°ì´í„°ì—ì„œ ì˜¤íˆë ¤ ëŠë¦¼

// 2. Atomic ë‚¨ìš©
// â†’ ScatterBricksì—ì„œ í”½ì…€ë‹¹ ë‹¤ì¤‘ ì“°ê¸° ì‹œ ë³‘ëª©

// 3. í° Brick ë¬´ë¶„ë³„ ì‚¬ìš©
// â†’ ë©”ëª¨ë¦¬ ë‚­ë¹„ + ì˜¤ë²„í˜ì¹˜
```

---

## ğŸ”— ì°¸ê³  ìë£Œ (References)

### ì†ŒìŠ¤ ì½”ë“œ
- **Voxel.ush** (835 ë¼ì¸) - `Engine/Shaders/Private/Nanite/Voxel/Voxel.ush`
  - DDA ì•Œê³ ë¦¬ì¦˜ (InitDDA, StartDDA, StepDDA)
  - BlockBounds ë””ì½”ë”©
  - RayCastBrick ë³€í˜•ë“¤
- **Brick.ush** (156 ë¼ì¸) - `Engine/Shaders/Private/Nanite/Voxel/Brick.ush`
  - EncodeBrickKey, DecodeBrickKey
- **AutoVoxel.usf** (200 ë¼ì¸) - `Engine/Shaders/Private/Nanite/Voxel/AutoVoxel.usf`
  - VisibleBricksHash Compute Shader
- **RasterizeBricks.usf** (258 ë¼ì¸) - `Engine/Shaders/Private/Nanite/Voxel/RasterizeBricks.usf`
  - DrawBricksVS, DrawBricksPS
- **ScatterBricks.usf** (175 ë¼ì¸) - `Engine/Shaders/Private/Nanite/Voxel/ScatterBricks.usf`
  - ScatterVoxels Compute Shader
- **TileBricks.usf** (309 ë¼ì¸) - `Engine/Shaders/Private/Nanite/Voxel/TileBricks.usf`
  - BinBricksInTiles Compute Shader

### ê´€ë ¨ ë¬¸ì„œ
- [VoxelGeometry.md](./VoxelGeometry.md) - CPU ì¸¡ ì²´ì†Œ ìƒì„± ê³¼ì •
- [Rasterization.md](./Rasterization.md) - Nanite ë˜ìŠ¤í„°í™” ì‹œìŠ¤í…œ

### ì™¸ë¶€ ì°¸ê³ 
- **DDA Algorithm**: [Wikipedia - Digital Differential Analyzer](https://en.wikipedia.org/wiki/Digital_differential_analyzer_(graphics_algorithm))
- **Tile-Based Rendering**: [Tile-Based Deferred Rendering](https://www.intel.com/content/www/us/en/developer/articles/technical/deferred-rendering-for-current-and-future-rendering-pipelines.html)

---

> ğŸ“… **ì‘ì„±ì¼**: 2025-11-06 â€” Nanite Voxel ì…°ì´ë” ì‹œìŠ¤í…œ ì™„ì „ ë¬¸ì„œí™”
> ğŸ“ **ë¬¸ì„œ ë²„ì „**: v1.0
> âœ… **ì†ŒìŠ¤ ê²€ì¦**: UE 5.7.0 (1,933 ë¼ì¸ ë¶„ì„ ì™„ë£Œ)
